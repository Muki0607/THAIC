-- Generated by LuaSTG Editor Sharp
-- Mod name: 
_author = "Muki"
_mod_version = 4096
_allow_practice = true
_allow_sc_practice =true
--[[ 这里是梦摇篮的工程
]]
--[[ 使用了一些aic库中的代码，请自行查询data
]]
_LoadImageFromFile('image:'..'Muki_AiC_Alice_face_default','Muki_AiC_Alice_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Alice_face_fight','Muki_AiC_Alice_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_assured','Muki_AiC_Noel_face_assured.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_default','Muki_AiC_Noel_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_embarassed','Muki_AiC_Noel_face_embarassed.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_fight','Muki_AiC_Noel_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_final','Muki_AiC_Noel_face_final.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_normal','Muki_AiC_Noel_face_normal.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile','Muki_AiC_Noel_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile2','Muki_AiC_Noel_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile3','Muki_AiC_Noel_face_smile3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_speachless','Muki_AiC_Noel_face_speachless.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_thinking','Muki_AiC_Noel_face_thinking.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_thinking2','Muki_AiC_Noel_face_thinking2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_understand','Muki_AiC_Noel_face_understand.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose','Muki_AiC_Noel_face_lose.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose2','Muki_AiC_Noel_face_lose2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose3','Muki_AiC_Noel_face_lose3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose4','Muki_AiC_Noel_face_lose4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_angry','Muki_AiC_Ixia_face_angry.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_default','Muki_AiC_Ixia_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_smile','Muki_AiC_Ixia_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_surprise','Muki_AiC_Ixia_face_surprise.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_notworryyou','Muki_AiC_Ixia_face_notworryyou.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Laevigata_face_smile2','Muki_AiC_Laevigata_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_default','Muki_AiC_Mepha_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_fight','Muki_AiC_Mepha_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_smile','Muki_AiC_Mepha_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_fight','Muki_AiC_Primula_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile','Muki_AiC_Primula_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile2','Muki_AiC_Primula_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile3','Muki_AiC_Primula_face_smile3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach','Muki_AiC_Primula_face_teach.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach2','Muki_AiC_Primula_face_teach2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach3','Muki_AiC_Primula_face_teach3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_speechless','Muki_AiC_Primula_face_speechless.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_surprise','Muki_AiC_Primula_face_surprise.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory','Muki_AiC_Primula_face_memory.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory2','Muki_AiC_Primula_face_memory2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory3','Muki_AiC_Primula_face_memory3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_smile','Muki_AiC_Yukari_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_fight','Muki_AiC_Yukari_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_default','Muki_AiC_Yukari_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Okina_face_default','Muki_AiC_Okina_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Alma_face_default','Muki_AiC_Alma_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell1','Muki_AiC_spell1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell2','Muki_AiC_spell2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell3','Muki_AiC_spell3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell4','Muki_AiC_spell4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell5','Muki_AiC_spell5.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell6','Muki_AiC_spell6.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell7','Muki_AiC_spell7.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell8','Muki_AiC_spell8.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_down','Muki_AiC_Noel_down.png',true,1,5,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_burst','Muki_AiC_Noel_burst.png',true,15,1,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_burst_stunned','Muki_AiC_Noel_burst_stunned.png',true,8,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_misogi','Muki_AiC_Noel_misogi.png',true,21,1,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_air_attack','Muki_AiC_Noel_air_attack.png',true,21,1,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_air_attack_loop','Muki_AiC_Noel_air_attack_loop.png',true,8,1,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_air_attack_end','Muki_AiC_Noel_air_attack_end.png',true,4,1,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_get_magic1_','Muki_AiC_Noel_get_magic1.png',true,25,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_get_magic2_','Muki_AiC_Noel_get_magic2.png',true,6,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_get_magic3_','Muki_AiC_Noel_get_magic3.png',true,14,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_get_magic4_','Muki_AiC_Noel_get_magic4.png',true,14,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_get_magic5_','Muki_AiC_Noel_get_magic5.png',true,15,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_guard_bush','Muki_AiC_Noel_guard_bush.png',true,13,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_guard_slash_start','Muki_AiC_Noel_guard_slash_start.png',true,17,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_guard_slash_loop','Muki_AiC_Noel_guard_slash_loop.png',true,7,1,0,0,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_guard_slash_end','Muki_AiC_Noel_guard_slash_end.png',true,12,1,0,0,false)
_LoadImageFromFile('image:'..'Muki_AiC_dialog_frame','Muki_AiC_dialog_frame.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation1','Muki_AiC_animation1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation2','Muki_AiC_animation2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation3','Muki_AiC_animation3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation4','Muki_AiC_animation4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation5','Muki_AiC_animation5.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation6','Muki_AiC_animation6.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation7','Muki_AiC_animation7.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation8','Muki_AiC_animation8.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation9','Muki_AiC_animation9.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation10','Muki_AiC_animation10.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation11','Muki_AiC_animation11.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation12','Muki_AiC_animation12.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation13','Muki_AiC_animation13.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_animation14','Muki_AiC_animation14.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_stex_logo1','Muki_AiC_stex_logo1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_stex_logo2','Muki_AiC_stex_logo2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_stex_logo3','Muki_AiC_stex_logo3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_stex_logo4','Muki_AiC_stex_logo4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_doll','Muki_AiC_Ixia_doll.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_nuclear','Muki_AiC_nuclear.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_bow','Muki_AiC_bow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_square4','Muki_AiC_square4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef','Muki_AiC_Primula_cast_ef.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef2','Muki_AiC_Primula_cast_ef2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef3','Muki_AiC_Primula_cast_ef3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_smoke','Muki_AiC_Primula_smoke.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_slave','Muki_AiC_slave.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_magic_authentication_device','Muki_AiC_magic_authentication_device.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cane','Muki_AiC_cane.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cane_bg','Muki_AiC_cane_bg.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cast_ef1','Muki_AiC_cast_ef1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cast_ef2','Muki_AiC_cast_ef2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_fox_bullet1','Muki_AiC_fox_bullet1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_glass_break1','Muki_AiC_glass_break1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_glass_break2','Muki_AiC_glass_break2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_glass_break3','Muki_AiC_glass_break3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal1','Muki_AiC_Yukari_portal1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal2','Muki_AiC_Yukari_portal2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal3','Muki_AiC_Yukari_portal3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal4','Muki_AiC_Yukari_portal4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal5','Muki_AiC_Yukari_portal5.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_portal6','Muki_AiC_Yukari_portal6.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Muki_AiC_square','Muki_AiC_square.png',true,3,1,0,0,false)
LoadPS('particle:'..'Muki_AiC_cane_bg2','Muki_AiC_cane_bg2.psi',"parimg8",0,0,false)
LoadSound('se:'..'Muki_AiC_dialog_Noel','Muki_AiC_dialog_Noel.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Ixia','Muki_AiC_dialog_Ixia.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Primula','Muki_AiC_dialog_Primula.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Mepha','Muki_AiC_dialog_Mepha.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Alma','Muki_AiC_dialog_Alma.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Laevigata','Muki_AiC_dialog_Laevigata.ogg')
LoadSound('se:'..'Muki_AiC_hit','Muki_AiC_hit.ogg')
LoadSound('se:'..'Muki_AiC_hit_casted','Muki_AiC_hit_casted.ogg')
LoadSound('se:'..'Muki_AiC_casting','Muki_AiC_casting.ogg')
LoadSound('se:'..'Muki_AiC_casting_short','Muki_AiC_casting_short.ogg')
LoadSound('se:'..'Muki_AiC_arrow','Muki_AiC_arrow.ogg')
LoadSound('se:'..'Muki_AiC_bomb','Muki_AiC_bomb.ogg')
LoadSound('se:'..'Muki_AiC_bomb_explode','Muki_AiC_bomb_explode.ogg')
LoadSound('se:'..'Muki_AiC_lightball','Muki_AiC_lightball.ogg')
LoadSound('se:'..'Muki_AiC_burst','Muki_AiC_burst.ogg')
LoadSound('se:'..'Muki_AiC_shield','Muki_AiC_shield.ogg')
LoadSound('se:'..'Muki_AiC_misogi_start','Muki_AiC_misogi_start.ogg')
LoadSound('se:'..'Muki_AiC_misogi_end','Muki_AiC_misogi_end.ogg')
LoadSound('se:'..'Muki_AiC_air_attack_start','Muki_AiC_air_attack_start.ogg')
LoadSound('se:'..'Muki_AiC_air_attack_end','Muki_AiC_air_attack_end.ogg')
LoadSound('se:'..'Muki_AiC_guard_slash','Muki_AiC_guard_slash.ogg')
LoadSound('se:'..'Muki_AiC_watershard_casting','Muki_AiC_watershard_casting.ogg')
LoadSound('se:'..'Muki_AiC_watershard_aiming','Muki_AiC_watershard_aiming.ogg')
LoadSound('se:'..'Muki_AiC_watershard_shooting','Muki_AiC_watershard_shooting.ogg')
LoadSound('se:'..'Muki_AiC_primula_cast1','Muki_AiC_primula_cast1.ogg')
LoadSound('se:'..'Muki_AiC_primula_cast2','Muki_AiC_primula_cast2.ogg')
LoadSound('se:'..'Muki_AiC_primula_charge1','Muki_AiC_primula_charge1.ogg')
LoadSound('se:'..'Muki_AiC_primula_charge2','Muki_AiC_primula_charge2.ogg')
LoadSound('se:'..'Muki_AiC_primula_fog','Muki_AiC_primula_fog.ogg')
LoadSound('se:'..'Muki_AiC_magic_getting','Muki_AiC_magic_getting.ogg')
LoadSound('se:'..'Muki_AiC_magic_got','Muki_AiC_magic_got.ogg')
LoadSound('se:'..'Muki_AiC_magic_got_closed','Muki_AiC_magic_got_closed.ogg')
LoadSound('se:'..'Muki_AiC_skill_got','Muki_AiC_skill_got.ogg')
LoadSound('se:'..'Muki_AiC_bgm_end','Muki_AiC_bgm_end.ogg')
LoadSound('se:'..'Muki_AiC_dame','Muki_AiC_dame.ogg')
LoadSound('se:'..'Muki_AiC_hited1','Muki_AiC_hited1.ogg')
LoadSound('se:'..'Muki_AiC_hited2','Muki_AiC_hited2.ogg')
LoadSound('se:'..'Muki_AiC_hited3','Muki_AiC_hited3.ogg')
LoadSound('se:'..'Muki_AiC_hited4','Muki_AiC_hited4.ogg')
--[[ bgm统一至data内
]]
_LoadImageFromFile('image:'..'Muki_AiC_bg','Muki_AiC_bg.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_white','Muki_AiC_white.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cdbg','Muki_AiC_cdbg.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cdbg2','Muki_AiC_cdbg2.png',true,0,0,false,0)
Muki_AiC_background=Class(object)

function Muki_AiC_background:init()
	background.init(self,false)
	--set camera
	Set3D('eye',-0.90,0.00,0.00)
	Set3D('at',1.00,0.00,0.00)
	Set3D('up',0.00,1.00,0.00)
	Set3D('fovy',0.50)
	Set3D('z',0.10,24.00)
	Set3D('fog',5.00,10.00,Color(255,255,255,255))
	--
	--New(Muki_camera_setter,-250,-200)
end

function Muki_AiC_background:render()
	SetViewMode'3d'
	RenderClear(lstg.view3d.fog[3])
	Render4V('image:Muki_AiC_bg',
	1, 0.5, -0.5,
	1, 0.5, 0.5,
	1, -0.5, 0.5,
	1, -0.5, -0.5)
	SetViewMode'world'
end
_editor_class["Muki_AiC_cdbg_ef1"]=Class(_object)
_editor_class["Muki_AiC_cdbg_ef1"].init=function(self,_x,_y,v,a,co)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square2"
    self.layer=LAYER_BG+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    SetV2(self,v,a,false,false)
    _object.set_color(self,"",150,255,255,255)
end
_editor_class["Muki_AiC_cdbg_ef1"].frame=function(self)
    if self.x<=-256 then
        self.x=256
    else
    end
    if self.y<=-256 then
        self.y=256
    else
    end
    if self.del then
        _del(self,false)
    else
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_cdbg"]=Class(_spellcard_background)
_editor_class["Muki_AiC_cdbg"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:Muki_AiC_white",true,0,0,0,0,0,0,"mul+sub",1,1,
        function(self)
            self.task={}
            self.alpha=150
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
    _spellcard_background.AddLayer(self,"image:Muki_AiC_white",true,0,0,0,0,0,0,"mul+sub",1,1,
        function(self)
            self.task={}
            lasttask=task.New(self,function()
                for _=1,_infinite do
                    for _=1,_infinite do
                        if _boss.spelling then break end
                        task._Wait(1)
                    end
                    do
                        local _beg_y=-256 local y=_beg_y local _end_y=256 local _d_y=(_end_y-_beg_y)/(10)
                        for _=1,10 do
                            do
                                local _beg_x=-256 local x=_beg_x local _end_x=256 local _d_x=(_end_x-_beg_x)/(20)
                                local dy=0 local _n_dy=(0)+(512/10/2)
                                for _=1,20 do
                                    last=New(_editor_class["Muki_AiC_cdbg_ef1"],x,y+dy,0.5,-135)
                                    x=x+_d_x
                                    dy=-(dy)+_n_dy
                                end
                            end
                            y=y+_d_y
                        end
                    end
                    for _=1,_infinite do
                        if not _boss.spelling then break end
                        task._Wait(1)
                    end
                    for _,unit in ObjList(GROUP_GHOST) do
                        unit.del=true
                    end
                end
            end)
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
function Muki_fadein(bgm,t)
    local t = t or 60
    New(tasker, function()
        task._Wait(t)
        LoadMusicRecord(bgm)
        _play_music(bgm)
        do local i,_d_i=(1),(1) for _=1,t do
            SetBGMVolume(bgm, i / t)
            task._Wait(1)
        i=i+_d_i end end
    end)
end
function Muki_fadeout(t,pause)
    local t = t or 60
    New(tasker, function()
        local _, bgm = EnumRes('bgm')
        for i = 1, t do
            for _,v in pairs(bgm) do
                if GetMusicState(v) == 'playing' then
                    SetBGMVolume(v, 1 - i / 30)
                end
            end
            task.Wait()
        end
        if pause then
            _pause_music()
        else
            _stop_music()
        end
    end)
end
function Muki_stroke(font,text,x,y,co,...)
    local _x,_y
    for i = 0, 8 do
    	_x = x + sqrt(2) * cos(i * 45)
    	_y = y + sqrt(2) * sin(i * 45)
    	RenderTTF(font, text,
    	_x, _x, _y, _y,
    	co,
    	...)
    end
end
function Muki_cast(self,choice,t,rot,r,slow,newskill)
    choice = choice or 1
    t = t or 60
    rot = rot or -90
    r = r or 72
    slow = slow or 4
    last=New(_editor_class["Muki_AiC_spell_ui"],self.x,self.y,r,choice,sign(self.lr),20,slow,newskill)
    task._Wait(20)
    last=New(_editor_class["Muki_AiC_casting_aura"],self.x,self.y,60,2,rot,t-30,t,self)
    lstg.tmpvar.aura=last
    boss.cast(self,t)
    PlaySound("se:Muki_AiC_casting",4,self.x/256,true)
    task._Wait(min(60,t))
    if t > 60 then
        for _=1,int((t-60)/30) do
            PlaySound("se:Muki_AiC_casting_short",4,self.x/256,true)
            task._Wait(30)
        end
    end
end
function Muki_cast_primula(self,flag,t)
    --[[ 老师的施法真的好麻烦……
    ]]
    t = t or 60
    boss.cast(self,t)
    local dx=(-10)
    local dy=(40)
    if flag==1 then
        PlaySound("se:Muki_AiC_primula_charge1",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,t do
                local r=(ran:Int(5,15)*10)
                local a=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_ef1"],self.x+dx+r*cos(a),self.y+dy+r*sin(a),self.x+dx,self.y+dy,a,r)
                task._Wait(1)
            end
        end)
    elseif flag==2 then
        PlaySound("se:Muki_AiC_primula_charge2",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,int(t/6) do
                last=New(_editor_class["Muki_AiC_Primula_cast_ef3"],self.x+dx,self.y+dy,15)
                task._Wait(10)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,t do
                local r=(ran:Float(50,100))
                local a=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_ef2"],self.x+dx+r*cos(a),self.y+dy+r*sin(a),self.x+dx,self.y+dy,a,r)
                task._Wait(1)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,int(t/6) do
                for _=1,3 do
                    last=New(_editor_class["Muki_AiC_Primula_cast_ef4"],self.x+dx,self.y+dy,15)
                end
                task._Wait(10)
            end
        end)
    else
        PlaySound("se:Muki_AiC_primula_charge1",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,t do
                local r2=(ran:Int(5,15)*10)
                local a2=(ran:Float(0,360))
                local r1=(20)
                local a1=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_laser"],self.x+dx+r2*cos(a2)+r1*cos(a1),self.y+dy+r2*sin(a2)+r1*sin(a1),self.x+dx+r1*cos(a1),self.y+dy+r1*sin(a1),a2,r2)
                task._Wait(1)
            end
        end)
    end
    task._Wait(min(60,t)+10)
end
function Muki_get8dir(self,other)
    local a=(Angle(self,other))
    local aa
    if (a>-22.5 and a<=0) or (a>=0 and a<=22.5) then
        aa=0
    elseif a>22.5 and a<=67.5 then
        aa=45
    elseif a>67.5 and a<=112.5 then
        aa=90
    elseif a>112.5 and a<=157.5 then
        aa=135
    elseif (a>157.5 and a<=180) or (a>=-180 and a<=-157.5) then
        aa=180
    elseif a>-157.5 and a<=-112.5 then
        aa=225
    elseif a>-112.5 and a<=-67.5 then
        aa=270
    elseif a>-67.5 and a<=-22.5 then
        aa=315
    end
    return aa
end
function Muki_warning(self,a,shift,n,t)
    shift=shift or 30
    n=n or 3
    t=t or 20
    for _=1,n do
        last=New(_editor_class["Muki_AiC_warning_line"],self.x,self.y,a,a+shift,t)
        last=New(_editor_class["Muki_AiC_warning_line"],self.x,self.y,a,a-shift,t)
        task._Wait(t/2)
    end
end
function Muki_boss_escape(self,x,y,t,mode,nosound)
    player.dialog=false
    x=x or 384
    y=y or 256
    t=t or 60
    mode=mode or MOVE_ACC_DEC
    lasttask=task.New(self,function()
        self.colli=false
        if not nosound then
            PlaySound("fault",1,self.x/256,false)
        else
        end
        task._Wait(t-60)
        task.MoveTo(x,y,60,mode)
        _del(self,true)
    end)
end
_editor_tasks["Muki_smear"]=function(self,t1,t2,ghost)
    return function()
        local self=task.GetSelf()
        --[[ from 曲线系统指南 by 夜雀的歌声
        ]]
        --[[ 但这个版本考虑兼容性没用曲线系统
        ]]
        for _=1,_infinite do
            last=New(_straight,self.imgclass,self._index,self.x,self.y,0,self.rot,false,0,true,true,0,false,0,0,0,false)
            last.class=last.logclass
            if ghost then
                last.group=GROUP_GHOST
            end
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                do
                    local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(t2-1)
                    for _=1,t2 do
                        _object.set_color(self,"",al,255,255,255)
                        task._Wait(1)
                        al=al+_d_al
                    end
                end
                _del(self,false)
            end)
            task._Wait(t1)
        end
    end
end
_editor_class["Muki_AiC_test"]=Class(_object)
_editor_class["Muki_AiC_test"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="leaf"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_ENEMY_BULLET
    self.hide=true
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
    end)
end
_editor_class["Muki_AiC_dialog_name"]=Class(_object)
_editor_class["Muki_AiC_dialog_name"].init=function(self,_x,_y,name)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+10
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.name=name
end
_editor_class["Muki_AiC_dialog_name"].frame=function(self)
    if not player.dialog then
        _del(self,false)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_dialog_name"].render=function(self)
    --Muki_stroke('dialog',self.name,self.x,self.y,Color(255,0,0,0),'vcenter')
    RenderTTF('dialog',self.name,self.x,self.x,self.y,self.y,Color(255,230,227,219),'vcenter')
end
_editor_class["Muki_AiC_NB_Portrait_AI"]=Class(_object)
_editor_class["Muki_AiC_NB_Portrait_AI"].init=function(self,_x,_y,img,s,dx)
    self.x,self.y=_x,_y
    self.img=img or "image:Muki_AiC_Noel_face_fight"
    self.layer=LAYER_PLAYER-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    s=s or 0.4
    dx = dx or 0
    self.hscale=s
    self.vscale=s
    self.omiga=0---0.05
    (self).x,(self).y=192,96
    _object.set_color(self,"",0,255,255,255)
    local sn=(3)
    lasttask=task.New(self,function()
        do
            local _beg_ia=0 local ia=_beg_ia local _end_ia=255 local _d_ia=(_end_ia-_beg_ia)/(30-1)
            local _beg_isc=s local isc=_beg_isc local _end_isc=s+0.1 local _d_isc=(_end_isc-_beg_isc)/(30)
            for _=1,30 do
                _object.set_color(self,"",ia,255,255,255)
                self.hscale = isc
                self.vscale = isc
                task._Wait(1)
                ia=ia+_d_ia
                isc=isc+_d_isc
            end
        end
        task._Wait(60)
        do
            local _beg_ia=255 local ia=_beg_ia local _end_ia=0 local _d_ia=(_end_ia-_beg_ia)/(30-1)
            for _=1,30 do
                _object.set_color(self,"",ia,255,255,255)
                task._Wait(1)
                ia=ia+_d_ia
            end
        end
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        do
            local _beg_iy=96 local iy=_beg_iy local _end_iy=0 local _w_iy=0 local _d_w_iy=1/(30-1)
            local _beg_ix=192 local ix=_beg_ix local _end_ix=dx local _w_ix=0 local _d_w_ix=1/(30-1)
            local i=1 local _d_i=(1)
            for _=1,30 do
                (self).x,(self).y=ix,iy
                if i>=60-sn then break end
                task._Wait(1)
                _w_iy=_w_iy+_d_w_iy iy=(_beg_iy-_end_iy)*(_w_iy-1)^2+_end_iy
                _w_ix=_w_ix+_d_w_ix ix=(_beg_ix-_end_ix)*(_w_ix-1)^2+_end_ix
                i=i+_d_i
            end
        end
        self.vx,self.vy=self.dx,self.dy
        task._Wait(sn)
        task._Wait(30)
        _set_a(self,0.05,180,false)
    end)
end
--[[ Code by 夜雀的歌声,Arranged by Muki
]]
_editor_class["Muki_AiC_aura1"]=Class(_object)
_editor_class["Muki_AiC_aura1"].init=function(self,_x,_y,r,a,co,scale)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square1"
    self.layer=LAYER_ENEMY-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=scale
    self.hscale=scale
    self.r=0
    self.angle=a
    self.co=co or {255,255,255}
    _connect(_boss,self,0,false)
    lasttask=task.New(self,function()
        do
            local _beg_rr=0 local rr=_beg_rr local _end_rr=r local _w_rr=0 local _d_w_rr=1/(30)
            for _=1,30 do
                self.r=rr
                task._Wait(1)
                _w_rr=_w_rr+_d_w_rr rr=(_beg_rr-_end_rr)*(_w_rr-1)^2+_end_rr
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_aura2"],self.x,self.y,self,co,scale)
            self.light=true
            task._Wait(240)
        end
    end)
end
_editor_class["Muki_AiC_aura1"].frame=function(self)
    _object.set_color(self,"mul+add",min(255,7.5*self.timer),self.co[1],self.co[2],self.co[3])
    _set_rel_pos(self,self.r*cos(self.angle),self.r*sin(self.angle),self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_aura2"]=Class(_object)
_editor_class["Muki_AiC_aura2"].init=function(self,_x,_y,master,co,scale)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square2"
    self.layer=LAYER_ENEMY-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=scale
    self.hscale=scale
    self.co=co or {255,255,255}
    _object.set_color(self,"mul+add",0,self.co[1],self.co[2],self.co[3])
    _connect(master,self,0,true)
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                _object.set_color(self,"mul+add",al,self.co[1],self.co[2],self.co[3])
                task._Wait(1)
                al=al+_d_al
            end
        end
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                _object.set_color(self,"mul+add",al,self.co[1],self.co[2],self.co[3])
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            self.vscale=self._master.vscale
            self.hscale=self._master.hscale
            _set_rel_pos(self,0,0,self.rot,false)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_aura2"].frame=function(self)
    if self.del then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_shield"]=Class(_object)
_editor_class["Muki_AiC_shield"].init=function(self,_x,_y,r,h,o,state,master,t)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=0
    self.h=0
    self.state=state
    self.omiga=o
    self.bound=false
    self.t=t
    _connect(master,self,0,true)
    --[[ 使用斜二测画法算出来的奇怪答案
    ]]
    --[[ 浅薄的高中数学知识终究是败给了调参
    ]]
    local a=(sqrt((5+2*sqrt(2))/4))
    local b=(0.1)
    if state==1 then
lasttask=task.New(self,function () ex.SmoothSetValueTo("r",r,15,MOVE_NORMAL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("h",h,15,MOVE_NORMAL,nil,0,MODE_SET) end )
    else
        self.r=r
        self.h=h
    end
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if not self.xx or not self.yy then
                _set_rel_pos(self,0,0,self.rot,false)
            else
                SetV2(self,5,Angle(self.x,self.y,self.xx,self.yy),false,false)
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,int(Dist(self.x,self.y,self.xx,self.yy)/5),MOVE_NORMAL,nil,0,MODE_SET) end )
                task._Wait(int(Dist(self.x,self.y,self.xx,self.yy)/5))
            end
            do local rot,_d_rot=(0),(90) for _=1,4 do
                do local y,_d_y=(-self.h),(2*self.h) for _=1,2 do
                    local x1, y1, x2, y2 =
                    	self.x,
                    	self.y+y,
                    	self.x + self.r * a * cos(rot + self.rot),
                    	self.y + self.r * b * sin(rot + self.rot)
                    if self.state >=3 then
                    	x1, y1 = aic.math.rotate(x1, y1, 15*cos(10*self.timer), self.x, self.y)
                    	x2, y2 = aic.math.rotate(x2, y2, 15*cos(10*self.timer), self.x, self.y)
                    end
                    if (rot+self.rot+360)%360<=180 then
                        if self.state>=2 then
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,true)
                        else
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,true)
                        end
                        if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                    else
                        if self.state>=2 then
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,false)
                        else
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,false)
                        end
                        if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                    end
                y=y+_d_y end end
                local x1, y1, x2, y2 =
                	self.x + self.r * a * cos(rot + self.rot),
                	self.y + self.r * b * sin(rot + self.rot),
                	self.x + self.r * a * cos(rot + self.rot + 90),
                	self.y + self.r * b * sin(rot + self.rot + 90)
                if self.state >=3 then
                	x1, y1 = aic.math.rotate(x1, y1, 15*cos(10*self.timer), self.x, self.y)
                	x2, y2 = aic.math.rotate(x2, y2, 15*cos(10*self.timer), self.x, self.y)
                end
                if (rot+self.rot+360)%360<=180 then
                    if self.state>=2 then
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,true,self.state)
                    else
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,true,self.state)
                    end
                    if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                else
                    if self.state>=2 then
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,false,self.state)
                    else
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,false,self.state)
                    end
                    if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                end
            rot=rot+_d_rot end end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_shield"].frame=function(self)
    self.class.base.frame(self)
    if self.t and self.timer>=self.t then
        _del(self,true)
    end
end
_editor_class["Muki_AiC_shielder"]=Class(_object)
_editor_class["Muki_AiC_shielder"].init=function(self,_x,_y,boss)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.boss=boss
    self.active=false
    boss.shielder=self
end
_editor_class["Muki_AiC_shielder"].frame=function(self)
    self.class.base.frame(self)
    if player.nextspell>0 and self.active and not IsValid(self.boss.shield) and IsValid(self.boss) then
        PlaySound("se:Muki_AiC_shield",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_shield"],self.boss.x,self.boss.y,45,70,-2,1,self.boss,player.protect)
        self.boss.shield=last
    end
end
_editor_class["Muki_AiC_casting_aura"]=Class(_object)
_editor_class["Muki_AiC_casting_aura"].init=function(self,_x,_y,r,o,rot,t1,t2,master)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=r
    self.omiga2=o
    self.rot2=0
    self.rot=rot
    self.load=0
    self.t2=t2
    self.bound=false
    _connect(master,self,0,true)
    local a=(sqrt((5+2*sqrt(2))/4))
    local b=(0.3)
    self.aa=a
    self.bb=b
    lasttask=task.New(self,function()
        do
            local _beg_load=0 local load=_beg_load local _end_load=1.1 local _d_load=(_end_load-_beg_load)/(t1-1)
            for _=1,t1 do
                self.load=min(load,1)
                task._Wait(1)
                load=load+_d_load
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            _set_rel_pos(self,100*cos(self.rot),100*sin(self.rot),self.rot,false)
            if self.load>=1 then
                do local rot,_d_rot=(0),(90) for _=1,4 do
                    local x1, y1, x2, y2 =
                    	self.x + self.r * a * cos(rot + self.rot2),
                    	self.y + self.r * b * sin(rot + self.rot2),
                    	self.x + self.r * a * cos(rot + self.rot2 + 90),
                    	self.y + self.r * b * sin(rot + self.rot2 + 90)
                    x1, y1 = aic.math.rotate(x1, y1, self.rot+90, self.x, self.y)
                    x2, y2 = aic.math.rotate(x2, y2, self.rot+90, self.x, self.y)
                    last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6)
                    laser.ChangeImage(last, 4, COLOR_GRAY)
                    last.colli=false
                    _object.set_color(last,"mul+add",255,255,255,255)
                rot=rot+_d_rot end end
                do local rot,_d_rot=(45),(90) for _=1,4 do
                    local x1, y1, x2, y2 =
                    	self.x + self.r * a * cos(rot + self.rot2),
                    	self.y + self.r * b * sin(rot + self.rot2),
                    	self.x + self.r * a * cos(rot + self.rot2 + 90),
                    	self.y + self.r * b * sin(rot + self.rot2 + 90)
                    x1, y1 = aic.math.rotate(x1, y1, self.rot+90, self.x, self.y)
                    x2, y2 = aic.math.rotate(x2, y2, self.rot+90, self.x, self.y)
                    last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6)
                    laser.ChangeImage(last, 4, COLOR_GRAY)
                    last.colli=false
                    _object.set_color(last,"mul+add",255,255,255,255)
                rot=rot+_d_rot end end
            else
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local r=(ran:Float(0,self.r))
            local a=(ran:Float(0,360))
            last=New(_editor_class["Muki_AiC_casting_aura_ef"],self.x+r*cos(a),self.y+r*sin(a),ran:Float(1.5,3))
            task._Wait(10)
        end
    end)
end
_editor_class["Muki_AiC_casting_aura"].frame=function(self)
    self.class.base.frame(self)
    if self.timer>=self.t2 then
        for _=1,20 do
            local r=(ran:Float(50,100))
            local a=(ran:Float(0,360))
            last=New(_editor_class["Muki_AiC_casting_ef"],self.x+r*cos(a),self.y+r*sin(a),_)
        end
        _del(self,false)
    end
    self.rot2=self.rot2+self.omiga2
end
_editor_class["Muki_AiC_casting_aura"].render=function(self)
    SetImageState('white','mul+add',Color(255,255,255,255))
    SetImageState('parimg5','mul+add',Color(255,255,255,255))
    --有返回值的屑render（返回的是端点坐标）
    local x1,y1,x2,y2=aic.ui.RenderEclipseRing('white',self.x,self.y,self.r*self.aa-5,self.r*self.aa,90,self.rot+90,self.r*self.bb-5,self.r*self.bb,89-90*self.load,90+90*self.load)
    local x3,y3,x4,y4=aic.ui.RenderEclipseRing('white',self.x,self.y,self.r*self.aa-5,self.r*self.aa,90,self.rot+90,self.r*self.bb-5,self.r*self.bb,270-90*self.load,270+90*self.load)
    if self.load<1 then
    	Render('parimg5',x1,y1,0,1.5)
    	Render('parimg5',x2,y2,0,1.5)
    	Render('parimg5',x3,y3,0,1.5)
    	Render('parimg5',x4,y4,0,1.5)
    end
    self.class.base.render(self)
end
_editor_class["Muki_AiC_casting_aura_ef"]=Class(_object)
_editor_class["Muki_AiC_casting_aura_ef"].init=function(self,_x,_y,s)
    self.x,self.y=_x,_y
    self.img="parimg8"
    self.layer=LAYER_ENEMY_BULLET-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=s
    self.hscale=s
    _object.set_color(self,"",150,67,78,206)
    SetV2(self,2,90,true,false)
    lasttask=task.New(self,function()
        task._Wait(15)
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_casting_aura_ef"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_casting_aura_ef"].render=function(self)
    SetImageState('parimg8','mul+add',Color(255,0,255,255))
    Render('parimg8',self.x,self.y,self.rot,self.vscale)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_casting_ef"]=Class(_object)
_editor_class["Muki_AiC_casting_ef"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=0.75
    self.hscale=0.75
    SetV2(self,0.2,ran:Float(0,360),false,false)
    _object.set_color(self,"mul+add",0,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(15-1)
            for _=1,15 do
                _object.set_color(self,"mul+add",al,255,255,255)
                task._Wait(1)
                al=al+_d_al
            end
        end
        task._Wait(30)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_casting_ef"].del=function(self)
    PreserveObject(self)
    lasttask=task.New(self,function()
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(15-1)
            local _beg_s=0.75 local s=_beg_s local _end_s=0.5 local _d_s=(_end_s-_beg_s)/(15-1)
            for _=1,15 do
                _object.set_color(self,"mul+add",al,255,255,255)
                self.vscale=s
                self.hscale=s
                task._Wait(1)
                al=al+_d_al
                s=s+_d_s
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef1"]=Class(laser_bent)
_editor_class["Muki_AiC_Primula_cast_ef1"].init=function(self,_x,_y,x,y,a,r)
    laser_bent.init(self,COLOR_GRAY,_x,_y,32,2,4,0)
    self.bound=false
    self.group=GROUP_GHOST
    lasttask=task.New(self,function()
        anchor={}
        local n = int(r/10)
        local s = ran:Sign()
        for i = 1, n do
            local t = (n - i)*10
            table.insert(anchor,x + t * cos(a + s * i * 10))
            table.insert(anchor,y + t * sin(a + s * i * 10))
        end
        task.BezierMoveTo(10,MODE_NORMAL,unpack(anchor))
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef2"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef2"].init=function(self,_x,_y,x,y,a,r)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.rot=ran:Float(0,360)
    self.omiga=-5
    self.vscale=0.5
    self.hscale=0.5
    _object.set_color(self,"mul+add",150,50,ran:Int(100,150),ran:Int(200,255))
    lasttask=task.New(self,function()
        do
            local _beg_rr=r local rr=_beg_rr local _end_rr=0 local _w_rr=0  local _d_w_rr=1/(15-1)
            local _beg_s=0.5 local s=_beg_s local _end_s=0.4 local _w_s=0  local _d_w_s=1/(15-1)
            local _beg_al=150 local al=_beg_al local _end_al=0 local _w_al=0  local _d_w_al=1/(15-1)
            for _=1,15 do
                self.x=x+rr*cos(a)
                self.y=y+rr*sin(a)
                self.vscale=s
                self.hscale=s
                _object.set_color(self,"mul+add",al,self._r,self._g,self._b)
                task._Wait(1)
                _w_rr=_w_rr+_d_w_rr rr=(_end_rr-_beg_rr)*_w_rr^2+_beg_rr
                _w_s=_w_s+_d_w_s s=(_end_s-_beg_s)*_w_s^2+_beg_s
                _w_al=_w_al+_d_w_al al=(_end_al-_beg_al)*_w_al^2+_beg_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef3"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef3"].init=function(self,_x,_y,t)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef2"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=0.3
    self.hscale=0.3
    _object.set_color(self,"mul+add",25,50,100,255)
    lasttask=task.New(self,function()
        do
            local _beg_s=0.3 local s=_beg_s local _end_s=0.8 local _d_s=(_end_s-_beg_s)/(t-1)
            local _beg_al=25 local al=_beg_al local _end_al=50 local _d_al=(_end_al-_beg_al)/(t-1)
            for _=1,t do
                self.vscale=s
                self.hscale=s
                _object.set_color(self,"mul+add",al,50,100,255)
                task._Wait(1)
                s=s+_d_s
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef4"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef4"].init=function(self,_x,_y,t)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef3"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=0.8
    self.hscale=1.2
    self.rot=ran:Float(0,360)
    self.omiga=ran:Float(-0.5,0.5)
    _object.set_color(self,"mul+add",100,50,100,255)
    lasttask=task.New(self,function()
        do
            local _beg_s=0.8 local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(t-1)
            local _beg_al=100 local al=_beg_al local _end_al=50 local _d_al=(_end_al-_beg_al)/(t-1)
            for _=1,t do
                self.vscale=s
                self.hscale=s*3/2
                _object.set_color(self,"mul+add",al,50,100,255)
                task._Wait(1)
                s=s+_d_s
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef4"].render=function(self)
    SetImageCenter('image:Muki_AiC_Primula_cast_ef3',55,128)
    self.class.base.render(self)
    SetImageCenter('image:Muki_AiC_Primula_cast_ef3',128,128)
end
_editor_class["Muki_AiC_spell_ui"]=Class(_object)
_editor_class["Muki_AiC_spell_ui"].init=function(self,_x,_y,r,choice,dir,t,slow,newskill)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=0
    self.dir=dir
    self.choice=choice or 1
    self.t=t or 20
    self.slow=slow or 4
    self.bold={4,4,4,4}
    self.scale={0.3,0.3,0.3,0.3}
    self.scale2={3*3/5,3*3/5,3*3/5,3*3/5}
    self.rot2={45,45,45,45}
    self.newskill=newskill
    lasttask=task.New(self,function()
        do
            local _beg_rr=0 local rr=_beg_rr local _end_rr=r local _d_rr=(_end_rr-_beg_rr)/(10)
            for _=1,10 do
                self.r=rr
                task._Wait(1)
                rr=rr+_d_rr
            end
        end
        self.choice=choice
        lstg.var.timeslow=self.slow
        task._Wait(self.t-10)
        lstg.var.timeslow=nil
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_spell_ui"].frame=function(self)
    if self.choice==1 then
    	self.bold={3,4,4,4}
    	self.scale={0.32,0.3,0.3,0.3}
    	self.scale2={3.2*3/5,3*3/5,3*3/5,3*3/5}
    	self.rot2={0,45,45,45}
    elseif self.choice==2 then
    	self.bold={4,3,4,4}
    	self.scale={0.3,0.32,0.3,0.3}
    	self.scale2={3*3/5,3.2*3/5,3*3/5,3*3/5}
    	self.rot2={45,0,45,45}
    elseif self.choice==3 then
    	self.bold={4,4,3,4}
    	self.scale={0.3,0.3,0.32,0.3}
    	self.scale2={3*3/5,3*3/5,3.2*3/5,3*3/5}
    	self.rot2={45,45,0,45}
    else
    	self.bold={4,4,4,3}
    	self.scale={0.3,0.3,0.3,0.32}
    	self.scale2={3*3/5,3*3/5,3*3/5,3.2*3/5}
    	self.rot2={45,45,45,0}
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_spell_ui"].render=function(self)
    SetImageState('white','',Color(min(150,self.timer*10),0,0,0))
    Render4V('white',
    	-192,224,0.5,
    	192,224,0.5,
    	192,-224,0.5,
    	-192,-224,0.5
    )
    SetImageState('image:Muki_AiC_square3','mul+add',Color(200,255,255,255))
    SetImageState('image:Muki_AiC_square4','mul+add',Color(255,255,255,255))
    Render('image:Muki_AiC_square'..self.bold[1],self.x,self.y,self.rot2[1],self.scale2[1])
    Render('image:Muki_AiC_square'..self.bold[2],self.x,self.y-self.r,self.rot2[2],self.scale2[2])
    Render('image:Muki_AiC_square'..self.bold[3],self.x+self.r*self.dir,self.y,self.rot2[3],self.scale2[3])
    Render('image:Muki_AiC_square'..self.bold[4],self.x,self.y+self.r,self.rot2[4],self.scale2[4])
    Render('image:Muki_AiC_spell1',self.x,self.y,0,self.scale[1])
    Render('image:Muki_AiC_spell2',self.x,self.y-self.r,0,self.scale[2])
    Render('image:Muki_AiC_spell3',self.x+self.r*self.dir,self.y,0,self.scale[3])
    if self.newskill then
        SetImageState('image:Muki_AiC_spell' .. self.newskill,'mul+add',Color(255,255,255,255))
        Render('image:Muki_AiC_spell'..self.newskill,self.x,self.y+self.r,0,self.scale[4])
    end
end
_editor_class["Muki_AiC_boss_image"]=Class(_object)
_editor_class["Muki_AiC_boss_image"].init=function(self,_x,_y,img,master,n,t,intv,rep1,rep2,s)
    self.x,self.y=_x,_y
    self.img=img..1
    self.layer=LAYER_ENEMY
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    s=s or 1
    self._img=img
    self.n=n--图片数量
    self.master=master--绑定对象
    self.t=t--持续时间
    self.intv=intv or 6--动画间隔
    self.rep1=rep1 or 1
    self.rep2=rep2 or n--重复部分（第一次到达rep2后重复播放rep1-rep2）
    self.vscale=s
    self.hscale=s
    self.timer=1--让timer从1开始
    self.pos=1--当前图片编号
    self._hide=master.hide
end
_editor_class["Muki_AiC_boss_image"].frame=function(self)
    if self.del then
        self.master.hide=self._hide
        _del(self,false)
    else
    end
    if self.timer>=self.t then
        self.master.hide=self._hide
        _del(self,false)
    else
        if not (self.timer<=1) then
            self.master.hide=true
        else
        end
    end
    self.x=self.master.x
    self.y=self.master.y
    if self.timer%self.intv==0 then
        self.pos=self.pos+1
        if self.pos>self.n then
            self.pos=self.rep1--回到循环开始处
            self.flag=true--标记行走图已循环一次
        else
            if self.pos>self.rep2 and self.flag then
                self.pos=self.rep1--回到循环开始处
            end
        end
    end
    self.img=self._img..self.pos    self.class.base.frame(self)
end
_editor_class["Muki_AiC_boss_image_ex"]=Class(_object)
_editor_class["Muki_AiC_boss_image_ex"].init=function(self,_x,_y,img,master,n,t,intv,rep1,rep2,s,hide)
    self.x,self.y=_x,_y
    self.img=img..1
    self.layer=LAYER_ENEMY
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    s=s or 1
    self._img=img
    self.n=n--图片数量
    self.master=master--绑定对象
    self.t=t--持续时间
    self.intv=intv--动画间隔
    self.rep1=rep1 or 1
    self.rep2=rep2 or n--重复部分（第一次到达rep2后重复播放rep1-rep2）
    self.vscale=s
    self.hscale=s
    self.pos=1--当前图片编号
    self._hide=_hide or master.hide
end
_editor_class["Muki_AiC_boss_image_ex"].frame=function(self)
    if self.del then
        self.master.hide=self._hide
        _del(self,false)
    else
    end
    if self.timer>=self.t then
        self.master.hide=self._hide
        _del(self,false)
    else
        if not (self.timer<=1) then
            self.master.hide=true
        else
        end
    end
    self.x=self.master.x
    self.y=self.master.y
    local t=(aic.table.Sum(self.intv,1,self.pos))
    if self.timer==t then
        self.pos=self.pos+1
        if self.pos>self.n then
            self.pos=self.rep1--回到循环开始处
            self.timer=aic.table.Sum(self.intv,1,self.rep1)--重置timer
            self.flag=true--标记行走图已循环一次
        else
            if self.pos>self.rep2 and self.flag then
                self.timer=aic.table.Sum(self.intv,1,self.rep1)--重置timer
                self.pos=self.rep1--回到循环开始处
            end
        end
    end
    self.img=self._img..self.pos    self.class.base.frame(self)
end
_editor_class["Muki_AiC_line"]=Class(laser)
_editor_class["Muki_AiC_line"].init=function(self,_x,_y,x1,y1,x2,y2,w,hide,notraw)
    laser.init(self,COLOR_CYAN,_x,_y,0,Dist(x1,y1,x2,y2)/6,Dist(x1,y1,x2,y2)/6*4,Dist(x1,y1,x2,y2)/6,w,0,0)
    laser.ChangeImage(self,4)
    self.rot=Angle(x1,y1,x2,y2)
    self.bound=false
    lasttask=task.New(self,function()
        if hide then
            self.layer=LAYER_ENEMY-5
            laser._TurnOn(self,1,false,true)
        else
            laser._TurnOn(self,1,false,true)
        end
        if notraw then
            _del(self,true)
        else
            _del(self,false)
        end
    end)
end
_editor_class["Muki_AiC_warning_line"]=Class(laser)
_editor_class["Muki_AiC_warning_line"].init=function(self,_x,_y,a1,a2,t)
    laser.init(self,COLOR_CYAN,_x,_y,0,0,114514,0,4,0,0)
    laser.ChangeImage(self,4)
    lasttask=task.New(self,function()
        self.rot=a2 or a1
        laser._TurnHalfOn(self,1,false)
        if a2 then
            do
                local _beg_a=a2 local a=_beg_a local _end_a=a1 local _w_a=0 local _d_w_a=1/(t-1)
                for _=1,t do
                    self.rot=a
                    task._Wait(1)
                    _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
                end
            end
        else
            task._Wait(t)
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_stage_mask"]=Class(_object)
_editor_class["Muki_AiC_stage_mask"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_BG+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale=114514
    self.vscale=114514
    self.dp=0
end
_editor_class["Muki_AiC_stage_mask"].frame=function(self)
    _object.set_color(self,"",min(int(((self.timer/7800*0.7)+self.dp)*255),0.7*255),0,0,60)
end
_editor_class["Muki_AiC_stage_logo"]=Class(_object)
_editor_class["Muki_AiC_stage_logo"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.al1=0
    self.al2=0
    self.al3=255
    self.al4=0
    self.p=0
    self.x1=30
    self.y1=60
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.al1=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.al2=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(60-1)
            local _beg_p=0 local p=_beg_p local _end_p=1 local _d_p=(_end_p-_beg_p)/(60-1)
            local _beg_x=30 local x=_beg_x local _end_x=0 local _d_x=(_end_x-_beg_x)/(60-1)
            for _=1,60 do
                --self.al2=255-al
                self.al4=al
                self.p=p
                self.x1=x
                task._Wait(1)
                al=al+_d_al
                p=p+_d_p
                x=x+_d_x
            end
        end
        task._Wait(180)
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                self.al1=al
                self.al2=al
                self.al3=al
                self.al4=al
                task._Wait(1)
                al=al+_d_al
            end
        end
    end)
end
_editor_class["Muki_AiC_stage_logo"].render=function(self)
    SetImageState('image:Muki_AiC_stex_logo1','',Color(self.al1,255,255,255))
    SetImageState('image:Muki_AiC_stex_logo2','',Color(self.al2,255,255,255))
    SetImageState('image:Muki_AiC_stex_logo3','',Color(self.al3,255,255,255))
    SetImageState('image:Muki_AiC_stex_logo4','',Color(self.al4,255,255,255))
    Render('image:Muki_AiC_stex_logo1',0,130,0,0.6,0.6)
    Render('image:Muki_AiC_stex_logo2',0,105,0,0.8,0.8)
    --Render('image:Muki_AiC_stex_logo3',0,105,0,0.8,0.8)
    RenderTexture('image:Muki_AiC_stex_logo3','',
        {-227/2*0.8,105+38/2*0.8,0.5,0,0,Color(self.al3,255,255,255)},
        {(-227/2+self.p*227)*0.8,105+38/2*0.8,0.5,227*self.p,0,Color(self.al3,255,255,255)},
        {(-227/2+self.p*227)*0.8,105-38/2*0.8,0.5,227*self.p,38,Color(self.al3,255,255,255)},
        {-227/2*0.8,105-38/2*0.8,0.5,0,38,Color(self.al3,255,255,255)})
    Render('image:Muki_AiC_stex_logo4',self.x1,80)
end
_editor_class["Muki_AiC_stage_background_changer"]=Class(_object)
_editor_class["Muki_AiC_stage_background_changer"].init=function(self,_x,_y,bg,t1,t2)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    t2=t2 or t1
    self.al=0
    lasttask=task.New(self,function()
lasttask=task.New(self,function () ex.SmoothSetValueTo("al",255,t1,MOVE_NORMAL,nil,0,MODE_SET) end )
        task._Wait(t1)
        New(bg)
lasttask=task.New(self,function () ex.SmoothSetValueTo("al",0,t2,MOVE_NORMAL,nil,0,MODE_SET) end )
        task._Wait(t2)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_stage_background_changer"].render=function(self)
    SetImageState('white','',Color(self.al,0,0,0))
    RenderRect('white',-192,192,-224,224)
end
_editor_class["Muki_AiC_stage_Yukari_portal"]=Class(_object)
_editor_class["Muki_AiC_stage_Yukari_portal"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Yukari_portal1"
    self.layer=LAYER_BG+5
    self.group=GROUP_SPELL
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    s=2.5
    self._img='image:Muki_AiC_Yukari_portal'
    self.n=6--图片数量
    self.master=master--绑定对象
    self.t=t--持续时间
    self.intv=6--动画间隔
    self.vscale=s
    self.hscale=s
    self.timer=1--让timer从1开始
    self.pos=1--当前图片编号
    self.a=150
    self.b=75
end
_editor_class["Muki_AiC_stage_Yukari_portal"].frame=function(self)
    self.a=302.5
    self.b=152.5
    if self.timer%self.intv==0 then
        self.pos=min(self.pos+1,self.n)
        self.flag1=true
    end
    if self.timer>=180 and self.flag1 and aic.math.IsInRect(player.x,player.y,self.x-self.a,self.x+self.a,self.y-self.b,self.y+self.b) then
        last=New(_editor_class["Muki_AiC_stage_background_changer"],0,0,Muki_AiC_background,120)
        self.flag2=true
    end
    self.img=self._img..self.pos    self.class.base.frame(self)
end
_editor_class["Muki_AiC_watershard"]=Class(bullet)
_editor_class["Muki_AiC_watershard"].init=function(self,_x,_y,master,r,o)
bullet.init(self,water_drop,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    _connect(master,self,0,true)
    self.state='rotating'
    self.navi=true
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.state=='rotating' then
                _set_rel_pos(self,r*cos(o*self.timer),r*sin(o*self.timer),self.rot,false)
            else
                do break end
            end
            task._Wait(1)
        end
        task.MoveToEx(sign(master.x-self.x)*30,30,ran:Int(10,30),MOVE_DECEL)
        local a
        if self.state=='aiming' then
            a=Angle(self,player)
        else
            a=Angle(self.x,self.y,ran:Float(-120,120),player.y)
        end
        self.rot=a
        last=New(_editor_class["Muki_AiC_warning_line"],self.x,self.y,a,nil,60)
        task._Wait(60)
        SetV2(self,4,a,true,false)
        lasttask=task.New(self,function()
            local r=(25)
            for _=1,_infinite do
                if self.y<-150 then break end
                do
                    local _beg_a=0 local a=_beg_a local _end_a=180 local _d_a=(_end_a-_beg_a)/(8)
                    for _=1,8 do
                        do
                            local s=1 local _n_s=(1)+(-1)
                            for _=1,2 do
                                last=New(_straight,kite,COLOR_CYAN,self.x+r*cos(a),self.y+r*sin(a),4,a,false,0,true,true,0,false,0,0,0,false)
                                lasttask=task.New(last,function()
                                    local self=task.GetSelf()
                                    _set_g(self,0.025)
                                    for _=1,_infinite do
                                        if self.x<=-192 or self.x>=192 then
                                            self.vx=-self.vx*0.5
                                            do break end
                                        elseif self.x<=-224 or self.x>=224 then
                                            self.vy=-self.vy*0.5
                                            do break end
                                        else
                                        end
                                        task._Wait(1)
                                    end
                                end)
                                last.navi=true
                                s=-(s)+_n_s
                            end
                        end
                        a=a+_d_a
                    end
                end
                task._Wait(30)
            end
        end)
    end)
end
_editor_class["Muki_AiC_watershard"].render=function(self)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_melee"]=Class(laser_bent)
_editor_class["Muki_AiC_melee"].init=function(self,_x,_y,dir)
    laser_bent.init(self,COLOR_GRAY,_x,_y,30,8,4,0)
    lasttask=task.New(self,function()
        task.BezierMoveTo(30,MOVE_DECEL,self.x+100*dir,self.y,self.x+175*dir*cos(-30),self.y+100*sin(-30),self.x,self.y-75,self.x-100*dir,self.y-90)
    end)
    lasttask=task.New(self,function()
        for _=1,24 do
            last=New(_straight,ball_mid_c,COLOR_GRAY,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(15)
                self.angle=Angle(self,_boss)+180
                ChangeBulletImage(self,ball_mid_c,COLOR_CYAN)
                SetV2(self,1,self.angle,true,false)
                _set_a(self,0.05,self.angle,false)
            end)
            task._Wait(1)
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_bomb"]=Class(bullet)
_editor_class["Muki_AiC_bomb"].init=function(self,_x,_y,v,a,rot,r)
bullet.init(self,ball_mid,COLOR_GRAY,true,true)
self.x,self.y=_x,_y
    SetV2(self,v,rot,true,false)
    _set_a(self,a,rot,false)
    self.colli=false
    self.r=r
    self.k=0
    _object.set_color(self,"mul+add",200,74,142,171)
    lasttask=task.New(self,function()
        for _=1,420 do
            if Dist(self,player)<=r then break end
            task._Wait(1)
        end
        PlaySound("se:Muki_AiC_bomb_explode",1,self.x/256,true)
        task._Wait(30)
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(24)
            for _=1,24 do
                last=New(_straight,ball_mid_c,COLOR_BLUE,self.x,self.y,3,a,false,0,true,true,0,false,0,0,0,false)
                a=a+_d_a
            end
        end
        do
            local _beg_v=5 local v=_beg_v local _end_v=2 local _d_v=(_end_v-_beg_v)/(5-1)
            local n=1 local _d_n=(2)
            for _=1,5 do
                do local aa,_d_aa=(-1/2*(2*n-1)),(2) for _=1,n do
                    last=New(_straight,arrow_big,COLOR_BLUE,self.x,self.y,v,aa,true,0,true,true,0,false,0,0,0,false)
                aa=aa+_d_aa end end
                v=v+_d_v
                n=n+_d_n
            end
        end
        PlaySound("don00",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,0.75,{67,78,206})
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if (self.x>=192 or self.x<=-192) then
                self.vx,self.vy=-self.vx,self.vy
                self.rot=atan2(self.vy,self.vx)
                self.ax,self.ay=-self.ax,self.ay
                do break end
            elseif self.y>=224 or self.y<=-224 then
                self.vx,self.vy=self.vx,-self.vy
                self.rot=atan2(self.vy,self.vx)
                self.ax,self.ay=self.ax,-self.ay
                do break end
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self._speed<=0.1 then break end
            task._Wait(1)
        end
        SetV2(self,0,self.rot,true,false)
        _set_a(self,0,0,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_bomb_ef"],self.x,self.y,self,6,ran:Float(0,360))
            do local k,_d_k=(0),(1/30) for _=1,30 do
                self.k=k
                task._Wait(1)
            k=k+_d_k end end
        end
    end)
end
_editor_class["Muki_AiC_bomb"].render=function(self)
    self.class.base.render(self)
    SetImageState('white','mul+add',Color(255,67,78,206))
    aic.ui.RenderEclipseRing('white',self.x,self.y,self.r*self.k-5,self.r*self.k)
end
_editor_class["Muki_AiC_bomb_ef"]=Class(_object)
_editor_class["Muki_AiC_bomb_ef"].init=function(self,_x,_y,master,s,rot)
    self.x,self.y=_x,_y
    self.img="parimg5"
    self.layer=LAYER_ENEMY_BULLET-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _connect(master,self,0,true)
    self.rot=rot
    self.vscale=0
    self.hscale=0
    _object.set_color(self,"mul+add",255,67,78,206)
    SetV2(self,ran:Float(0.25,0.45),90,true,false)
    lasttask=task.New(self,function()
        do
            local _beg_scale=0 local scale=_beg_scale local _end_scale=s local _d_scale=(_end_scale-_beg_scale)/(15-1)
            for _=1,15 do
                self.vscale=scale
                self.hscale=scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        do
            local _beg_scale=s local scale=_beg_scale local _end_scale=0 local _d_scale=(_end_scale-_beg_scale)/(15-1)
            for _=1,15 do
                self.vscale=scale
                self.hscale=scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_bomb_ef"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_bomb_ef"].render=function(self)
    SetImageState('parimg8','mul+add',Color(255,67,78,206))
    Render('parimg8',self.x,self.y,self.rot,self.vscale)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_nuclear"]=Class(_object)
_editor_class["Muki_AiC_nuclear"].init=function(self,_x,_y,s,co,bossdmg)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_nuclear"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_INDES
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.a=0
    self.b=0
    self.vscale=0
    self.hscale=0
    self.co=co or {238,100,100}
    _boss.dmgsign=false
    _object.set_color(self,"mul+add",255,self.co[1],self.co[2],self.co[3])
    lasttask=task.New(self,function()
        PlaySound("boon01",4,self.x/256,true)
        do
            local _beg_scale=0 local scale=_beg_scale local _end_scale=s local _d_scale=(_end_scale-_beg_scale)/(30-1)
            for _=1,30 do
                self.vscale=scale
                self.hscale=scale
                self.a=100*scale
                self.b=100*scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        task._Wait(30)
        do
            local _beg_scale=s local scale=_beg_scale local _end_scale=0 local _d_scale=(_end_scale-_beg_scale)/(30-1)
            for _=1,30 do
                self.vscale=scale
                self.hscale=scale
                self.a=100*scale
                self.b=100*scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_nuclear"].frame=function(self)
    if bossdmg and IsValid(_boss) then
        ColliCheck(self,_boss)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_nuclear"].colli=function(self,other)
    if other==_boss and not other.dmgsign then
        other.dmgsign=true
        other.hp=other.hp-200
    end
    self.class.base.colli(self,other)
end
_editor_class["Muki_AiC_nuclear"].render=function(self)
    --[[ 简单易懂的透明度倍增法（
    ]]
    for _=1,3 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_nuclear"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_melee_casting"]=Class(laser_bent)
_editor_class["Muki_AiC_melee_casting"].init=function(self,_x,_y,dir,type)
    laser_bent.init(self,COLOR_GRAY,_x,_y,30,40,0,0)
    lasttask=task.New(self,function()
        task.BezierMoveTo(30,MOVE_DECEL,self.x+100*dir,self.y,self.x+175*dir*cos(-30),self.y+100*sin(-30),self.x,self.y-75,self.x-100*dir,self.y-90)
    end)
    lasttask=task.New(self,function()
        if type==1 then
            for _=1,24 do
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                    for _=1,8 do
                        do
                            local a = a
                            do
                                last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,0,a,false,0,true,true,0,false,0,0,0,false)
                                lasttask=task.New(last,function()
                                    local self=task.GetSelf()
                                    task._Wait(15)
                                    self.angle=Angle(self,_boss)+180+a
                                    ChangeBulletImage(self,ball_mid_c,COLOR_BLUE)
                                    SetV2(self,1,self.angle,true,false)
                                    _set_a(self,0.05,self.angle,false)
                                    _forbid_v(self,3,'original','original')
                                end)
                            end
                        end
                        a=a+_d_a
                    end
                end
                task._Wait(1)
            end
        elseif type==2 then
            for _=1,24 do
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                    for _=1,8 do
                        a=a+_d_a
                    end
                end
                task._Wait(1)
            end
        else
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_bow"]=Class(_object)
_editor_class["Muki_AiC_bow"].init=function(self,_x,_y,a,aiming)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_bow"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_ENEMY_BULLET
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale1=0.5
    self.vscale1=0.5
    self.hscale2=1
    self.vscale2=0.25
    self.hscale=self.hscale1
    self.vscale=self.vscale1
    self.rot=a
    local d=40
    self.x1,self.y1=aic.math.rotate(self.x,self.y+217/4,a,self.x,self.y)
    self.x2,self.y2=aic.math.rotate(self.x,self.y-217/4,a,self.x,self.y)
    self.x3,self.y3=aic.math.rotate(self.x,self.y,a,self.x,self.y)
    local x,y=aic.math.rotate(self.x-20,self.y,a,self.x,self.y)
    if aiming then
        last=New(_editor_class["Muki_AiC_white_arrow_aiming"],x,y,4,a,5)
    else
        last=New(_editor_class["Muki_AiC_white_arrow"],x,y,5,a,5)
    end
    lasttask=task.New(self,function()
        task._Wait(10)
        do
            local _beg_h=self.hscale1 local h=_beg_h local _end_h=self.hscale2 local _d_h=(_end_h-_beg_h)/(10-1)
            local _beg_v=self.vscale1 local v=_beg_v local _end_v=self.vscale2 local _d_v=(_end_v-_beg_v)/(10-1)
            local _beg_x=self.x local x=_beg_x local _end_x=self.x+d/2 local _d_x=(_end_x-_beg_x)/(10-1)
            local _beg_dy=0 local dy=_beg_dy local _end_dy=217/8 local _d_dy=(_end_dy-_beg_dy)/(10-1)
            for _=1,10 do
                self.hscale=h
                self.vscale=v
                self.x1,self.y1=aic.math.rotate(x,self.y+217/4-dy,a,self.x,self.y)
                self.x2,self.y2=aic.math.rotate(x,self.y-217/4+dy,a,self.x,self.y)
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                h=h+_d_h
                v=v+_d_v
                x=x+_d_x
                dy=dy+_d_dy
            end
        end
        do
            local _beg_x=self.x+d/2 local x=_beg_x local _end_x=self.x+d*3/2 local _d_x=(_end_x-_beg_x)/(10-1)
            for _=1,10 do
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                x=x+_d_x
            end
        end
        do
            local _beg_h=self.hscale2 local h=_beg_h local _end_h=self.hscale1 local _d_h=(_end_h-_beg_h)/(10-1)
            local _beg_v=self.vscale2 local v=_beg_v local _end_v=self.vscale1 local _d_v=(_end_v-_beg_v)/(10-1)
            local _beg_x=self.x+d*3/2 local x=_beg_x local _end_x=self.x+d/2 local _d_x=(_end_x-_beg_x)/(10-1)
            local _beg_dy=217/8 local dy=_beg_dy local _end_dy=0 local _d_dy=(_end_dy-_beg_dy)/(10-1)
            for _=1,10 do
                self.hscale=h
                self.vscale=v
                self.x1,self.y1=aic.math.rotate(x,self.y+217/4-dy,a,self.x,self.y)
                self.x2,self.y2=aic.math.rotate(x,self.y-217/4+dy,a,self.x,self.y)
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                h=h+_d_h
                v=v+_d_v
                x=x+_d_x
                dy=dy+_d_dy
            end
        end
        task._Wait(30)
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,49 do
            last=New(_editor_class["Muki_AiC_line"],self.x1,self.y1,self.x1,self.y1,self.x3,self.y3,1)
            _object.set_color(last,"add+add",255,255,255,255)
            last=New(_editor_class["Muki_AiC_line"],self.x2,self.y2,self.x2,self.y2,self.x3,self.y3,1)
            _object.set_color(last,"add+add",255,255,255,255)
            task._Wait(1)
        end
        last=New(_editor_class["Muki_AiC_line"],self.x1,self.y1,self.x1,self.y1,self.x3,self.y3,1,false,true)
        _object.set_color(last,"add+add",255,255,255,255)
        last=New(_editor_class["Muki_AiC_line"],self.x2,self.y2,self.x2,self.y2,self.x3,self.y3,1,false,true)
        _object.set_color(last,"add+add",255,255,255,255)
    end)
end
_editor_class["Muki_AiC_white_arrow"]=Class(bullet)
_editor_class["Muki_AiC_white_arrow"].init=function(self,_x,_y,v,a,s)
bullet.init(self,arrow_mid,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    self.hscale=s*2
    self.vscale=s
    self.a=self.a*s
    self.b=self.b*s
    self.group=GROUP_INDES
    self.rot=a
    self.colli=false
    self.timer=11
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_v=s local v=_beg_v local _end_v=s/2 local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        do
            local _beg_h=s*2 local h=_beg_h local _end_h=s local _d_h=(_end_h-_beg_h)/(10-1)
            for _=1,10 do
                self.hscale=h
                task._Wait(1)
                h=h+_d_h
            end
        end
        do
            local _beg_v=s/2 local v=_beg_v local _end_v=s local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        self.colli=true
        SetV2(self,v,a,true,false)
        do local t,_d_t=(1),(1) for _=1,_infinite do
            if Dist(self,player)>25 and self.y>-200 then
                PlaySound("kira00",0.1,self.x/256,false)
                do
                    local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(12)
                    for _=1,12 do
                        local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                        local d=(Dist(x,y,self.x,self.y))
                        local rot=(Angle(x,y,self.x,self.y))
                        last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                                for _=1,30 do
                                    task._Wait(1)
                                    v=v+_d_v
                                end
                            end
                        end)
                        aa=aa+_d_aa
                    end
                end
            else
            end
            task._Wait(t)
        t=t+_d_t end end
    end)
end
_editor_class["Muki_AiC_white_arrow"].render=function(self)
    for _=1,2 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_fireball_small"]=Class(bullet)
_editor_class["Muki_AiC_fireball_small"].init=function(self,_x,_y,v,a)
bullet.init(self,ball_light,COLOR_BLUE,true,true)
self.x,self.y=_x,_y
    self.hscale=0.5
    self.vscale=0.5
    self.a=self.a*0.5
    self.b=self.b*0.5
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        for _=1,2 do
            task._Wait(20)
            local aa=(Muki_get8dir(self,player))
            if aa~=self.rot then
                do
                    local _beg_vv=0 local vv=_beg_vv local _end_vv=2.5 local _d_vv=(_end_vv-_beg_vv)/(60-1)
                    for _=1,60 do
                        SetV2(self,vv,aa,true,false)
                        task._Wait(1)
                        vv=vv+_d_vv
                    end
                end
            else
                task._Wait(60)
            end
        end
    end)
end
_editor_class["Muki_AiC_fireball_small"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fireball_small"].del=function(self)
    PreserveObject(self)
    last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,0.5,{67,78,206},true)
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_fireball"]=Class(bullet)
_editor_class["Muki_AiC_fireball"].init=function(self,_x,_y,v,a)
bullet.init(self,ball_light,COLOR_BLUE,true,true)
self.x,self.y=_x,_y
    self.aa=self.a
    self.bb=self.b
    self.a=self.a*2
    self.b=self.b*2
    self.vscale=2
    self.hscale=2
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.25,self.x/256,true)
            for _=1,3 do
                local aa=(ran:Float(0,360))
                local r=(ran:Float(0,30)+self.a/2)
                last=New(_straight,grain_a,COLOR_BLUE,self.x+r*cos(aa),self.y+r*sin(aa),ran:Float(0.5,1),aa,false,0,true,true,0,false,0.05,aa,2.5,false)
            end
            task._Wait(10)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            do
                local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(12)
                for _=1,12 do
                    last=New(_straight,grain_c,COLOR_BLUE,self.x,self.y,1,aa,true,0,true,true,0,false,0,0,0,false)
                    aa=aa+_d_aa
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,ball_mid,COLOR_BLUE,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(90)
                SetV2(self,2.5,ran:Float(0,360),true,false)
            end)
            task._Wait(5)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,3 do
            task._Wait(60)
            local aa=(Muki_get8dir(self,player))
            if aa~=self.rot then
                do
                    local _beg_vv=0 local vv=_beg_vv local _end_vv=v local _d_vv=(_end_vv-_beg_vv)/(60-1)
                    for _=1,60 do
                        SetV2(self,vv,aa,true,false)
                        task._Wait(1)
                        vv=vv+_d_vv
                    end
                end
            else
                task._Wait(60)
            end
        end
    end)
    lasttask=task.New(self,function()
        do
            local _h_s=(2.4-(1.6))/2 local _t_s=(2.4+(1.6))/2 local s=_h_s*sin(0)+_t_s local _w_s=0 local _d_w_s=12
            for _=1,_infinite do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                _w_s=_w_s+_d_w_s s=_h_s*sin(_w_s)+_t_s
            end
        end
    end)
end
_editor_class["Muki_AiC_fireball"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fireball"].del=function(self)
    PreserveObject(self)
    last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,1,{67,78,206},true)
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_white_arrow_aiming"]=Class(bullet)
_editor_class["Muki_AiC_white_arrow_aiming"].init=function(self,_x,_y,v,a,s)
bullet.init(self,arrow_mid,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    self.hscale=s*2
    self.vscale=s
    self.a=self.a*s
    self.b=self.b*s
    self.group=GROUP_INDES
    self.rot=a
    self.colli=false
    self.timer=11
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_v=s local v=_beg_v local _end_v=s/2 local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        do
            local _beg_h=s*2 local h=_beg_h local _end_h=s local _d_h=(_end_h-_beg_h)/(10-1)
            for _=1,10 do
                self.hscale=h
                task._Wait(1)
                h=h+_d_h
            end
        end
        do
            local _beg_v=s/2 local v=_beg_v local _end_v=s local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        self.colli=true
        SetV2(self,v,a,true,false)
        do local t,_d_t=(3),(1) for _=1,_infinite do
            do
                local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(8)
                for _=1,8 do
                    local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                    local d=(Dist(x,y,self.x,self.y))
                    local rot=(Angle(x,y,self.x,self.y))
                    last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        do
                            local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                            for _=1,30 do
                                task._Wait(1)
                                v=v+_d_v
                            end
                        end
                    end)
                    aa=aa+_d_aa
                end
            end
            task._Wait(t)
        t=t+_d_t end end
    end)
    lasttask=task.New(self,function()
        task._Wait(30)
        for _=1,60 do
            SetV2(self,v,0,true,true)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_white_arrow_aiming"].render=function(self)
    for _=1,2 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_square_slave1"]=Class(_object)
_editor_class["Muki_AiC_square_slave1"].init=function(self,_x,_y,v,th,A,co)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    aic.misc.SineMove(self,self.x,self.y,v/2,th,A,75)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,grain_b,co,self.x,self.y,0,self.rot+180,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(30)
                _set_a(self,0.05,self.rot,false)
                _forbid_v(self,4,'original','original')
            end)
            task._Wait(3)
        end
    end)
end
_editor_class["Muki_AiC_square_slave2"]=Class(_object)
_editor_class["Muki_AiC_square_slave2"].init=function(self,_x,_y,v,a,r,co)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    SetV2(self,v,a,true,false)
    do
        local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
        for _=1,4 do
            last=New(_editor_class["Muki_AiC_square_star_big"],self.x,self.y,self,r,a,co)
            a=a+_d_a
        end
    end
    lasttask=task.New(self,function()
        for _=1,30 do
            SetV2(self,v,0,true,true)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_square_star_small"]=Class(bullet)
_editor_class["Muki_AiC_square_star_small"].init=function(self,_x,_y,a,co)
bullet.init(self,star_small,co,true,true)
self.x,self.y=_x,_y
    self.bound=false
    self.omiga=3
    SetV2(self,0,a,true,false)
    lasttask=task.New(self,function()
        task._Wait(15)
        _set_a(self,0.02,self.rot,false)
    end)
end
_editor_class["Muki_AiC_square_star_big"]=Class(bullet)
_editor_class["Muki_AiC_square_star_big"].init=function(self,_x,_y,master,r,a,co)
bullet.init(self,star_big,co,true,true)
self.x,self.y=_x,_y
    self.bound=false
    self.master=master
    self.omiga=-3
    _object.set_color(self,"mul+add",200,255,255,255)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if IsValid(self.master) then
                self.x=self.master.x+r*cos(self.timer+a)
                self.y=self.master.y+r*sin(self.timer+a)
            else
                _del(self,true)
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,_editor_tasks["Muki_smear"](self,3,10))
end
_editor_class["Muki_AiC_square_big"]=Class(bullet)
_editor_class["Muki_AiC_square_big"].init=function(self,_x,_y,v,a,co)
bullet.init(self,square,co,true,true)
self.x,self.y=_x,_y
    self.hscale=4
    self.vscale=4
    self.a=self.a*4
    self.b=self.b*4
    self.co=co
    _object.set_color(self,"mul+add",200,255,255,255)
    SetV2(self,v,a,true,false)
    last=New(_editor_class["Muki_AiC_square_slave1"],self.x,self.y,v,a,20,co)
    _connect(self,last,0,true)
    last=New(_editor_class["Muki_AiC_square_slave1"],self.x,self.y,v,a,-20,co)
    _connect(self,last,0,true)
    lasttask=task.New(self,function()
        do
            local _beg_vv=v local vv=_beg_vv local _end_vv=0 local _d_vv=(_end_vv-_beg_vv)/(60-1)
            for _=1,60 do
                SetV2(self,vv,self.rot,true,false)
                task._Wait(1)
                vv=vv+_d_vv
            end
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_square_big"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_square_big"].del=function(self)
    PreserveObject(self)
    PlaySound("enep02",0.1,self.x/256,false)
    last=New(_editor_class["Muki_AiC_square_slave2"],self.x,self.y,3,Angle(self,player),40,self.co)
    last=New(_editor_class["Muki_AiC_fog"],self.x,self.y,50,30,true)
    do
        local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
        for _=1,16 do
            last=New(_editor_class["Muki_AiC_square_star_small"],self.x,self.y,a,self.co)
            a=a+_d_a
        end
    end
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_fog"]=Class(_object)
_editor_class["Muki_AiC_fog"].init=function(self,_x,_y,r,t,s)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    --[[ 从古早的48th周活中掏出来的东西……
    ]]
    self.a=r
    self.b=r
    self.t=t
    self.al=255
    lasttask=task.New(self,function()
        if s then
            for _=1,_infinite do
                last=New(_editor_class["Muki_AiC_fog_ef"],self.x,self.y,s,self.al,30,1.2)
                task._Wait(1)
            end
        else
            for _=1,_infinite do
                for _=1,10 do
                    local k=(ran:Float(0,1))
                    local aa=(ran:Float(0,360))
                    last=New(_editor_class["Muki_AiC_fog_ef"],self.x,self.y,s,self.al,0,0)
                end
                task._Wait(1)
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(player,self)<=r and s then
                player.infog=true
                self.infog=true
            else
                if self.infog==true then
                    player.infog=false
                else
                end
            end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_fog"].frame=function(self)
    self.class.base.frame(self)
    if self.timer>=self.t then
        lasttask=task.New(self,function()
            do
                local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(15-1)
                for _=1,15 do
                    self.al=al
                    task._Wait(1)
                    al=al+_d_al
                end
            end
            _del(self,false)
        end)
    end
end
_editor_class["Muki_AiC_fog_ef"]=Class(_object)
_editor_class["Muki_AiC_fog_ef"].init=function(self,_x,_y,s,al,t,v)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    SetV2(self,ran:Float(0,v),ran:Float(0,360),true,false)
    self.scale=ran:Float(0.75,1.25)
    self.sign=s
    self.al=al
    self.t=t
    self.group=GROUP_GHOST
    self.layer=LAYER_ENEMY_BULLET+5
end
_editor_class["Muki_AiC_fog_ef"].frame=function(self)
    if self.timer>self.t or not self.sign then
        _del(self,false)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fog_ef"].render=function(self)
    if self.sign then
        RenderTTF('magic',string.char(ran:Int(97,122)),self.x,self.x,self.y,self.y,Color(self.al,255,255,255))
    else
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_Primula_cast_laser"]=Class(laser_bent)
_editor_class["Muki_AiC_Primula_cast_laser"].init=function(self,_x,_y,x,y,a,r)
    laser_bent.init(self,COLOR_GRAY,_x,_y,32,6,4,0)
    self.bound=false
    self.group=GROUP_GHOST
    lasttask=task.New(self,function()
        anchor={}
        local n = int(r/10)
        local s = ran:Sign()
        for i = 1, n do
            local t = (n - i)*10
            table.insert(anchor,x + t * cos(a + s * i * 10))
            table.insert(anchor,y + t * sin(a + s * i * 10))
        end
        task.BezierMoveTo(10,MODE_NORMAL,unpack(anchor))
        _del(self,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,star_small,COLOR_GRAY,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            last.rot=Angle(last,x,y)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                self.timer=11
                task._Wait(15)
                self.omiga=3
                ChangeBulletImage(self,star_small,COLOR_YELLOW)
                SetV2(self,1,self.rot,true,false)
                _set_a(self,0.05,self.rot,false)
                _forbid_v(self,'original','original',4)
            end)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_Primula_laser"]=Class(laser)
_editor_class["Muki_AiC_Primula_laser"].init=function(self,_x,_y,co,v,a,dir,dir2,n,bv)
    laser.init(self,co,_x,_y,0,0,114514,0,12,0,0)
    laser.ChangeImage(self,4)
    self.co=co
    self.rot=dir2*90
    bv=bv or 0
    lasttask=task.New(self,function()
        if co==COLOR_GRAY then
            laser._TurnHalfOn(self,1,false)
            if dir2==1 then
                local s=(ran:Sign())
                PlaySound("tan00",0.1,self.x/256,false)
                do local y,_d_y=(s*1000+ran:Float(-50,50)),(-s*2000/n) for _=1,n do
                    last=New(_editor_class["Muki_AiC_Primula_laser_bullet"],self.x,self.y,self,y,s*bv)
                y=y+_d_y end end
            end
        else
            laser._TurnOn(self,1,false,false)
        end
    end)
    lasttask=task.New(self,function()
        task.MoveToEx(dir*50,0,60,MOVE_DECEL)
        _set_a(self,a,(1-dir)*90,false)
        _forbid_v(self,v,'original','original')
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local move_orange=(KeyIsDown('up') or KeyIsDown('down') or KeyIsDown('left') or KeyIsDown('right'))
            local move_cyan=(player.dx~=0 or player.dy~=0)
            if self.co==COLOR_CYAN then
                if move_cyan then
                    laser._TurnOn(self,1,false,false)
                else
                    laser._TurnHalfOn(self,1,false)
                end
            elseif self.co==COLOR_ORANGE then
                if move_orange then
                    laser._TurnHalfOn(self,1,false)
                else
                    laser._TurnOn(self,1,false,false)
                end
            end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_Primula_laser_bullet"]=Class(bullet)
_editor_class["Muki_AiC_Primula_laser_bullet"].init=function(self,_x,_y,master,y,v)
bullet.init(self,ball_mid_c,COLOR_GRAY,true,false)
self.x,self.y=_x,_y
    _connect(master,self,0,true)
    self._y=y
    self.v=v
    self.bound=false
    self.timer=11
end
_editor_class["Muki_AiC_Primula_laser_bullet"].frame=function(self)
    self.class.base.frame(self)
    self._y=self._y+self.v
    _set_rel_pos(self,0,self._y,self.rot,false)
end
_editor_class["Muki_AiC_magic_authentication_device"]=Class(_object)
_editor_class["Muki_AiC_magic_authentication_device"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_magic_authentication_device"
    self.layer=LAYER_ENEMY+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.flag then break end
            task._Wait(1)
        end
        last=New(_editor_class["Muki_AiC_device_aura1"],self.x,self.y,self)
        last=New(_editor_class["Muki_AiC_device_aura2"],self.x,self.y,self)
        last=New(_editor_class["Muki_AiC_device_aura3"],self.x,self.y,self)
        last=New(_editor_class["Muki_AiC_device_aura4"],self.x,self.y,self)
        last=New(_editor_class["Muki_AiC_device_aura5"],self.x,self.y,self)
        last=New(_editor_class["Muki_AiC_cane_bg"],self.x,self.y,self)
        task._Wait(60)
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                _object.set_color(self,"",al,255,255,255)
                task._Wait(1)
                al=al+_d_al
            end
        end
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_random_text"],self.x,self.y,_)
            task._Wait(10)
        end
    end)
end
_editor_class["Muki_AiC_magic_authentication_device"].frame=function(self)
    self.class.base.frame(self)
    if self.del then
        _del(self,false)
    else
    end
    if self.timer%30==0 then
        self.r=ran:Float(25,50)
        self.a=ran:Float(0,360)
    else
    end
end
_editor_class["Muki_AiC_magic_authentication_device"].render=function(self)
    self.class.base.render(self)
    SetImageState('image:Muki_AiC_cast_ef2','',Color(255,255,255,255))
    Render('image:Muki_AiC_cast_ef2',self.x+self.r*cos(self.a),self.y+self.r*sin(self.a),0,0.2)
end
_editor_class["Muki_AiC_cane"]=Class(_object)
_editor_class["Muki_AiC_cane"].init=function(self,_x,_y,master,s)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_cane"
    self.layer=LAYER_ENEMY+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.rot=75
    self.hscale=s
    self.vscale=s
    self.intv=30
    self.pos=1
    _connect(master,self,0,true)
    last=New(_editor_class["Muki_AiC_cane_bg2"],self.x,self.y,self)
    lasttask=task.New(self,function()
        do
            local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+360 local _d_a=(_end_a-_beg_a)/(30-1)
            for _=1,30 do
                self.rot=a
                task._Wait(1)
                a=a+_d_a
            end
        end
        do
            local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+360+15 local _w_a=0 local _d_w_a=1/(120-1)
            for _=1,120 do
                self.rot=a
                task._Wait(1)
                _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
            end
        end
    end)
end
_editor_class["Muki_AiC_cane"].frame=function(self)
    self.class.base.frame(self)
    if self.del then
        _del(self,false)
    else
    end
    if self.timer%self.intv==0 and self.timer>150 then
        self.pos=self.pos+1
    end
end
_editor_class["Muki_AiC_cane"].render=function(self)
    self.class.base.render(self)
    if self.pos<15 and self.timer>150 then
        SetImageState('image:Muki_AiC_animation'..self.pos,'mul+add',Color(255,255,255,255))
        RenderRect('image:Muki_AiC_animation'..self.pos,-192,192,-224,224)
    end
end
_editor_class["Muki_AiC_cane_bg"]=Class(_object)
_editor_class["Muki_AiC_cane_bg"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_cane_bg"
    self.layer=LAYER_ENEMY+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _connect(master,self,0,true)
    self.hscale=5
    self.vscale=5
    self.x=self.x+5
    self.y=self.y+12
    SetImageState(self.img,'mul+add',Color(100,255,255,255))
end
_editor_class["Muki_AiC_cane_bg"].frame=function(self)
    self.class.base.frame(self)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_cane_bg2"]=Class(_object)
_editor_class["Muki_AiC_cane_bg2"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="particle:Muki_AiC_cane_bg2"
    self.layer=LAYER_ENEMY+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _connect(master,self,0,true)
    self.hscale=0.5
    self.vscale=0.5
end
_editor_class["Muki_AiC_cane_bg2"].frame=function(self)
    self.class.base.frame(self)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_random_text"]=Class(_object)
_editor_class["Muki_AiC_random_text"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.text=''
    self.len=ran:Int(20,50)
    self.alpha=0
    self.x=ran:Float(-180,180)
    self.y=ran:Float(-256,0)
    self.s=ran:Float(0.25,1)
    self.bound=false
    SetV2(self,1,90,true,false)
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        task._Wait(120)
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_random_text"].frame=function(self)
    if self.del then
        _del(self,false)
    else
    end
    self.text=''
    for _=1,self.len do
       self.text=self.text..string.char(ran:Int(97,122))
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_random_text"].render=function(self)
    self.class.base.render(self)
    RenderTTF2('magic',self.text,self.x,self.x,self.y,self.y,
        self.s,Color(self.alpha,255,255,255),'paragraph','bottom')
end
_editor_class["Muki_AiC_device_aura1"]=Class(_object)
_editor_class["Muki_AiC_device_aura1"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY+6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.t=0
    self.master=master
    _connect(master,self,0,true)
end
_editor_class["Muki_AiC_device_aura1"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.t = min(self.t + 10, 30)
    self.sizefix=max(-0.2,0.3-0.5/30*self.timer)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_device_aura1"].render=function(self)
    SetImageState(self.img,'mul+add',Color(200,255,255,255))
    self.omiga = 2*sin(90 + self.ani * 0.75)
    local size = (sin(self.t * 3) ^ 2 + self.sizefix) * 2.75
    if IsValid(self.master) then Render(self.img, self.master.x, self.master.y, self.ani * 0.75 + self.rot, (0.8 * sin(90 + self.ani * 0.75)) * size , 0.92 * size) end
end
_editor_class["Muki_AiC_device_aura2"]=Class(_object)
_editor_class["Muki_AiC_device_aura2"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY+6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.t=0
    self.master=master
    _connect(master,self,0,true)
end
_editor_class["Muki_AiC_device_aura2"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.t = min(self.t + 10, 30)
    self.sizefix=max(-0.2,0.3-0.5/30*self.timer)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_device_aura2"].render=function(self)
    SetImageState(self.img,'mul+add',Color(200,255,255,255))
    self.omiga = 2*sin(90 + self.ani * 1)
    local size = (sin(self.t * 3) ^ 2 + self.sizefix) * 2.5
    if IsValid(self.master) then Render(self.img, self.master.x, self.master.y, self.ani * 1 + self.rot, (0.8 * sin(90 + self.ani * 1)) * size , 0.92 * size) end
end
_editor_class["Muki_AiC_device_aura3"]=Class(_object)
_editor_class["Muki_AiC_device_aura3"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY+6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.t=0
    self.master=master
    _connect(master,self,0,true)
end
_editor_class["Muki_AiC_device_aura3"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.t = min(self.t + 10, 30)
    self.sizefix=max(-0.2,0.3-0.5/30*self.timer)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_device_aura3"].render=function(self)
    SetImageState(self.img,'mul+add',Color(200,255,255,255))
    self.omiga = 2*sin(90 + self.ani * 1.25)
    local size = (sin(self.t * 3) ^ 2 + self.sizefix) * 3
    if IsValid(self.master) then Render(self.img, self.master.x, self.master.y, self.ani * 1.25 + self.rot, (0.8 * sin(90 + self.ani * 1.25)) * size , 0.92 * size) end
end
_editor_class["Muki_AiC_device_aura4"]=Class(_object)
_editor_class["Muki_AiC_device_aura4"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY+6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.t=0
    self.master=master
    _connect(master,self,0,true)
end
_editor_class["Muki_AiC_device_aura4"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.t = min(self.t + 10, 30)
    self.sizefix=max(-0.2,0.3-0.5/30*self.timer)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_device_aura4"].render=function(self)
    SetImageState(self.img,'mul+add',Color(200,255,255,255))
    self.omiga = 2*sin(90 + self.ani * 1.5)
    local size = (sin(self.t * 3) ^ 2 + self.sizefix) * 3.5
    if IsValid(self.master) then Render(self.img, self.master.x, self.master.y, self.ani * 1.5 + self.rot, (0.8 * sin(90 + self.ani * 1.5)) * size , 0.92 * size) end
end
_editor_class["Muki_AiC_device_aura5"]=Class(_object)
_editor_class["Muki_AiC_device_aura5"].init=function(self,_x,_y,master)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY+6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.t=0
    self.master=master
    _connect(master,self,0,true)
end
_editor_class["Muki_AiC_device_aura5"].frame=function(self)
    self.class.base.frame(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.t = min(self.t + 10, 30)
    self.sizefix=max(-0.2,0.3-0.5/30*self.timer)
    if self.del then
        _del(self,false)
    else
    end
end
_editor_class["Muki_AiC_device_aura5"].render=function(self)
    SetImageState(self.img,'mul+add',Color(200,255,255,255))
    self.omiga = 2*sin(90 + self.ani * 1.5)
    local size = (sin(self.t * 3) ^ 2 + self.sizefix) * 3.25
    if IsValid(self.master) then Render(self.img, self.master.x, self.master.y, self.ani * 1.75 + self.rot, (0.8 * sin(90 + self.ani * 1.75)) * size , 0.92 * size) end
end
--[[ 从爱美那一期周末活搬过来的
]]
--[[ 好不容易才写出来的东西当然要再利用一下
]]
_editor_class["Muki_AiC_get_magic_ui"]=Class(_object)
_editor_class["Muki_AiC_get_magic_ui"].init=function(self,_x,_y,is_border)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.alpha1=0
    self.alpha2=0
    self.y1=0
    self.y2=0
    self.y3=0
    self.is_border=is_border
    lasttask=task.New(self,function()
        do
            local _beg_al1=0 local al1=_beg_al1 local _end_al1=255 local _d_al1=(_end_al1-_beg_al1)/(60-1)
            local _beg_al2=0 local al2=_beg_al2 local _end_al2=150 local _d_al2=(_end_al2-_beg_al2)/(60-1)
            local _beg_y1=0 local y1=_beg_y1 local _end_y1=50 local _d_y1=(_end_y1-_beg_y1)/(60-1)
            local _beg_y2=0 local y2=_beg_y2 local _end_y2=25 local _d_y2=(_end_y2-_beg_y2)/(60-1)
            for _=1,60 do
                self.alpha1=al1
                self.alpha2=al2
                self.y1=y1
                self.y2=y2
                task._Wait(1)
                al1=al1+_d_al1
                al2=al2+_d_al2
                y1=y1+_d_y1
                y2=y2+_d_y2
            end
        end
        task._Wait(240)
        do
            local _beg_al1=255 local al1=_beg_al1 local _end_al1=0 local _d_al1=(_end_al1-_beg_al1)/(60-1)
            local _beg_al2=150 local al2=_beg_al2 local _end_al2=0 local _d_al2=(_end_al2-_beg_al2)/(60-1)
            local _beg_y3=0 local y3=_beg_y3 local _end_y3=-50 local _d_y3=(_end_y3-_beg_y3)/(60-1)
            for _=1,60 do
                self.alpha1=al1
                self.alpha2=al2
                self.y3=y3
                task._Wait(1)
                al1=al1+_d_al1
                al2=al2+_d_al2
                y3=y3+_d_y3
            end
        end
    end)
end
_editor_class["Muki_AiC_get_magic_ui"].render=function(self)
    self.class.base.render(self)
    SetViewMode('ui')
    SetImageState('white','',Color(self.alpha2,0,0,0))
    RenderRect('white',0,screen.width,0,screen.height)
    if self.is_border then
    	SetImageState('image:Muki_AiC_spell5','',Color(self.alpha1,255,255,255))
        Render('image:Muki_AiC_spell5',screen.width/2,self.y1+self.y3+325,0,0.8)
        RenderTTF2('main_font_zh2',aic.l10n.ui.new_skill_text[3],
            screen.width/2,screen.width/2,self.y2+self.y3+225,self.y2+self.y3+225,2,
            Color(self.alpha1,255,255,255),'centerpoint')
        RenderTTF('main_font_zh2',aic.l10n.ui.new_skill_text[4],
            screen.width/2,screen.width/2,self.y2+self.y3+125,self.y2+self.y3+125,
            Color(self.alpha1,255,255,255),'centerpoint')
    else
        SetImageState('image:Muki_AiC_spell5','',Color(self.alpha1,255,255,255))
        Render('image:Muki_AiC_spell5',screen.width/2,self.y1+self.y3+325,0,0.8)
        RenderTTF2('main_font_zh2',aic.l10n.ui.new_skill_text[1],
            screen.width/2,screen.width/2,self.y2+self.y3+225,self.y2+self.y3+225,2,
            Color(self.alpha1,255,255,255),'centerpoint')
        RenderTTF('main_font_zh2',aic.l10n.ui.new_skill_text[2],
            screen.width/2,screen.width/2,self.y2+self.y3+125,self.y2+self.y3+125,
            Color(self.alpha1,255,255,255),'centerpoint')
    end
    SetViewMode('world')
end
_editor_class["Muki_AiC_get_magic_ef1"]=Class(_object)
_editor_class["Muki_AiC_get_magic_ef1"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.s1=2
    self.s2=2
    lasttask=task.New(self,function()
        do
            local _beg_s=self.s1 local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(15-1)
            local _beg_y=self.y local y=_beg_y local _end_y=self.y-20 local _d_y=(_end_y-_beg_y)/(15-1)
            for _=1,15 do
                self.s1=s
                self.y=y
                task._Wait(1)
                s=s+_d_s
                y=y+_d_y
            end
        end
        task._Wait(15)
        do
            local _beg_s=self.s2 local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(15-1)
            for _=1,15 do
                self.s2=s
                task._Wait(1)
                s=s+_d_s
            end
        end
    end)
end
_editor_class["Muki_AiC_get_magic_ef1"].render=function(self)
    SetImageState('image:Muki_AiC_cast_ef1','mul+add',Color(255,255,255,255))
    SetImageState('image:Muki_AiC_cast_ef2','mul+add',Color(255,255,255,255))
    Render('image:Muki_AiC_cast_ef1',self.x,self.y,0,self.s1)
    Render('image:Muki_AiC_cast_ef2',self.x,self.y,0,self.s2)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_get_magic_ef2"]=Class(_object)
_editor_class["Muki_AiC_get_magic_ef2"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="parimg1"
    self.layer=LAYER_TOP+1
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.s=ran:Float(4,6)
    self.hscale=0
    self.vscale=0
    self.x=ran:Float(-180,180)
    self.y=ran:Float(-200,200)
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_s=0 local s=_beg_s local _end_s=self.s local _d_s=(_end_s-_beg_s)/(15-1)
            for _=1,15 do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
        do
            local _beg_s=self.s local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(15-1)
            for _=1,15 do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_get_magic_ef3"]=Class(_object)
_editor_class["Muki_AiC_get_magic_ef3"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="parimg1"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.s=ran:Float(2,3)
    self.x=ran:Float(-180,180)
    self.y=ran:Float(-200,200)
    self.alpha=255
    lasttask=task.New(self,function()
        task._Wait(30)
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(30-1)
            local _beg_y=self.y local y=_beg_y local _end_y=self.y+30 local _w_y=0 local _d_w_y=1/(30-1)
            for _=1,30 do
                self.alpha=al
                self.y=y
                task._Wait(1)
                al=al+_d_al
                _w_y=_w_y+_d_w_y y=(_beg_y-_end_y)*(_w_y-1)^2+_end_y
            end
        end
    end)
end
_editor_class["Muki_AiC_get_magic_ef3"].frame=function(self)
    _object.set_color(self,"mul+add",self.alpha,255,255,255)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_get_magic_ef4"]=Class(_object)
_editor_class["Muki_AiC_get_magic_ef4"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_cast_ef2"
    self.layer=LAYER_TOP-1
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.s=ran:Float(0.75,1)
    self.x=ran:Float(-180,180)
    self.y=ran:Float(-200,200)
    self.hscale=self.s
    self.vscale=self.s
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        task._Wait(30)
        do
            local _beg_s=self.s local s=_beg_s local _end_s=self.s*0.8 local _d_s=(_end_s-_beg_s)/(30-1)
            for _=1,30 do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
        do
            local _beg_s=self.s*0.8 local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(30-1)
            for _=1,30 do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
    end)
end
_editor_class["Muki_AiC_slave1"]=Class(_object)
_editor_class["Muki_AiC_slave1"].init=function(self,_x,_y,v,a,o,t)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_slave"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _object.set_color(self,"mul+add",255,100,255,230)
    self.omiga=o
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        do
            local _beg_vv=v local vv=_beg_vv local _end_vv=0.5 local _w_vv=0 local _d_w_vv=1/(60-1)
            for _=1,60 do
                SetV2(self,vv,a,false,false)
                task._Wait(1)
                _w_vv=_w_vv+_d_w_vv if _w_vv<0.5 then vv=2*(_end_vv-_beg_vv)*_w_vv^2+_beg_vv else vv=(_end_vv-_beg_vv)*(-2*_w_vv^2+4*_w_vv-1)+_beg_vv end
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            do
                local aa=0 local _n_aa=(0)+(180)
                for _=1,2 do
                    do local aaa,_d_aaa=(-30),(30) for _=1,3 do
                        if o==3 then
                            last=New(_straight,grain_c,COLOR_CYAN,self.x,self.y,3,self.rot+aa+aaa,false,0,true,true,0,false,0,0,0,false)
                        else
                            last=New(_straight,grain_c,COLOR_BLUE,self.x,self.y,3,self.rot+aa+aaa,false,0,true,true,0,false,0,0,0,false)
                        end
                        last.a=last.a*0.75
                        last.b=last.b*0.75
                        last.hscale=0.75
                        last.vscale=0.75
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(20)
                            PlaySound("kira00",0.1,self.x/256,false)
                            if o==3 then
                                last=New(_straight,grain_a,COLOR_CYAN,self.x,self.y,1,self.rot,false,0,true,true,0,false,0,0,0,false)
                            else
                                last=New(_straight,grain_a,COLOR_BLUE,self.x,self.y,1,self.rot,false,0,true,true,0,false,0,0,0,false)
                            end
                            last.a=last.a*0.75
                            last.b=last.b*0.75
                            last.hscale=0.75
                            last.vscale=0.75
                            _del(self,false)
                        end)
                    aaa=aaa+_d_aaa end end
                    aa=-(aa)+_n_aa
                end
            end
            task._Wait(t)
        end
    end)
end
_editor_class["Muki_AiC_slave2"]=Class(_object)
_editor_class["Muki_AiC_slave2"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_slave"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _object.set_color(self,"mul+add",255,100,255,230)
    self.omiga=3
    lasttask=task.New(self,function()
        do local a,_d_a=(0),(1) for _=1,3 do
            SetV2(self,5,0,false,true)
            PlaySound("tan00",0.25,self.x/256,true)
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(12)
                for _=1,12 do
                    last=New(_straight,ball_mid,COLOR_CYAN,self.x,self.y,3,a,false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,60,MOVE_NORMAL,nil,0,MODE_SET) end )
                        task._Wait(60)
                        for _=1,8 do
                            last=New(_straight,ball_small,COLOR_CYAN,self.x,self.y,1,ran:Float(0,360),false,0,true,true,0,false,0,0,0,false)
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0.5,60,MOVE_NORMAL,nil,0,MODE_SET) end )
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                task._Wait(180)
                                _del(self,true)
                            end)
                        end
                        _del(self,true)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(10)
        a=a+_d_a end end
        do local a,_d_a=(0),(1) for _=1,30 do
            SetV2(self,5,0,false,true)
            task._Wait(1)
        a=a+_d_a end end
        local a0=(ran:Float(0,360))
        PlaySound("kira00",0.5,self.x/256,true)
        do
            local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(8)
            for _=1,8 do
                do
                    local _beg_v=2 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(8-1)
                    local n=1 local _d_n=(1)
                    for _=1,8 do
                        do local aa,_d_aa=(-1/2*(5*n-1)),(5) for _=1,n do
                            last=New(_editor_class["Muki_AiC_arrow_big"],self.x,self.y,v,a+aa)
                        aa=aa+_d_aa end end
                        v=v+_d_v
                        n=n+_d_n
                    end
                end
                a=a+_d_a
            end
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_slave2"].frame=function(self)
    self.class.base.frame(self)
    if self.timer>60 then
        self.x=player.x
        self.y=player.y
    end
    if self.del then
        _del(self,true)
    else
    end
end
_editor_class["Muki_AiC_arrow_big"]=Class(bullet)
_editor_class["Muki_AiC_arrow_big"].init=function(self,_x,_y,v,a)
bullet.init(self,arrow_big,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    SetV2(self,v,a,true,false)
    _set_a(self,0.025,a+180,false)
    self.colli=false
    self.navi=true
    self.bound=false
    _object.set_color(self,"mul+add",100,255,255,255)
    lasttask=task.New(self,function()
        task._Wait(180)
        self.colli=true
        _object.set_color(self,"",255,255,255,255)
        task._Wait(300)
        self.bound=true
    end)
end
_editor_class["Muki_AiC_warning"]=Class(_object)
_editor_class["Muki_AiC_warning"].init=function(self,_x,_y,l,r,b,t,dir,time)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.l=l
    self.r=r
    self.b=b
    self.t=t
    self.alpha=100
    dir=dir or 'down'
    time=time or 30
    lasttask=task.New(self,function()
        if dir=='up' then
            do
                local _beg_var=b local var=_beg_var local _end_var=t local _d_var=(_end_var-_beg_var)/(time-1)
                for _=1,time do
                    self.t=var
                    task._Wait(1)
                    var=var+_d_var
                end
            end
        elseif dir=='down' then
            do
                local _beg_var=t local var=_beg_var local _end_var=b local _d_var=(_end_var-_beg_var)/(time-1)
                for _=1,time do
                    self.b=var
                    task._Wait(1)
                    var=var+_d_var
                end
            end
        elseif dir=='left' then
            do
                local _beg_var=l local var=_beg_var local _end_var=r local _d_var=(_end_var-_beg_var)/(time-1)
                for _=1,time do
                    self.r=var
                    task._Wait(1)
                    var=var+_d_var
                end
            end
        else
            do
                local _beg_var=r local var=_beg_var local _end_var=l local _d_var=(_end_var-_beg_var)/(time-1)
                for _=1,time do
                    self.l=var
                    task._Wait(1)
                    var=var+_d_var
                end
            end
        end
        do
            local _beg_al=100 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(time-1)
            for _=1,time do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_warning"].render=function(self)
    SetImageState('white','',Color(self.alpha,255,0,0))
    local l,r,b,t=self.l,self.r,self.b,self.t
    Render4V("white",l,t,0.5
                    ,r,t,0.5
                    ,r,b,0.5
                    ,l,b,0.5)
end
_editor_class["Muki_AiC_ball_big_slave"]=Class(_object)
_editor_class["Muki_AiC_ball_big_slave"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.navi=true
    self.bound=false
    lasttask=task.New(self,function()
        task._Wait(60)
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.3,self.x/256,true)
            last=New(_editor_class["Muki_AiC_ball_big"],self.x,self.y,self.rot+180)
            task._Wait(1)
        end
    end)
    aic.misc.SineMove(self,self.x,self.y,(self.y+210)/42,-90,50,25)
end
_editor_class["Muki_AiC_ball_big"]=Class(bullet)
_editor_class["Muki_AiC_ball_big"].init=function(self,_x,_y,a)
bullet.init(self,ball_big,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    self.rot=a
    self.bound=false
    lasttask=task.New(self,function()
        task._Wait(60)
        PlaySound("kira00",0.1,self.x/256,false)
        for _=1,3 do
            local a=(ran:Float(0,360))
            last=New(_straight,grain_b,COLOR_BLUE,self.x,self.y,1,a,false,0,true,true,0,false,0.025,a,5,false)
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_eclipse_slave"]=Class(_object)
_editor_class["Muki_AiC_eclipse_slave"].init=function(self,_x,_y,master,s)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _connect(master,self,0,true)
    self.omiga=10
    self.r=50
    self.s=s
    self.bound=false
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.3,self.x/256,true)
            last=New(_editor_class["Muki_AiC_eclipse"],self.x,self.y,self.rot)
            task._Wait(2)
        end
    end)
end
_editor_class["Muki_AiC_eclipse_slave"].frame=function(self)
    if self.del then
        _del(self,false)
    else
    end
    _set_rel_pos(self,self.r*cos(self.rot)*self.s,self.r*sin(self.rot)*self.s,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_eclipse"]=Class(bullet)
_editor_class["Muki_AiC_eclipse"].init=function(self,_x,_y,a)
bullet.init(self,ellipse,COLOR_RED,true,true)
self.x,self.y=_x,_y
    self.rot=a
    lasttask=task.New(self,function()
        task._Wait(60)
        PlaySound("kira00",0.1,self.x/256,false)
        _set_a(self,0.05,self.rot,false)
    end)
end
_editor_class["Muki_AiC_fox_bullet1"]=Class(_object)
_editor_class["Muki_AiC_fox_bullet1"].init=function(self,_x,_y,master,a)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_fox_bullet1"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_ENEMY_BULLET
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=30
    self.group=GROUP_INDES
    _object.set_color(self,"mul+add",255,255,255,255)
    if master then
        self.hscale=0.2
        self.vscale=0.2
        self.a=5
        self.b=5
        self.master=master
        _connect(master,self,0,true)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                _set_rel_pos(self,self.r*cos(a+self.master.rot),self.r*sin(a+self.master.rot),self.rot,false)
                task._Wait(1)
            end
        end)
    else
        SetV2(self,3,0,true,true)
        self.hscale=1.2
        self.vscale=1.2
        self.a=25
        self.b=25
        self.omiga=-2
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(6)
            for _=1,6 do
                last=New(_editor_class["Muki_AiC_fox_bullet1"],self.x+self.r*cos(a),self.y+self.r*sin(a),self,a)
                a=a+_d_a
            end
        end
        lasttask=task.New(self,function()
            for _=1,_infinite do
                if self.x>=192 or self.x<=-192 or self.y>224 or self.y<=-224 or (IsValid(player) and Dist(self,player)<=self.r or self._signal) then break end
                task._Wait(1)
            end
            PlaySound("slash",0.8,self.x/256,true)
            PlaySound("kira00",0.6,self.x/256,true)
            for _=1,20 do
                last=New(_straight,water_drop,COLOR_ORANGE,self.x,self.y,ran:Float(2,5),ran:Float(0,360),false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    lasttask=task.New(self,function()
                        for _=1,_infinite do
                            if self._signal then
                                _del(self,true)
                            else
                            end
                            task._Wait(1)
                        end
                    end)
                    self.rot=-90
                    task._Wait(30)
                    _set_a(self,0.05,-90,false)
                end)
            end
            _del(self,true)
        end)
    end
end
_editor_class["Muki_AiC_fox_bullet2"]=Class(bullet)
_editor_class["Muki_AiC_fox_bullet2"].init=function(self,_x,_y,_)
bullet.init(self,ball_huge,COLOR_RED,true,true)
self.x,self.y=_x,_y
    self.r=75
    self.r2=125
    self.alpha=0
    self.timer2=0
    self.timer3=0
    self.group=GROUP_INDES
    lasttask=task.New(self,function()
        SetV2(self,5,0,true,true)
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",1,30,MOVE_NORMAL,nil,0,MODE_SET) end )
        task._Wait(30)
        for _=1,60 do
            SetV2(self,1,0,true,true)
            if self.flag then break end
            task._Wait(1)
        end
        for _=1,_infinite do
            if self.flag then break end
            task._Wait(1)
        end
        SetV2(self,0,0,true,false)
    end)
    lasttask=task.New(self,function()
        --[[ 
        ]]
        for _=1,_infinite do
            if self.x>=192 or self.x<=-192 or self.y>224 or self.y<=-224 or (IsValid(player) and Dist(self,player)<=self.r or self._signal) then
                self.flag=true
                do break end
            end
            task._Wait(1)
        end
        do
            local _beg_al=0 local al=_beg_al local _end_al=200 local _d_al=(_end_al-_beg_al)/(60)
            for _=1,60 do
                self.alpha=al
                al=al+_d_al
            end
        end
        PlaySound("ch00",0.8,self.x/256,true)
        for _=1,60 do
            self.timer2=self.timer2+1
            task._Wait(1)
        end
        PlaySound("slash",0.8,self.x/256,true)
        PlaySound("boon01",0.8,self.x/256,true)
        self.flag2=true
        self.a=self.r2
        self.b=self.r2
        for _=1,20 do
            self.timer3=self.timer3+1
            task._Wait(1)
        end
        lasttask=task.New(self,function()
            for _=1,30 do
                local a=(ran:Float(0,360))
                local r=(ran:Float(0,self.r2))
                PlaySound("kira00",0.6,self.x/256,true)
                last=New(_straight,water_drop,COLOR_ORANGE,self.x+r*cos(a),self.y+r*sin(a),0.5,ran:Float(0,360),false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    lasttask=task.New(self,function()
                        for _=1,_infinite do
                            if self._signal then
                                _del(self,true)
                            else
                            end
                            task._Wait(1)
                        end
                    end)
                    self.rot=-90
                    task._Wait(30)
                    _set_a(self,0.05,-90,false)
                end)
            end
        end)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_fox_bullet2"].render=function(self)
    SetImageState('white','',Color(150,100,110,35))
    aic.ui.RenderEclipse('white',self.x,self.y,self.r)
    self.class.base.render(self)
    SetImageState('white','',Color(self.alpha-200*self.timer3/20,0,0,0))
    aic.ui.RenderEclipse('white',self.x,self.y,self.r2)
    if self.flag then
        SetImageState('white','mul+add',Color(255,255,255*(1-self.timer2/60),100*(1-self.timer2/60)))
        local r2=self.r+(self.timer2/60)*(self.r2-self.r)
        local r1
        for _=1,25 do 
            r1=ran:Float(0,r2)
            local rot=ran:Float(0,360)
            aic.ui.RenderEclipseRing('white',self.x,self.y,r1,r2,90,0,r1,r2,rot,rot+0.1)
        end
    end
    SetImageState('white','',Color(255*self.timer3/20,255,122,21))
    aic.ui.RenderEclipse('white',self.x,self.y,self.r2)
end
_editor_class["Muki_AiC_slave3"]=Class(_object)
_editor_class["Muki_AiC_slave3"].init=function(self,_x,_y,master,v,a)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_slave"
    self.layer=LAYER_ENEMY
    self.group=GROUP_ENEMY
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=100
    self.maxhp=100
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _object.set_color(self,"mul+add",255,255,25,50)
    SetV2(self,v,a,true,false)
    self.omiga=3
    self.a=10
    self.b=10
    _connect(master,self,0.75,true)
    lasttask=task.New(self,function()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,60,MOVE_NORMAL,nil,0,MODE_SET) end )
        task._Wait(60)
        for _=1,2 do
            local type=(ran:Int(1,3))
            if type==1 then
                PlaySound("tan00",0.8,self.x/256,true)
                last=New(_editor_class["Muki_AiC_fox_bullet1"],self.x,self.y,nil)
                task._Wait(60)
            elseif type==2 then
                PlaySound("tan00",0.8,self.x/256,true)
                last=New(_editor_class["Muki_AiC_fox_bullet2"],self.x,self.y,_)
                task._Wait(60)
            else
                for _=1,20 do
                    PlaySound("tan00",0.25,self.x/256,true)
                    last=New(_straight,water_drop,COLOR_RED,self.x,self.y,ran:Float(3,5),ran:Float(-30,30),true,0,true,true,0,false,0,0,0,false)
                    last.rot=-90
                    task._Wait(3)
                end
            end
            task._Wait(60)
        end
        _kill(self,true)
    end)
end
_editor_class["Muki_AiC_slave3"].colli=function(self,other)
    PlaySound("damage00",0.1,self.x/256,false)
    self.class.base.colli(self,other)
end
_editor_class["Muki_AiC_slave3"].kill=function(self)
    PreserveObject(self)
    PlaySound("kira00",0.1,self.x/256,false)
    do
        local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
        for _=1,16 do
            last=New(_straight,butterfly,COLOR_RED,self.x,self.y,2,a,false,0,true,true,0,false,0,0,0,false)
            a=a+_d_a
        end
    end
    last=New(EnemySimple,1,1,self.x,self.y,{0,0,0},0,false,false,false,function(self)
        task.New(self,function()
        end)
    end)
    _kill(last,true)
    _del(self,false)
    self.class.base.kill(self)
end
_editor_class["Muki_AiC_burst"]=Class(_object)
_editor_class["Muki_AiC_burst"].init=function(self,_x,_y,master,red,stun)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_spell4"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=0.75
    self.hscale=0.75
    self.t=42
    self.nopause=true
    self.red=red
    self.alpha=255
    self.stun=stun
    lasttask=task.New(self,function()
        local intv=({2,3,46,5,5,5,5,6,6,7,7,7,8,8,8})
        last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_burst',master,15,aic.table.Sum(intv),intv,nil,nil,0.65)
        last.nopause=true
        PlaySound("se:Muki_AiC_burst",8,self.x/256,true)
        lstg.var.timeslow=3
        player.nopause=true
        player.grazer.nopause=true
        if player.player_aura then
            player.player_aura[1].nopause=true
            player.player_aura[2].nopause=true
        end
        player.nextshoot=114514
        player.slowlock=true
        AddSuperPause(self.t*2)
        task._Wait(self.t)
        last=New(_editor_class["Muki_AiC_burst_ef"],master.x,master.y,red)
        lstg.var.timeslow=1
        misc.ShakeScreen(120,3)
        task._Wait(15)
        player.nextshoot=0
        player.nopause=false
        player.grazer.nopause=false
        if player.player_aura then
            player.player_aura[1].nopause=false
            player.player_aura[2].nopause=false
        end
        player.slowlock=false
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_burst"].frame=function(self)
    if GetSuperPause()==0 then
        player.nopause=false
        player.grazer.nopause=false
        if player.player_aura then
            player.player_aura[1].nopause=false
            player.player_aura[2].nopause=false
        end
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_burst"].render=function(self)
    SetImageState('white','',Color(min(min(150,self.timer*10),self.alpha),0,0,0))
    Render4V('white',
    	-192,224,0.5,
    	192,224,0.5,
    	192,-224,0.5,
    	-192,-224,0.5
    )
    if self.red then
        SetImageState('image:Muki_AiC_square4','mul+add',Color(self.alpha,255,255*self.stun/100,255*self.stun/100))
        SetImageState(self.img,'mul+add',Color(self.alpha,255,255*self.stun/100,255*self.stun/100))
    else
        SetImageState('image:Muki_AiC_square4','mul+add',Color(self.alpha,255,255,255))
        SetImageState(self.img,'mul+add',Color(self.alpha,255,255,255))
    end
    Render('image:Muki_AiC_square4',self.x,self.y,45,5)
    Render('image:Muki_AiC_square4',self.x,self.y,45,max(5,6-self.timer/self.t))
    if self.stun and self.timer<self.t+15 then
       if self.red then
            DrawText('main_font_zh1','晕厥概率：'..self.stun..'%',self.x,self.y-self.timer-50,1,
                color(COLOR_RED,self.alpha),color(COLOR_BLACK,self.alpha),'centerpoint')
        else
            DrawText('main_font_zh1','晕厥概率：'..self.stun..'%',self.x,self.y-self.timer-50,1,
                color(COLOR_WHITE,self.alpha),color(COLOR_BLACK,self.alpha),'centerpoint')
        end
    end
    self.class.base.render(self)
end
_editor_class["Muki_AiC_burst"].frame=function(self)
    if self.red then
        _object.set_color(self,"mul+add",255,255,0,0)
    else
        _object.set_color(self,"mul+add",255,255,255,255)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_burst"].del=function(self)
    PreserveObject(self)
    lasttask=task.New(self,function()
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_burst_ef"]=Class(_object)
_editor_class["Muki_AiC_burst_ef"].init=function(self,_x,_y,red)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.red=red
    lasttask=task.New(self,function()
        do
            local _beg_s=0 local s=_beg_s local _end_s=7 local _d_s=(_end_s-_beg_s)/(30)
            for _=1,30 do
                self.vscale=s
                self.hscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_burst_ef"].render=function(self)
    if self.red then
        SetImageState(self.img,'mul+add',Color(255,255,0,0))
    aic.ui.RenderEclipseRing(self.img,self.x,self.y,self.vscale*95,self.vscale*100)
    else
        SetImageState(self.img,'mul+add',Color(255,255,255,255))
    end
end
_editor_class["Muki_AiC_burst_laser"]=Class(laser_bent)
_editor_class["Muki_AiC_burst_laser"].init=function(self,_x,_y,v,a,s)
    laser_bent.init(self,COLOR_RED,_x,_y,32,8,4,0)
    self.navi=true
    --[[ 斐波那契，但折线
    ]]
    local g=(_GOLD)
    local x1=(self.x+100*g)
    local y1=(self.y-100*g)
    local x2=(self.x+100)
    local y2=(self.y-100*(1-g))
    local x3=(self.x+100*g+100*(1-g)^2)
    local y3=(self.y-100*g*(1-g))
    local x4=(self.x+100*g)
    local y4=(self.y-100*g^2*(1-g))
    x1,y1=rotate(x1,y1,a,self.x,self.y)
    x2,y2=rotate(x2,y2,a,self.x,self.y)
    x3,y3=rotate(x3,y3,a,self.x,self.y)
    x4,y4=rotate(x4,y4,a,self.x,self.y)
    lasttask=task.New(self,function()
        task.MoveTo(x1,y1,int(Dist(self.x,self.y,x1,y1)/v),MOVE_NORMAL)
        task.MoveTo(x2,y2,int(Dist(self.x,self.y,x2,y2)/v),MOVE_NORMAL)
        task.MoveTo(x3,y3,int(Dist(self.x,self.y,x3,y3)/v),MOVE_NORMAL)
        task.MoveTo(x4,y4,int(Dist(self.x,self.y,x4,y4)/v),MOVE_NORMAL)
        SetV2(self,v/2,self.rot,true,false)
        _set_a(self,0.2,self.rot+90,false)
    end)
end
_editor_class["Muki_AiC_restrict_laser"]=Class(laser)
_editor_class["Muki_AiC_restrict_laser"].init=function(self,_x,_y,turn_on,r,a)
    laser.init(self,COLOR_GRAY,_x,_y,0,0.1*r*sqrt(2),0.8*r*sqrt(2),0.1*r*sqrt(2),8,0,0)
    
    lasttask=task.New(self,function()
        self.rot=a+135
        if turn_on then
            laser._TurnOn(self,30,true,true)
        else
            laser._TurnOn(self,1,false,false)
        end
    end)
end
_editor_class["Muki_AiC_restrictor"]=Class(_object)
_editor_class["Muki_AiC_restrictor"].init=function(self,_x,_y,r)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=r
    self.laser={}
    lasttask=task.New(self,function()
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
            local i=1 local _d_i=(1)
            for _=1,4 do
                last=New(_editor_class["Muki_AiC_restrict_laser"],self.x+r*cos(a),self.y+r*sin(a),true,r,a)
                self.laser[i]=last
                a=a+_d_a
                i=i+_d_i
            end
        end
        task._Wait(90)
        for _=1,_infinite do
            task._Wait(60)
            local r=(ran:Float(50,80))
            if self.x<=-120 then
                task.MoveToEx(r,0,60,MOVE_ACC_DEC)
            elseif self.x>=120 then
                task.MoveToEx(-r,0,60,MOVE_ACC_DEC)
            elseif self.y>=50 then
                task.MoveToEx(0,-r,60,MOVE_ACC_DEC)
            elseif self.y<=-50 then
                task.MoveToEx(0,r,60,MOVE_ACC_DEC)
            else
                local dir=(ran:Int(1,4))
                task.MoveToEx(r*cos(dir*90),r*sin(dir*90),60,MOVE_ACC_DEC)
            end
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(90)
        do
            local _h_dr=(r*0.25-(-r*0.25))/2 local _t_dr=(r*0.25+(-r*0.25))/2 local dr=_h_dr*sin(0)+_t_dr local _w_dr=0 local _d_w_dr=1.5
            for _=1,_infinite do
                self.r=r+dr
                task._Wait(1)
                _w_dr=_w_dr+_d_w_dr dr=_h_dr*sin(_w_dr)+_t_dr
            end
        end
    end)
end
_editor_class["Muki_AiC_restrictor"].frame=function(self)
    if self.timer>=90 then
        for _, v in ipairs(self.laser) do
            RawDel(v)
        end
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
            local i=1 local _d_i=(1)
            for _=1,4 do
                last=New(_editor_class["Muki_AiC_restrict_laser"],self.x+self.r*cos(a),self.y+self.r*sin(a),false,self.r,a)
                self.laser[i]=last
                a=a+_d_a
                i=i+_d_i
            end
        end
    else
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_square"]=Class(bullet)
_editor_class["Muki_AiC_square"].init=function(self,_x,_y,v,a,co,not_acc)
bullet.init(self,square,COLOR_GRAY,true,true)
self.x,self.y=_x,_y
    self.co=co
    SetV2(self,v,a,true,false)
    if co==0 then
        _object.set_color(self,"mul+add",100,255,255,255)
        self.colli=false
    else
        _object.set_color(self,"mul+rev",255,255,255,255)
    end
    if not not_acc then
        _set_a(last,0.002,last.rot+180,false)
    else
    end
end
_editor_class["Muki_AiC_square"].frame=function(self)
    self.class.base.frame(self)
    local r=(restrictor)
    if IsValid(r) then
        if abs(self.x-r.x)<=r.r*sqrt(2)/2 and abs(self.y-r.y)<=r.r*sqrt(2)/2 and not self.changed then
            self.changed=true
            if self.co==0 then
                _object.set_color(self,"mul+rev",255,255,255,255)
                self.colli=true
            else
                _object.set_color(self,"mul+add",100,255,255,255)
                self.colli=false
            end
        else
        end
    else
    end
end
_editor_class["Muki_AiC_shield_warning"]=Class(_object)
_editor_class["Muki_AiC_shield_warning"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=150 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        do
            local _beg_al=150 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_shield_warning"].render=function(self)
    SetImageState('white','',Color(self.alpha,255,0,0))
    Render4V("white",0,-224,0.5
                    ,192,0,0.5
                    ,192,-224,0.5
                    ,192,-224,0.5)
    Render4V("white",192,0,0.5
                    ,0,224,0.5
                    ,192,224,0.5
                    ,192,224,0.5)
    Render4V("white",0,224,0.5
                    ,-192,0,0.5
                    ,-192,224,0.5
                    ,-192,224,0.5)
    Render4V("white",-192,0,0.5
                    ,0,-224,0.5
                    ,-192,-224,0.5
                    ,-192,-224,0.5)
end
_editor_class["Muki_AiC_shield2"]=Class(_object)
_editor_class["Muki_AiC_shield2"].init=function(self,_x,_y,r,h,o,state,master,t)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=0
    self.h=0
    self.state=state
    self.omiga=o
    self.bound=false
    self.t=t
    self.p=0
    self.plist={}
    _connect(master,self,0,true)
    local a=(sqrt((5+2*sqrt(2))/4))
    local b=(0.1)
    if state==1 then
lasttask=task.New(self,function () ex.SmoothSetValueTo("r",r,30,MOVE_NORMAL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("h",h,30,MOVE_NORMAL,nil,0,MODE_SET) end )
    else
        self.r=r
        self.h=h
    end
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.state==5 then break end
            self.plist={}
            do local rot,_d_rot=(0),(90) for _=1,4 do
                do local y,_d_y=(-self.h),(2*self.h) for _=1,2 do
                    local x1, y1, x2, y2 =
                        self.x,
                        self.y+y,
                        self.x + self.r * a * cos(rot + self.rot),
                        self.y + self.r * b * sin(rot + self.rot)
                    if self.state==3 then
                        x1, y1 = rotate(x1, y1, 5*sin(10*self.timer), self.x, self.y)
                        x2, y2 = rotate(x2, y2, 5*sin(10*self.timer), self.x, self.y)
                    elseif self.state==4 then
                        x1, y1 = rotate(x1, y1, 15*sin(10*self.timer), self.x, self.y)
                        x2, y2 = rotate(x2, y2, 15*sin(10*self.timer), self.x, self.y)
                    end
                    last=New(_editor_class["Muki_AiC_line2"],x1,y1,x1,y1,x2,y2,12,true,self.state>=5)
                    if (self.state >=4 and self.timer % 10 <= 5) or self.state>=5 then
                        laser.ChangeImage(last, 4, COLOR_RED)
                    end
                    last.colli=false
                    table.insert(self.plist,{x1,y1,x2,y2})
                y=y+_d_y end end
                local x1, y1, x2, y2 =
                    self.x + self.r * a * cos(rot + self.rot),
                    self.y + self.r * b * sin(rot + self.rot),
                    self.x + self.r * a * cos(rot + self.rot + 90),
                    self.y + self.r * b * sin(rot + self.rot + 90)
                if self.state==3 then
                    x1, y1 = rotate(x1, y1, 5*sin(10*self.timer), self.x, self.y)
                    x2, y2 = rotate(x2, y2, 5*sin(10*self.timer), self.x, self.y)
                elseif self.state==4 then
                    x1, y1 = rotate(x1, y1, 15*sin(10*self.timer), self.x, self.y)
                    x2, y2 = rotate(x2, y2, 15*sin(10*self.timer), self.x, self.y)
                end
                last=New(_editor_class["Muki_AiC_line2"],x1,y1,x1,y1,x2,y2,12,true,self.state,self.state>=5)
                if (self.state >=4 and self.timer % 10 <= 5) or self.state>=5 then
                    laser.ChangeImage(last, 4, COLOR_RED)
                end
                last.colli=false
                table.insert(self.plist,{x1,y1,x2,y2})
            rot=rot+_d_rot end end
            if self.state<5 then
                for _,v in ipairs(self.plist) do
                    local n=(5)
                    do local p,_d_p=(self.p),(1/n) for _=1,n do
                        last=New(_straight,ball_mid_c,COLOR_CYAN,v[1]+(v[3]-v[1])*(p%1),v[2]+(v[4]-v[2])*(p%1),0,0,false,0,true,true,0,false,0,0,0,false)
                        if self.state >=4 and self.timer % 10 <= 5 then
                            ChangeBulletImage(last,ball_mid_c,COLOR_RED)
                        end
                        last.timer=11
                        if self.timer<=90 then
                            self.colli=false
                            _object.set_color(last,"",min(255,self.timer*255/90),255,255,255)
                        else
                        end
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(1)
                            _del(self,false)
                        end)
                    p=p+_d_p end end
                end
            end
            task._Wait(1)
        end
        for _,v in ipairs(self.plist) do
            last=New(_editor_class["Muki_AiC_line3"],v[1],v[2],v[1],v[2],(v[1]+v[3])/4,(v[2]+v[4])/4,12)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                local r=(50)
                local a=(Angle(self,Noel))
                lasttask=task.New(self,function()
                    do
                        local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+ran:Float(360,720) local _w_a=0 local _d_w_a=1/(60-1)
                        for _=1,60 do
                            self.rot=a
                            task._Wait(1)
                            _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
                        end
                    end
                end)
                task.MoveToEx(r*cos(a),r*sin(a),60,MOVE_DECEL)
                _del(self,true)
            end)
            last=New(_editor_class["Muki_AiC_line3"],(v[1]+v[3])/4,(v[2]+v[4])/4,(v[1]+v[3])/4,(v[2]+v[4])/4,(v[1]+v[3])/2,(v[2]+v[4])/2,12)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                local r=(50)
                local a=(Angle(self,Noel))
                lasttask=task.New(self,function()
                    do
                        local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+ran:Float(360,720) local _w_a=0 local _d_w_a=1/(60-1)
                        for _=1,60 do
                            self.rot=a
                            task._Wait(1)
                            _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
                        end
                    end
                end)
                task.MoveToEx(r*cos(a),r*sin(a),60,MOVE_DECEL)
                _del(self,true)
            end)
            last=New(_editor_class["Muki_AiC_line3"],(v[1]+v[3])/2,(v[2]+v[4])/2,(v[1]+v[3])/2,(v[2]+v[4])/2,(v[1]+v[3])*3/4,(v[2]+v[4])*3/4,12)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                local r=(50)
                local a=(Angle(self,Noel))
                lasttask=task.New(self,function()
                    do
                        local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+ran:Float(360,720) local _w_a=0 local _d_w_a=1/(60-1)
                        for _=1,60 do
                            self.rot=a
                            task._Wait(1)
                            _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
                        end
                    end
                end)
                task.MoveToEx(r*cos(a),r*sin(a),60,MOVE_DECEL)
                _del(self,true)
            end)
            last=New(_editor_class["Muki_AiC_line3"],(v[1]+v[3])*3/4,(v[2]+v[4])*3/4,(v[1]+v[3])*3/4,(v[2]+v[4])*3/4,v[3],v[4],12)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                local r=(50)
                local a=(Angle(self,Noel))
                lasttask=task.New(self,function()
                    do
                        local _beg_a=self.rot local a=_beg_a local _end_a=self.rot+ran:Float(360,720) local _w_a=0 local _d_w_a=1/(60-1)
                        for _=1,60 do
                            self.rot=a
                            task._Wait(1)
                            _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
                        end
                    end
                end)
                task.MoveToEx(r*cos(a),r*sin(a),60,MOVE_DECEL)
                _del(self,true)
            end)
        end
    end)
end
_editor_class["Muki_AiC_shield2"].frame=function(self)
    self.class.base.frame(self)
    self.p=(self.p+0.005)%1
    if self.t and self.timer>=self.t then
        _del(self,true)
    end
end
_editor_class["Muki_AiC_line2"]=Class(laser)
_editor_class["Muki_AiC_line2"].init=function(self,_x,_y,x1,y1,x2,y2,w,hide,notraw)
    laser.init(self,COLOR_CYAN,_x,_y,0,Dist(x1,y1,x2,y2)/6,Dist(x1,y1,x2,y2)/6*4,Dist(x1,y1,x2,y2)/6,w,0,0)
    laser.ChangeImage(self,4)
    self.rot=Angle(x1,y1,x2,y2)
    self.bound=false
    lasttask=task.New(self,function()
        if hide then
            self.layer=LAYER_ENEMY-5
        else
        end
        laser._TurnHalfOn(self,1,true)
        _del(self,notraw)
    end)
end
_editor_class["Muki_AiC_line3"]=Class(laser)
_editor_class["Muki_AiC_line3"].init=function(self,_x,_y,x1,y1,x2,y2,w)
    laser.init(self,COLOR_CYAN,_x,_y,0,Dist(x1,y1,x2,y2)/6,Dist(x1,y1,x2,y2)/6*4,Dist(x1,y1,x2,y2)/6,w,0,0)
    laser.ChangeImage(self,4)
    self.rot=Angle(x1,y1,x2,y2)
    self.bound=false
    lasttask=task.New(self,function()
        laser._TurnHalfOn(self,1,false)
    end)
end
_editor_class["Muki_AiC_last_slave1"]=Class(_object)
_editor_class["Muki_AiC_last_slave1"].init=function(self,_x,_y,x,y,a1,a3,co,dv2,a)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        task.MoveToEx(a,-a,30,MOVE_NORMAL)
        task.MoveToEx(-a,-a,30,MOVE_NORMAL)
        task.MoveToEx(-a,a,30,MOVE_NORMAL)
        task.MoveToEx(a,a,30,MOVE_NORMAL)
    end)
    lasttask=task.New(self,function()
        do local aa,_d_aa=(a3),(dv2) for _=1,120 do
            PlaySound("tan00",0.02,self.x/256,true)
            do local v,_d_v=(0.1),(0.2) for _=1,3 do
                last=New(_editor_class["Muki_AiC_last_11-2"],self.x,self.y,co,aa,v,x,y)
            v=v+_d_v end end
            --[[ 这里的重复数是个可以调整难度的点
            ]]
            task._Wait(1)
        aa=aa+_d_aa end end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_last_slave2"]=Class(_object)
_editor_class["Muki_AiC_last_slave2"].init=function(self,_x,_y,x,y,a1,a3,co,dv2,a)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        task.MoveToEx(a,0,30,MOVE_NORMAL)
        task.MoveToEx(0,-a,30,MOVE_NORMAL)
        task.MoveToEx(-a,0,30,MOVE_NORMAL)
        task.MoveToEx(0,a,30,MOVE_NORMAL)
    end)
    lasttask=task.New(self,function()
        do local aa,_d_aa=(a3),(dv2) for _=1,120 do
            PlaySound("tan00",0.02,self.x/256,true)
            do local v,_d_v=(0.1),(0.2) for _=1,3 do
                last=New(_editor_class["Muki_AiC_last_11-2"],self.x,self.y,co,aa,v,x,y)
            v=v+_d_v end end
            --[[ 这里的重复数是个可以调整难度的点
            ]]
            task._Wait(1)
        aa=aa+_d_aa end end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_last_11-2"]=Class(bullet)
_editor_class["Muki_AiC_last_11-2"].init=function(self,_x,_y,color,a2,v,x,y)
bullet.init(self,star_small,color,true,true)
self.x,self.y=_x,_y
    if IsValid(Noel) then self.rot=Angle(self,Noel)+180 end
    self.a=self.a*0.8
    self.b=self.b*0.8
    --[[ 为了让大家的钻缝体验更好而缩小了判定（
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if flag then break end
            task._Wait(1)
        end
        if color==COLOR_BLUE or color==COLOR_GREEN or color==COLOR_RED then
            self.omiga=3
        else
            self.omiga=-3
        end
        PlaySound("kira00",0.5,self.x/256,true)
        do local vv,_d_vv=(v),(0.008) for _=1,100 do
            SetV2(self,vv,a2,false,false)
            task._Wait(1)
        vv=vv+_d_vv end end
    end)
end
--[[ 我保留了一点名字，这样你才知道这玩意从哪来的（
]]
_editor_class["Muki_AiC_last_slave_wall"]=Class(_object)
_editor_class["Muki_AiC_last_slave_wall"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        for _=1,_infinite do
            do
                local _beg_x=-192 local x=_beg_x local _end_x=192 local _d_x=(_end_x-_beg_x)/(15)
                local _beg_y=-224 local y=_beg_y local _end_y=224 local _d_y=(_end_y-_beg_y)/(15)
                for _=1,15 do
                    last=New(_straight,star_big,COLOR_DEEP_GRAY,x+10*sin(3*self.timer),250,3,-90,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        _object.set_color(self,"add+rev",200,255,255,255)
                        local a=(self.a)
                        local b=(self.b)
                        do
                            local _beg_s=0.75 local s=_beg_s local _end_s=0.1 local _d_s=(_end_s-_beg_s)/(20)
                            for _=1,20 do
                                self.hscale=s
                                self.vscale=s
                                self.a=a*s
                                self.b=b*s
                                task._Wait(1)
                                s=s+_d_s
                            end
                        end
                        _del(self,false)
                    end)
                    last=New(_straight,star_big,COLOR_DEEP_GRAY,x+10*sin(3*self.timer),-250,3,90,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        _object.set_color(self,"add+rev",200,255,255,255)
                        local a=(self.a)
                        local b=(self.b)
                        do
                            local _beg_s=0.75 local s=_beg_s local _end_s=0.1 local _d_s=(_end_s-_beg_s)/(20)
                            for _=1,20 do
                                self.hscale=s
                                self.vscale=s
                                self.a=a*s
                                self.b=b*s
                                task._Wait(1)
                                s=s+_d_s
                            end
                        end
                        _del(self,false)
                    end)
                    last=New(_straight,star_big,COLOR_GRAY,-218,y+10*sin(3*self.timer),3,0,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        _object.set_color(self,"add+rev",200,255,255,255)
                        local a=(self.a)
                        local b=(self.b)
                        do
                            local _beg_s=0.75 local s=_beg_s local _end_s=0.1 local _d_s=(_end_s-_beg_s)/(20)
                            for _=1,20 do
                                self.hscale=s
                                self.vscale=s
                                self.a=a*s
                                self.b=b*s
                                task._Wait(1)
                                s=s+_d_s
                            end
                        end
                        _del(self,false)
                    end)
                    last=New(_straight,star_big,COLOR_GRAY,218,y+10*sin(3*self.timer),3,180,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        _object.set_color(self,"add+rev",200,255,255,255)
                        local a=(self.a)
                        local b=(self.b)
                        do
                            local _beg_s=0.75 local s=_beg_s local _end_s=0.1 local _d_s=(_end_s-_beg_s)/(20)
                            for _=1,20 do
                                self.hscale=s
                                self.vscale=s
                                self.a=a*s
                                self.b=b*s
                                task._Wait(1)
                                s=s+_d_s
                            end
                        end
                        _del(self,false)
                    end)
                    x=x+_d_x
                    y=y+_d_y
                end
            end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_last_slave_wall"].frame=function(self)
    self.class.base.frame(self)
    SetV2(player,1,Angle(player.x,player.y,0,224)+180,false,false)
    if not IsValid(Noel) then
        _del(self,true)
    else
    end
end
_editor_class["Muki_AiC_slave_lsc"]=Class(_object)
_editor_class["Muki_AiC_slave_lsc"].init=function(self,_x,_y,v,a,o,t,da)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_slave"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.omiga=o
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local oo=5*sin(3*self.timer+90)
            self.x,self.y=50*cos(2*oo+self.timer+da),50*sin(2*oo+self.timer+da)
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            do
                local aa=0 local _n_aa=(0)+(180)
                for _=1,2 do
                    do local aaa,_d_aaa=(-30),(30) for _=1,3 do
                        if o==3 then
                            last=New(_straight,grain_c,COLOR_CYAN,self.x,self.y,3,self.rot+aa+aaa,false,0,true,true,0,false,0,0,0,false)
                        else
                            last=New(_straight,grain_c,COLOR_BLUE,self.x,self.y,3,self.rot+aa+aaa,false,0,true,true,0,false,0,0,0,false)
                        end
                        last.a=last.a*0.75
                        last.b=last.b*0.75
                        last.hscale=0.75
                        last.vscale=0.75
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            PlaySound("kira00",0.1,self.x/256,false)
                            if o==3 then
                                last=New(_straight,grain_a,COLOR_CYAN,self.x,self.y,1,self.rot,false,0,true,true,0,false,0,0,0,false)
                            else
                                last=New(_straight,grain_a,COLOR_BLUE,self.x,self.y,1,self.rot,false,0,true,true,0,false,0,0,0,false)
                            end
                            last.a=last.a*0.75
                            last.b=last.b*0.75
                            last.hscale=0.75
                            last.vscale=0.75
                            _del(self,false)
                        end)
                    aaa=aaa+_d_aaa end end
                    aa=-(aa)+_n_aa
                end
            end
            task._Wait(3)
        end
    end)
end
--[[ 对话库，为方便调用先改个名
]]
local lib = aic.custom_dialog
local sc_list = aic.l10n.ui.sc_list
local dialog = aic.l10n.dialog
_editor_class["Muki_AiC_Noel"]=Class(boss)
_editor_class["Muki_AiC_Noel"].cards={}
_editor_class["Muki_AiC_Noel"].name="Noel Cornehl"
_editor_class["Muki_AiC_Noel"].bgm="aic_bgm3"
_editor_class["Muki_AiC_Noel"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Noel"].difficulty="All"
_editor_class["Muki_AiC_Noel"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Noel"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Noel"].difficulty)
    Noel=self
    self.H=not setting.safemode
    aic.ui.SetCardLeft(4,'time')
    aic.ui.SetCardLeft(8,'great')
    aic.ui.SetCardLeft(10,'time')
    aic.ui.SetCardLeft(11,'great')
    self.vscale=0.75
    self.hscale=0.75
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
    last=New(_editor_class["Muki_AiC_shielder"],self.x,self.y,self)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        if not CheckEnhancer(13) then
            task._Wait(60)
            lib.AiCDialog(self,1)
        end
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
--[[ phase1
]]
_tmp_sc=boss.card.New("「通常攻击1」",2,5,60,1200,{0,10,10},false)
function _tmp_sc:before()
    boss.show_aura(self,true)
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord('aic_bgm10')
        _play_music('aic_bgm10',14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,7 do
                    self.hscale=dir*0.75
                    PlaySound("se:Muki_AiC_hit",3,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    boss.cast(self,30)
                    last=New(_editor_class["Muki_AiC_melee"],self.x,self.y,dir)
                    task._Wait(30)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(60)
        do
            local da=15 local _n_da=(15)+(-15)
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                do local a1,_d_a1=(0),(da) for _=1,5 do
                    do
                        local _beg_a=a0+a1 local a=_beg_a local _end_a=a0+a1+360 local _d_a=(_end_a-_beg_a)/(15)
                        for _=1,15 do
                            do
                                local v=2 local _n_v=(2)+(2.2)
                                local aa=-5 local _d_aa=(5)
                                for _=1,3 do
                                    last=New(_straight,ball_mid_c,COLOR_BLUE,self.x,self.y,v,a+aa,false,0,true,true,0,false,0,0,0,false)
                                    v=-(v)+_n_v
                                    aa=aa+_d_aa
                                end
                            end
                            a=a+_d_a
                        end
                    end
                    task._Wait(15)
                a1=a1+_d_a1 end end
                task._Wait(30)
                da=-(da)+_n_da
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击1」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("爆咒「地面炸弹」",2,5,60,800,{10,10,10},true)
function _tmp_sc:before()
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][1])
    if ext.sc_pr and not lstg.var.bgm_playing then
        LoadMusicRecord('aic_bgm10')
        _play_music('aic_bgm10',14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    lasttask=task.New(self,function()
        self.auralist={}
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
            local i=1 local _d_i=(1)
            for _=1,4 do
                last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                self.auralist[i]=last
                task._Wait(30)
                a=a+_d_a
                i=i+_d_i
            end
        end
        do local i,_d_i=(1),(1) for _=1,4 do
            lasttask=task.New(self.auralist[i],function()
                local self=task.GetSelf()
                do
                    local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                    local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                    for _=1,_infinite do
                        self.r=rr
                        self.vscale=scale
                        self.hscale=scale
                        task._Wait(1)
                        _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                        _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                    end
                end
            end)
        i=i+_d_i end end
    end)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            Muki_cast(self,2,90)
            PlaySound("se:Muki_AiC_bomb",1,self.x/256,true)
            PlaySound("kira00",0.75,self.x/256,true)
            local i = ran:Int(0,1)*90
            last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(180+i,270+i),100)
            last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(-30,30)+Angle(self,player),100)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","爆咒「地面炸弹」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 爆咒「地面炸弹　速」
]]
_tmp_sc=boss.card.New("「通常攻击2」",2,5,60,1200,{0,10,10},false)
function _tmp_sc:before()
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord('aic_bgm10')
        _play_music('aic_bgm10',14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,4 do
                    self.hscale=dir*0.75
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                    Muki_cast(self,2,90)
                    PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
                    boss.cast(self,15)
                    last=New(_editor_class["Muki_AiC_melee_casting"],self.x,self.y,dir,1)
                    local a0=(ran:Float(0,360))
                    do
                        local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(12)
                        for _=1,12 do
                            do
                                local aa=0 local _d_aa=(5)
                                local _beg_v=5 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(7-1)
                                for _=1,7 do
                                    last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,v,a+aa,false,0,true,true,0,false,0,0,0,false)
                                    last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,v,a-aa,false,0,true,true,0,false,0,0,0,false)
                                    aa=aa+_d_aa
                                    v=v+_d_v
                                end
                            end
                            a=a+_d_a
                        end
                    end
                    task._Wait(60)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击2」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("箭咒「纯白之弓」",2,5,60,1000,{10,10,10},true)
function _tmp_sc:before()
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][2])
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord('aic_bgm10')
        _play_music('aic_bgm10',14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self.x,self.y+50,player.x,player.y))
                Muki_warning(self,a)
                Muki_cast(self,1,60,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                last=New(_editor_class["Muki_AiC_bow"],self.x,self.y+50,a)
                task._Wait(30)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","箭咒「纯白之弓」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 散咒「纯白之弓　散」
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(60,120,60,MOVE_ACC_DEC))
--[[ phase2
]]
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        self.name='Noel Cornehl & Ixia Polystachya'
        if not CheckEnhancer(13) then
            last=New(_editor_class["Muki_AiC_Ixia"],-384,256,1)
            Muki_fadeout()
            task._Wait(60)
            lib.AiCDialog(self,2)
        else
            last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
            --[[ 这里不知道为啥move无效
            ]]
            New(tasker, function()
lasttask=task.New(last,function () ex.SmoothSetValueTo("x",-60,60,MOVE_ACC_DEC,nil,0,MODE_SET) end )
lasttask=task.New(last,function () ex.SmoothSetValueTo("y",120,60,MOVE_ACC_DEC,nil,0,MODE_SET) end )
            end)
        end
        Muki_fadein('aic_bgm11')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
_tmp_sc=boss.card.New("「通常攻击3」",2,5,60,1000,{0,10,10},false)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,4 do
                    self.hscale=dir*0.75
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                    Muki_cast(self,1,60)
                    PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
                    boss.cast(self,15)
                    last=New(_editor_class["Muki_AiC_melee_casting"],self.x,self.y,dir,2)
                    do
                        local _beg_a=-45 local a=_beg_a local _end_a=45 local _d_a=(_end_a-_beg_a)/(5-1)
                        for _=1,5 do
                            last=New(_straight,arrow_mid,COLOR_CYAN,self.x+50*cos(a)*dir,self.y+50*sin(a),3,a*dir,true,0,true,true,0,false,0,a+Angle(self,player),0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do local t,_d_t=(15),(5) for _=1,_infinite do
                                    if Dist(self,player)>25 and self.y>-200 then
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do
                                            local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(5)
                                            for _=1,5 do
                                                local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                                                local d=(Dist(x,y,self.x,self.y))
                                                local rot=(Angle(x,y,self.x,self.y))
                                                last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                                                lasttask=task.New(last,function()
                                                    local self=task.GetSelf()
                                                    do
                                                        local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                                                        for _=1,30 do
                                                            task._Wait(1)
                                                            v=v+_d_v
                                                        end
                                                    end
                                                end)
                                                aa=aa+_d_aa
                                            end
                                        end
                                    else
                                    end
                                    task._Wait(t)
                                t=t+_d_t end end
                            end)
                            a=a+_d_a
                        end
                    end
                    task._Wait(60)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
    if not CheckEnhancer(13) then
        safeKill(Ixia)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击3」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
_tmp_sc=boss.card.New("引咒「聚能火球」",2,5,60,1000,{10,10,10},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,3)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][3])
    Ixia.spellname=aic.ui.NewSpellname(self, aic.l10n.ui.Ixia_scname[diff],2)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],80,0,'image:Muki_AiC_Ixia_face_default',0.5,80)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            local a=(Muki_get8dir(self,player))
            Muki_cast(self,3,120,a)
            PlaySound("se:Muki_AiC_lightball",4,self.x/256,true)
            last=New(_editor_class["Muki_AiC_fireball"],self.x,self.y,4,a)
            local fireball=(last)
            for _=1,_infinite do
                if not IsValid(fireball) then break end
                task._Wait(1)
            end
            task.MoveToPlayer(30,-96+60,96+60,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(90)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
    safeKill(Ixia)
    if IsValid(Ixia.spellname) then
        _del(Ixia.spellname,true)
    else
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","引咒「聚能火球」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 引咒「聚能火球　改」
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(120,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    last=New(_editor_class["Muki_AiC_Primula"],-384,256,1)
    self.shielder.boss=last
    self.name='Primula'
    --[[ 护盾暂时转让（
    ]]
    lasttask=task.New(self,function()
        if not CheckEnhancer(13) then
            Muki_fadeout(60,true)
            task._Wait(60)
            lib.AiCDialog(self,3)
        else
            safeKill(Ixia)
        end
        Muki_fadein('aic_bgm12')
        safeKill(Ixia)
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
--[[ phase Primula
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(384*2,256*2,120,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「通常攻击4」",2,5,60,1200,{0,0,0},false)
function _tmp_sc:before()
    if ext.sc_pr then
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
    safeKill(Primula)
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击4」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
_tmp_sc=boss.card.New("防咒「魔法障壁」",60,60,60,_infinite,{0,0,0},true)
function _tmp_sc:before()
    local t3=60*60
    AddSPPoint2(0.75,nil,t3)
    AddSPPoint2(0.5,nil,t3)
    AddSPPoint2(0.2,nil,t3)
    if ext.sc_pr then
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,3)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self.shielder.active=true
    Primula.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][4])
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Primula_face_fight')
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
    safeKill(Primula)
    if IsValid(Primula.spellname) then
        _del(Primula.spellname,true)
    else
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","防咒「魔法障壁」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 护咒「魔法加护」
]]
--[[ phase3
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        last=New(_editor_class["Muki_AiC_Ixia"],384,256,6)
        Muki_fadeout(60, true)
        task._Wait(60)
        lib.AiCDialog(self,4)
        safeKill(Primula)
        self.name='Noel Cornehl'
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
_tmp_sc=boss.card.New("「通常攻击-魔法获取」",114514,114514,114514,114514,{0,0,0},false)
function _tmp_sc:before()
    boss.SetUIDisplay(self,true,true,false,false,true,true)
end
function _tmp_sc:init()
    Muki_fadeout(60)
    lasttask=task.New(self,function()
        task._Wait(60)
        task.MoveTo(0,0,60,MOVE_ACC_DEC)
        lasttask=task.New(self,function()
            local dy=(80)
            lasttask=task.New(self,function()
                task._Wait(25)
                last=New(_editor_class["Muki_AiC_cane"],self.x,self.y+dy,self,0.75)
            end)
            self.hide=true
            PlaySound("se:Muki_AiC_magic_getting",1,self.x/256,true)
            local s=(0.65)
            local intv=({5,5,5,5,5,5,5,9,7,7,7,7,7,7,7,9,9,9,9,9,9,9,9,9,9})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic1_',self,25,t,intv,17,25,s,true)
            task._Wait(t)
            local intv=({9,9,9,9,9,9})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic2_',self,6,t+9*3,intv,2,6,s,true)
            task._Wait(t+9*3)
            local intv=({9,9,9,9,9,9,9,9,9,9,9,9,9,9})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic3_',self,14,t,intv,6,14,s,true)
            task._Wait(t)
            local intv=({9,9,9,9,9,9})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic2_',self,6,t+9*3,intv,2,6,s,true)
            task._Wait(t+9*3)
            task._Wait(30)
            local intv=({7,7,7,7,7,7,7,7,7,7,7,7,7,15})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic4_',self,14,t,intv,13,14,s,true)
            task._Wait(t)
            local intv=({15,8,8,8,8,8,8,8,8,8,8,8,8,8,8})
            local t=(aic.table.Sum(intv))
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_get_magic5_',self,15,_infinite,intv,14,15,0.75,false)
            task._Wait(55)
            for _,unit in ObjList(GROUP_GHOST) do
                unit.del=true
            end
            task._Wait(1)
            self.hide=false
            misc.ShakeScreen(60,5)
            misc.ShakeScreen(60,3)
            last=New(_editor_class["Muki_AiC_get_magic_ef1"],self.x,self.y+dy,_)
            for _=1,30 do
                last=New(_editor_class["Muki_AiC_get_magic_ef2"],self.x,self.y,_)
            end
            task._Wait(30)
            for _=1,30 do
                last=New(_editor_class["Muki_AiC_get_magic_ef3"],self.x,self.y,_)
            end
            task._Wait(t-55-30)
            task._Wait(60)
            for _=1,20 do
                last=New(_editor_class["Muki_AiC_get_magic_ef4"],self.x,self.y,_)
            end
            PlaySound("se:Muki_AiC_magic_got",1,self.x/256,true)
            last=New(_editor_class["Muki_AiC_get_magic_ui"],self.x,self.y,_)
            task._Wait(300)
            PlaySound("se:Muki_AiC_magic_got_closed",1,self.x/256,true)
            task._Wait(60)
            self._bosssys:clearBonus()
            self.noresult=true
            _kill(self,true)
            task._Wait(1)
        end)
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_GHOST) do
        unit.del=true
    end
    boss.SetUIDisplay(self,true,true,true,false,true,true)
end
function _tmp_sc:after()
    StopSound('enep02')
    self.noresult=false
    --[[ 不要问为什么放这么多个，我也不知道哪个有用，所以都留着算了
    ]]
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击-魔法获取」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 这不是非符，只是为了不被算作符卡所以加了通常攻击四个字
]]
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        task._Wait(60)
        lib.AiCDialog(self,5)
        Muki_fadein('aic_bgm13')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「通常攻击5」",2,5,60,1200,{0,15,15},false)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(120)
        do
            local dir=1 local _n_dir=(1)+(-1)
            for _=1,_infinite do
                do
                    local t=3 local _n_t=(3)+(5)
                    local o=3 local _n_o=(3)+(1)
                    for _=1,2 do
                        self.hscale=dir*0.75
                        self._wisys = BossWalkImageSystem(self)
                        self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                        Muki_cast(self,4,150,nil,nil,nil,5)
                        PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                        PlaySound("kira00",0.1,self.x/256,false)
                        PlaySound("option",0.8,self.x/256,true)
                        self._wisys = BossWalkImageSystem(self)
                        self._wisys:SetImage("Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
                        boss.cast(self,15)
                        last=New(_editor_class["Muki_AiC_melee_casting"],self.x,self.y,dir,2)
                        do
                            local _beg_a=-45 local a=_beg_a local _end_a=-135 local _d_a=(_end_a-_beg_a)/(2-1)
                            for _=1,2 do
                                PlaySound("tan00",0.1,self.x/256,false)
                                last=New(_editor_class["Muki_AiC_slave1"],self.x,self.y,3,a,o,t)
                                _connect(self,last,0,true)
                                a=a+_d_a
                            end
                        end
                        task._Wait(360)
                        task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                        t=-(t)+_n_t
                        o=-(o)+_n_o
                    end
                end
                dir=-(dir)+_n_dir
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击5」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("唤咒「使魔召唤」",2,5,60,1200,{15,15,15},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][5])
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    if setting.safemode then
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    else
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_lose2')
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        do
            local dir=1 local _n_dir=(1)+(-1)
            for _=1,_infinite do
                do
                    local t=3 local _n_t=(3)+(5)
                    local o=3 local _n_o=(3)+(1)
                    for _=1,2 do
                        self.hscale=dir*0.75
                        self._wisys = BossWalkImageSystem(self)
                        self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                        Muki_cast(self,4,150,nil,nil,nil,5)
                        PlaySound("option",0.8,self.x/256,true)
                        PlaySound("kira00",0.6,self.x/256,true)
                        for _=1,3 do
                            last=New(_editor_class["Muki_AiC_slave2"],self.x,self.y,_)
                            task._Wait(180)
                        end
                        local a0=(ran:Float(0,360))
                        PlaySound("kira00",0.5,self.x/256,true)
                        do
                            local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(12)
                            for _=1,12 do
                                do
                                    local _beg_v=2 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(8-1)
                                    local n=1 local _d_n=(1)
                                    for _=1,8 do
                                        do local aa,_d_aa=(-1/2*(5*n-1)),(5) for _=1,n do
                                            last=New(_editor_class["Muki_AiC_arrow_big"],self.x,self.y,v,a+aa)
                                        aa=aa+_d_aa end end
                                        v=v+_d_v
                                        n=n+_d_n
                                    end
                                end
                                a=a+_d_a
                            end
                        end
                        task._Wait(180)
                        task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                        t=-(t)+_n_t
                        o=-(o)+_n_o
                    end
                end
                dir=-(dir)+_n_dir
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
    for _,unit in ObjList(GROUP_GHOST) do
        unit.del=true
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","唤咒「使魔召唤」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 唤咒「使魔召唤　御」
]]
_tmp_sc=boss.card.New("「通常攻击6」",2,5,60,300,{0,15,15},false)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        local y=(self.y)
        for _=1,_infinite do
            self.colli=false
            task.MoveTo(player.x,y,15,MOVE_ACC_DEC)
            self.colli=true
            New(boss_cast_ef,self.x,self.y,nil,50,100,255,30)
            last=New(_editor_class["Muki_AiC_warning"],self.x,self.y,self.x-50,self.x+50,-224,224,'down',15)
            task._Wait(60)
            PlaySound("se:Muki_AiC_misogi_start",0.6,self.x/256,true)
            last=New(_editor_class["Muki_AiC_boss_image"],self.x,self.y,'image:Muki_AiC_Noel_misogi',self,21,65,3,1,21,0.75)
            last=New(_editor_class["Muki_AiC_ball_big_slave"],self.x,self.y,_)
            lasttask=task.New(self,function()
                do
                    local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(14)
                    for _=1,14 do
                        PlaySound("tan00",0.3,self.x/256,true)
                        do
                            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(12)
                            for _=1,12 do
                                last=New(_straight,arrow_big,COLOR_BLUE,self.x+50*cos(a),self.y+50*sin(a),0,a+aa+180,false,0,true,true,0,false,0.05,a+aa+180,5,false)
                                a=a+_d_a
                            end
                        end
                        task._Wait(3)
                        aa=aa+_d_aa
                    end
                end
                PlaySound("slash",1,self.x/256,true)
                for _=1,100 do
                    local da=({0,180})
                    last=New(_straight,star_small,COLOR_YELLOW,self.x,self.y,ran:Float(0.5,2),da[ran:Int(1,2)]+ran:Float(-30,30),false,3,true,true,0,false,0.05,90+ran:Float(-10,10),0,false)
                end
            end)
            task.MoveTo(self.x,-210,42,MOVE_NORMAL)
            PlaySound("se:Muki_AiC_misogi_end",0.1,self.x/256,false)
            task._Wait(120)
        end
    end)
end
function _tmp_sc:beforedel()
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击6」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("仿魔咒「空中回廊」",2,5,60,1600,{15,15,15},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][6])
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    if setting.safemode then
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    else
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_lose3')
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            local dir=(ran:Int(1,4))
            PlaySound("kira00",0.3,self.x/256,true)
            if dir==1 then
                last=New(_straight,square,COLOR_RED,ran:Float(-192,192),224,3,-90,false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,30,MOVE_NORMAL,nil,0,MODE_SET) end )
                    task._Wait(30)
                    _set_a(self,0.05,-90,false)
                end)
            elseif dir==2 then
                last=New(_straight,square,COLOR_RED,ran:Float(-192,192),-224,3,90,false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,30,MOVE_NORMAL,nil,0,MODE_SET) end )
                    task._Wait(30)
                    _set_a(self,0.05,90,false)
                end)
            elseif dir==3 then
                last=New(_straight,square,COLOR_RED,-192,ran:Float(-224,224),3,0,false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,30,MOVE_NORMAL,nil,0,MODE_SET) end )
                    task._Wait(30)
                    _set_a(self,0.05,0,false)
                end)
            else
                last=New(_straight,square,COLOR_RED,192,ran:Float(-224,224),3,180,false,0,true,true,0,false,0,0,0,false)
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,30,MOVE_NORMAL,nil,0,MODE_SET) end )
                    task._Wait(30)
                    _set_a(self,0.05,180,false)
                end)
            end
            task._Wait(5)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(60)
        do
            local s=1 local _n_s=(1)+(-1)
            for _=1,_infinite do
                do local aa,_d_aa=(0),(s*20) for _=1,18 do
                    PlaySound("tan00",0.1,self.x/256,true)
                    do local a,_d_a=(0),(30) for _=1,12 do
                        last=New(_straight,square,COLOR_CYAN,self.x+30*cos(a+aa),self.y+30*sin(a+aa),2,a+aa,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(60)
                            last=New(_straight,square,COLOR_CYAN,self.x,self.y,2,self.rot+60*s,false,0,true,true,0,false,0,0,0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do
                                    local _beg_aaa=self.rot local aaa=_beg_aaa local _end_aaa=self.rot+780 local _w_aaa=0 local _d_w_aaa=1/(120-1)
                                    local _beg_v=2 local v=_beg_v local _end_v=3 local _w_v=0 local _d_w_v=1/(120-1)
                                    for _=1,120 do
                                        SetV2(self,v,aaa,true,false)
                                        task._Wait(1)
                                        _w_aaa=_w_aaa+_d_w_aaa if _w_aaa<0.5 then aaa=2*(_end_aaa-_beg_aaa)*_w_aaa^2+_beg_aaa else aaa=(_end_aaa-_beg_aaa)*(-2*_w_aaa^2+4*_w_aaa-1)+_beg_aaa end
                                        _w_v=_w_v+_d_w_v if _w_v<0.5 then v=2*(_end_v-_beg_v)*_w_v^2+_beg_v else v=(_end_v-_beg_v)*(-2*_w_v^2+4*_w_v-1)+_beg_v end
                                    end
                                end
                            end)
                            _del(self,true)
                        end)
                    a=a+_d_a end end
                    task._Wait(5)
                aa=aa+_d_aa end end
                task._Wait(180)
                task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                s=-(s)+_n_s
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","仿魔咒「空中回廊」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 仿星咒「银河铁道」/仿月咒「空明流光」
]]
_tmp_sc=boss.card.New("「通常攻击7」",2,5,60,1200,{0,15,15},false)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if (self.x>=180 or self.x<=-180) then
                misc.ShakeScreen(30,3)
                PlaySound("slash",0.1,self.x/256,false)
                self.vx,self.vy=-self.vx,self.vy
                self.ax,self.ay=-self.ax,self.ay
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16-1)
                    for _=1,16 do
                        last=New(_straight,ellipse,COLOR_CYAN,self.x,self.y,1,a,false,0,true,true,0,false,0.025,a,5,false)
                        a=a+_d_a
                    end
                end
            elseif self.y>=210 or self.y<=-210 then
                misc.ShakeScreen(30,3)
                PlaySound("slash",0.1,self.x/256,false)
                self.vx,self.vy=self.vx,-self.vy
                self.ax,self.ay=self.ax,-self.ay
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            self.colli=false
            task.MoveTo(player.x,120,15,MOVE_ACC_DEC)
            self.colli=true
            New(boss_cast_ef,self.x,self.y,nil,50,100,255,30)
            task._Wait(60)
            local intv={6,6,7,8,8,3,3,2,2,2,2,2,2,2,2,2,2,10,10,10,10}
            local flag1,flag2
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_air_attack',self,21,aic.table.Sum(intv,1,9),intv,nil,nil,0.75)
            --[[ 起始动画
            ]]
            task._Wait(aic.table.Sum(intv,1,9))
            last=New(_editor_class["Muki_AiC_eclipse_slave"],self.x,self.y,self,1)
            last=New(_editor_class["Muki_AiC_eclipse_slave"],self.x,self.y,self,-1)
            SetV2(self,1,-135,false,false)
            _set_a(self,0.05,-135,false)
            _forbid_v(self,6,'original','original')
            for _=1,10 do
                PlaySound("se:Muki_AiC_air_attack_start",0.6,self.x/256,true)
                last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_air_attack_loop',self,8,aic.table.Sum(intv,10,17),aic.table.Slice(intv,10,17),nil,nil,0.75)
                --[[ 循环动画
                ]]
                task._Wait(aic.table.Sum(intv,10,17))
            end
            _set_a(self,0,0,false)
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,aic.table.Sum(intv,18,21),MOVE_NORMAL,nil,0,MODE_SET) end )
            last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_air_attack_end',self,4,aic.table.Sum(intv,18,21),aic.table.Slice(intv,18,21),nil,nil,0.75)
            --[[ 结束动画
            ]]
            task._Wait(aic.table.Sum(intv,18,21)+1)
            PlaySound("se:Muki_AiC_air_attack_end",0.1,self.x/256,false)
            self.hide=false
            for _,unit in ObjList(GROUP_GHOST) do
                unit.del=true
            end
            task._Wait(120)
            task.MoveTo(0,120,30,MOVE_ACC_DEC)
            local flag
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(60)
                for _=1,60 do
                    PlaySound("tan00",0.3,self.x/256,true)
                    last=New(_straight,grain_a,COLOR_BLUE,self.x+50*sin(10*self.timer)*cos(a),self.y+50*sin(10*self.timer)*sin(a),0,a,false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        for _=1,_infinite do
                            if flag then break end
                            task._Wait(1)
                        end
                        PlaySound("kira00",0.3,self.x/256,true)
                        SetV2(self,2,self.rot,true,false)
                        _set_a(self,0.05,self.rot,false)
                        _forbid_v(self,6,'original','original')
                    end)
                    task._Wait(3)
                    a=a+_d_a
                end
            end
            flag=true
            task._Wait(120)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.hide=false
    SetV2(self,0,0,false,false)
    _set_a(self,0,0,false)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击7」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("仿赤咒「炎舞神乐」",2,5,60,1000,{15,15,15},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][7])
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    if setting.safemode then
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    else
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_lose4')
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        self._wisys = BossWalkImageSystem(self)
        self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
        task.MoveTo(0,120,60,MOVE_ACC_DEC)
        for _=1,_infinite do
            do
                local aa=0 local _n_aa=(0)+(180)
                for _=1,2 do
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                    Muki_cast(self,4,150,nil,nil,nil,5)
                    PlaySound("option",0.8,self.x/256,true)
                    PlaySound("kira00",0.6,self.x/256,true)
                    last=New(_editor_class["Muki_AiC_slave3"],self.x,self.y,self,3,Angle(self,player))
                    task._Wait(60)
                    do
                        local aaa=0 local _n_aaa=(0)+(180)
                        for _=1,3 do
                            PlaySound("tan00",0.8,self.x/256,true)
                            do
                                local _beg_a=-75 local a=_beg_a local _end_a=75 local _d_a=(_end_a-_beg_a)/(8)
                                for _=1,8 do
                                    last=New(_straight,butterfly,COLOR_RED,self.x,self.y,5,a+aa+aaa,false,0,true,true,0,false,0,0,0,false)
                                    lasttask=task.New(last,function()
                                        local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,30,MOVE_NORMAL,nil,0,MODE_SET) end )
                                        task._Wait(30)
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do
                                            local _beg_v=1 local v=_beg_v local _end_v=5 local _d_v=(_end_v-_beg_v)/(7)
                                            for _=1,7 do
                                                last=New(_straight,water_drop,COLOR_RED,self.x,self.y,v,0,true,0,true,true,0,false,0,0,0,false)
                                                lasttask=task.New(last,function()
                                                    local self=task.GetSelf()
                                                    task._Wait(180)
                                                    _del(self,true)
                                                end)
                                                last=New(_straight,butterfly,COLOR_RED,self.x,self.y,v,0,true,0,true,true,0,false,0,0,0,false)
                                                lasttask=task.New(last,function()
                                                    local self=task.GetSelf()
                                                    task._Wait(180)
                                                    _del(self,true)
                                                end)
                                                v=v+_d_v
                                            end
                                        end
                                        _del(self,false)
                                    end)
                                    a=a+_d_a
                                end
                            end
                            task._Wait(20)
                            aaa=-(aaa)+_n_aaa
                        end
                    end
                    task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                    aa=-(aa)+_n_aa
                end
            end
            Muki_cast(self,4,150,nil,nil,nil,5)
            PlaySound("kira00",0.1,self.x/256,false)
            do local a,_d_a=(-60),(60) for _=1,3 do
                last=New(_editor_class["Muki_AiC_slave3"],self.x,self.y,self,3,a+Angle(self,player))
            a=a+_d_a end end
            task._Wait(180)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","仿赤咒「炎舞神乐」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 仿焱咒「红莲祭仪」/仿彗咒「流星祈愿」
]]
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        Muki_fadeout(60, true)
        task._Wait(60)
        lib.AiCDialog(self,6)
        Muki_fadein('aic_bgm14')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
--[[ phase burst
]]
_tmp_sc=boss.card.New("「不顾一切的圣光爆发！」",2,5,90,4000,{30,30,30},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][8])
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    if setting.safemode then
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    else
        last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_lose4')
    end
end
function _tmp_sc:init()
    AddSPPoint2(0.8,4000,nil)
    AddSPPoint2(0.55,4000,nil)
    AddSPPoint2(0.3,4000,nil)
    local flag1
    local flag2
    local flag3
    local stun=(0)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.hp<self.maxhp*0.75 or self.timer>=45*60 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        flag1=true
        self.protect=true
        if self.timer<45*60 then
            task._Wait(60)
        else
        end
        self.protect=false
        for _=1,_infinite do
            if self.hp<self.maxhp*0.5 or self.timer>=45*60 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        flag2=true
        self.protect=true
        if self.timer<45*60 then
            task._Wait(60)
        else
        end
        self.protect=false
        for _=1,_infinite do
            if self.hp<self.maxhp*0.25 or self.timer>=45*60 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        flag3=true
        self.protect=true
        task._Wait(60)
        self.protect=false
    end)
    --[[ 阶段控制
    ]]
    local flag
    --[[ 圣光爆发的标志
    ]]
    lasttask=task.New(self,function()
        task._Wait(150)
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_burst"],0,0,self,stun>=75,stun)
            for _=1,60 do
                PlaySound("tan00",0.25,self.x/256,true)
                for _=1,3 do
                    local r=(ran:Float(50,300))
                    local a=(ran:Float(0,360))
                    local x=(self.x+r*cos(a))
                    local y=(self.y+r*sin(a))
                    if Dist(x,y,player.x,player.y)>=20 then
                        last=New(_straight,ball_light,COLOR_CYAN,x,y,0,0,false,0,true,true,0,false,0,0,0,false)
                        local s
                        if flag3 then
                            ChangeBulletImage(last,ball_light,COLOR_RED)
                            s=1
                        elseif flag2 then
                            ChangeBulletImage(last,ball_light,COLOR_RED)
                            s=0.8
                        elseif flag1 then
                            ChangeBulletImage(last,ball_light,COLOR_RED)
                            s=0.6
                        else
                            s=0.35
                        end
                        last.hscale=s
                        last.vscale=s
                        last.a=last.a*s
                        last.b=last.b*s
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            for _=1,_infinite do
                                if flag then break end
                                task._Wait(1)
                            end
                            PlaySound("kira00",0.4,self.x/256,true)
                            if flag3 then
                                _set_a(self,0.025,ran:Float(0,360),false)
                                _forbid_v(self,1,'original','original')
                                task._Wait(120)
                                _del(self,true)
                            elseif flag2 then
                                _set_a(self,0.05,ran:Float(0,360),false)
                                _forbid_v(self,2,'original','original')
                                task._Wait(120)
                                _del(self,true)
                            elseif flag1 then
                                _set_a(self,0.075,ran:Float(0,360),false)
                                _forbid_v(self,3,'original','original')
                            else
                                _set_a(self,0.1,ran:Float(0,360),false)
                                _forbid_v(self,4,'original','original')
                            end
                        end)
                    else
                    end
                end
                task._Wait(1)
            end
            task._Wait(60)
            flag=true
            task._Wait(1)
            flag=false
            if ran:Int(0,100)<stun-30 and not flag3 then
                stun=0
                last=New(_editor_class["Muki_AiC_boss_image"],self.x,self.y,'image:Muki_AiC_Noel_burst_stunned',self,8,180,10,nil,nil,0.65)
                for _=1,20 do
                    PlaySound("lgodsget",0.1,self.x/256,false)
                    last=New(_straight,square,COLOR_RED,self.x,self.y-30,ran:Float(2,5),ran:Float(0,360),false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(30)
                        SetV2(self,0,self.rot,true,false)
                        task._Wait(60)
                        _del(self,true)
                    end)
                    task._Wait(6)
                end
                task._Wait(60)
            else
            end
            stun=stun+ran:Int(20,40)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            if flag3 then
                task._Wait(30)
            elseif flag2 then
                task._Wait(60)
            elseif flag1 then
                task._Wait(90)
            else
                task._Wait(120)
            end
        end
    end)
    --[[ phase1 0-45s 4000-3200hp
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if flag1 then break end
            task._Wait(1)
        end
        for _=1,_infinite do
            for _=1,_infinite do
                if flag then break end
                task._Wait(1)
            end
            lasttask=task.New(self,function()
                for _=1,60 do
                    PlaySound("kira00",0.4,self.x/256,true)
                    local r=(50)
                    local a=(ran:Float(0,360))
                    if flag3 then
                        do
                            local _beg_aa=-30 local aa=_beg_aa local _end_aa=30 local _d_aa=(_end_aa-_beg_aa)/(3-1)
                            for _=1,3 do
                                last=New(_straight,knife,COLOR_RED,self.x+r*cos(a),self.y+r*sin(a),5,a+aa,false,0,true,true,0,false,0,0,0,false)
                                aa=aa+_d_aa
                            end
                        end
                    elseif flag2 then
                        do
                            local _beg_aa=-20 local aa=_beg_aa local _end_aa=20 local _d_aa=(_end_aa-_beg_aa)/(2-1)
                            for _=1,2 do
                                last=New(_straight,knife,COLOR_RED,self.x+r*cos(a),self.y+r*sin(a),4,a+aa,false,0,true,true,0,false,0,0,0,false)
                                aa=aa+_d_aa
                            end
                        end
                    else
                        last=New(_straight,knife,COLOR_CYAN,self.x+r*cos(a),self.y+r*sin(a),3,a,false,0,true,true,0,false,0,0,0,false)
                    end
                    task._Wait(1)
                end
            end)
            task._Wait(1)
        end
    end)
    --[[ phase2 0-45s 3200-2200hp
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if flag2 then break end
            task._Wait(1)
        end
        for _=1,_infinite do
            for _=1,_infinite do
                if flag1 then break end
                task._Wait(1)
                lasttask=task.New(self,function()
                    do
                        local _h_a=(45-(-45))/2 local _t_a=(45+(-45))/2 local a=_h_a*sin(0)+_t_a local _w_a=0 local _d_w_a=3
                        local s=1 local _n_s=(1)+(-1)
                        for _=1,2 do
                            local ss=(0.5)
                            if flag3 then
                                ss=1
                            end
                            do
                                local _beg_aa=Angle(self,player) local aa=_beg_aa local _end_aa=Angle(self,player)+360 local _d_aa=(_end_aa-_beg_aa)/(6)
                                for _=1,6 do
                                    do
                                        local a,aa,s,ss = a,aa,s,ss
                                        do
                                            lasttask=task.New(self,function()
                                                do
                                                    local _h_aaa=(90-(0))/2 local _t_aaa=(90+(0))/2 local aaa=_h_aaa*sin(-90)+_t_aaa local _w_aaa=-90 local _d_w_aaa=3*360/(int(120/8)-1)
                                                    for _=1,int(120/8) do
                                                        last=New(_straight,square,COLOR_RED,self.x,self.y,1*s,a+aa+aaa,false,0,true,true,0,false,0.03,a+aa+aaa+90*s,0,false)
                                                        lasttask=task.New(last,function()
                                                            local self=task.GetSelf()
                                                            self.navi=true
                                                            do
                                                                local _h_acc=(0.06*ss-(0.03*ss))/2 local _t_acc=(0.06*ss+(0.03*ss))/2 local acc=_h_acc*sin(0)+_t_acc local _w_acc=0 local _d_w_acc=3*ss
                                                                local _beg_acca=a+aa+aaa+90*s local acca=_beg_acca local _end_acca=a+aa+aaa local _d_acca=(_end_acca-_beg_acca)/(30-1)
                                                                for _=1,30 do
                                                                    _set_a(self,acc,acca,false)
                                                                    task._Wait(1)
                                                                    _w_acc=_w_acc+_d_w_acc acc=_h_acc*sin(_w_acc)+_t_acc
                                                                    acca=acca+_d_acca
                                                                end
                                                            end
                                                        end)
                                                        PlaySound("kira00",0.4,self.x/256,true)
                                                        task._Wait(5)
                                                        _w_aaa=_w_aaa+_d_w_aaa aaa=_h_aaa*sin(_w_aaa)+_t_aaa
                                                    end
                                                end
                                            end)
                                        end
                                    end
                                    aa=aa+_d_aa
                                end
                            end
                            _w_a=_w_a+_d_w_a a=_h_a*sin(_w_a)+_t_a
                            s=-(s)+_n_s
                        end
                    end
                end)
            end
            task._Wait(1)
        end
    end)
    --[[ phase3 0-45s 2200-1200hp
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if flag3 then break end
            task._Wait(1)
        end
        do
            local s=1 local _n_s=(1)+(-1)
            for _=1,_infinite do
                for _=1,_infinite do
                    if flag then break end
                    task._Wait(1)
                end
                do
                    local _beg_a=Angle(self,player) local a=_beg_a local _end_a=Angle(self,player)+360 local _d_a=(_end_a-_beg_a)/(24)
                    for _=1,24 do
                        last=New(_editor_class["Muki_AiC_burst_laser"],self.x,self.y,5,a*s,s)
                        a=a+_d_a
                    end
                end
                task._Wait(1)
                s=-(s)+_n_s
            end
        end
    end)
    --[[ phase4 45-90s 1200-0hp
    ]]
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「不顾一切的圣光爆发！」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 「拼上性命的圣光爆发！」
]]
--[[ phase4
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        Muki_fadeout(60, true)
        task._Wait(60)
        lib.AiCDialog(self,7,1,3)
        do
            local _beg_maxhp=lstg.var.maxhp local maxhp=_beg_maxhp local _end_maxhp=50 local _d_maxhp=(_end_maxhp-_beg_maxhp)/(60-1)
            for _=1,60 do
                lstg.var.maxhp=int(maxhp)
                task._Wait(1)
                maxhp=maxhp+_d_maxhp
            end
        end
        lstg.var.maxhp=50
        lib.AiCDialog(self,7,4)
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
_tmp_sc=boss.card.New("「通常攻击-秘仪之力获取」",114514,114514,114514,114514,{0,0,0},false)
function _tmp_sc:before()
    boss.SetUIDisplay(self,true,true,false,false,true,true)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        player.lock=true
        lstg.var.mp_active=0
        for _=1,5 do
            New(boss_cast_ef,player.x,player.y,nil,255,150,0,30)
            lstg.var.mp_active=lstg.var.mp_active+1
            task._Wait(30)
        end
        PlaySound("se:Muki_AiC_magic_got",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_get_magic_ui"],self.x,self.y,true)
        task._Wait(300)
        PlaySound("se:Muki_AiC_magic_got_closed",1,self.x/256,true)
        task._Wait(60)
        self._bosssys:clearBonus()
        self.noresult=true
        _kill(self,true)
        task._Wait(1)
    end)
end
function _tmp_sc:beforedel()
    self.hide=false
    player.lock=false
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_GHOST) do
        unit.del=true
    end
    boss.SetUIDisplay(self,true,true,true,false,true,true)
end
function _tmp_sc:after()
    StopSound('enep02')
    self.noresult=false
    self.hide=false
    New(tasker, function()
        self.hide=false
    end)
    --[[ 不要问为什么放这么多个，我也不知道哪个有用，所以都留着算了
    ]]
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击-秘仪之力获取」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        task._Wait(60)
        lib.AiCDialog(self,7.5)
        Muki_fadein('aic_bgm15')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
_tmp_sc=boss.card.New("境符「光与影的限间」",2,5,60,1800,{30,30,30},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][9])
    self.shielder.active=false
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_final',0.3)
    lstg.var.mp_active=5
    EndingBFlag=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(120)
        local t=(30)
        do
            local a=0 local _d_a=(15)
            local co=0 local _n_co=(0)+(1)
            local _h_r=(100-(50))/2 local _t_r=(100+(50))/2 local r=_h_r*sin(0)+_t_r local _w_r=0 local _d_w_r=1.5
            for _=1,_infinite do
                local p=(aic.math.polygon(100,4,r,a,self.x,self.y))
                local p2=(aic.math.polygon(100,4,r,a+45,self.x,self.y))
                do local i,_d_i=(1),(1) for _=1,#p do
                    last=New(_editor_class["Muki_AiC_square"],p[i][1],p[i][2],Dist(self.x,self.y,p[i][1],p[i][2])/t,Angle(self.x,self.y,p[i][1],p[i][2])+180,co)
                    last=New(_editor_class["Muki_AiC_square"],p2[i][1],p2[i][2],Dist(self.x,self.y,p2[i][1],p2[i][2])/t,Angle(self.x,self.y,p2[i][1],p2[i][2])+180,co)
                i=i+_d_i end end
                task._Wait(120)
                a=a+_d_a
                co=-(co)+_n_co
                _w_r=_w_r+_d_w_r r=_h_r*sin(_w_r)+_t_r
            end
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(120)
        do
            local co=0 local _n_co=(0)+(1)
            for _=1,_infinite do
                lasttask=task.New(self,function()
                    local a0=(ran:Float(0,360))
                    local a1=(ran:Float(15,60))
                    do
                        local s=1 local _n_s=(1)+(-1)
                        for _=1,2 do
                            do
                                local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(72)
                                for _=1,72 do
                                    last=New(_editor_class["Muki_AiC_square"],self.x+50*cos(a),self.y+50*sin(a),1,a+a1*s,co,true)
                                    a=a+_d_a
                                end
                            end
                            s=-(s)+_n_s
                        end
                    end
                end)
                task._Wait(60)
                co=-(co)+_n_co
            end
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(30)
        last=New(_editor_class["Muki_AiC_restrictor"],0,0,100)
        restrictor=last
    end)
end
function _tmp_sc:beforedel()
    _del(restrictor,true)
    restrictor=nil
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","境符「光与影的限间」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 境界「明与灭的樊笼」
]]
_tmp_sc=boss.card.New("结界「八重护盾结界」",50,50,50,1800,{30,30,30},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][10])
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_final',0.3)
    lstg.var.mp_active=5
end
function _tmp_sc:init()
    local t3=50*60
    for i=1,4 do
        AddSPPoint2(i/5,nil,t3)
    end
    lasttask=task.New(self,function()
        task._Wait(60)
        last=New(_editor_class["Muki_AiC_shield_warning"],self.x,self.y,_)
        task._Wait(90)
        for _=1,_infinite do
            do
                local _beg_x=0 local x=_beg_x local _end_x=192 local _d_x=(_end_x-_beg_x)/(15)
                local _beg_y=0 local y=_beg_y local _end_y=224 local _d_y=(_end_y-_beg_y)/(15)
                for _=1,15 do
                    last=New(_straight,arrow_big,COLOR_CYAN,x,-224,5,Angle(0,-224,192,0),false,0,true,true,0,false,0,0,0,false)
                    last=New(_straight,arrow_big,COLOR_CYAN,192,y,5,Angle(192,0,0,224),false,0,true,true,0,false,0,0,0,false)
                    last=New(_straight,arrow_big,COLOR_CYAN,-x,224,5,Angle(0,224,-192,0),false,0,true,true,0,false,0,0,0,false)
                    last=New(_straight,arrow_big,COLOR_CYAN,-192,-y,5,Angle(-192,0,0,-224),false,0,true,true,0,false,0,0,0,false)
                    x=x+_d_x
                    y=y+_d_y
                end
            end
            task._Wait(3)
        end
    end)
    --[[ 限位弹
    ]]
    lasttask=task.New(self,function()
        task._Wait(120)
        task.MoveTo(0,0,60,MOVE_ACC_DEC)
        player.protect=player.protect+90
        last=New(_editor_class["Muki_AiC_shield2"],self.x,self.y,144,224,-0.5,1,self,_infinite,2)
        --[[ 疑似有问题：额外传参
        ]]
        self.shield2=last
    end)
    --[[ phase1 0-10s 护盾展开
    ]]
    lasttask=task.New(self,function()
        task._Wait(600)
        for _=1,_infinite do
            if self.timer>=1800 then break end
            PlaySound("kira00",0.3,self.x/256,true)
            do
                local _beg_a=Angle(self,player) local a=_beg_a local _end_a=Angle(self,player)+360 local _d_a=(_end_a-_beg_a)/(8)
                for _=1,8 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+30*cos(a),self.y+30*sin(a),1,a,false,1,true,true,0,false,0,0,0,false)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
    --[[ phase2 10-20s 追加中心开花弹
    ]]
    lasttask=task.New(self,function()
        task._Wait(1200)
        do local a,_d_a=(0),(30) for _=1,_infinite do
            if self.timer>=1800 then break end
            PlaySound("tan00",0.3,self.x/256,true)
            do
                local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(6)
                for _=1,6 do
                    if Dist(self.x+50*cos(a)+30*cos(aa),self.y+50*sin(a)+30*sin(aa),player.x,player.y)>30 then
                        last=New(_straight,star_small,COLOR_CYAN,self.x+50*cos(a)+30*cos(aa),self.y+50*sin(a)+30*sin(aa),1,aa,false,-3,true,true,0,false,0,0,0,false)
                    else
                    end
                    if Dist(self.x+50*cos(a+180)+30*cos(aa),self.y+50*sin(a+180)+30*sin(aa),player.x,player.y)>30 then
                        last=New(_straight,star_small,COLOR_CYAN,self.x+50*cos(a+180)+30*cos(aa),self.y+50*sin(a+180)+30*sin(aa),1,aa,false,3,true,true,0,false,0,0,0,false)
                    else
                    end
                    aa=aa+_d_aa
                end
            end
            task._Wait(30)
        a=a+_d_a end end
    end)
    --[[ phase3 20-30s 追加周围开花弹
    ]]
    lasttask=task.New(self,function()
        task._Wait(1800)
        _clear_bullet(false,false)
        player.protect=player.protect+70
        New(boss_cast_ef,self.x,self.y,nil,25,255,255)
        task._Wait(35*2)
        PlaySound("se:Muki_AiC_guard_slash",0.8,self.x/256,true)
        local intv=({5,6,6,7,9,8,6,6,5,5,5,5,5,5,5,5,5})
        last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_guard_slash_start',self,#intv,aic.table.Sum(intv),intv,nil,nil,0.65)
        task._Wait(aic.table.Sum(intv))
        last=New(_editor_class["Muki_AiC_boss_image"],self.x,self.y,'image:Muki_AiC_Noel_guard_slash_loop',self,7,12*7*5,5,nil,nil,0.65)
        lasttask=task.New(self.shield2,function()
            local self=task.GetSelf()
            task.MoveTo(150,0,35,MOVE_DECEL)
            do
                local s=-1 local _n_s=(-1)+(1)
                for _=1,5 do
                    task.MoveTo(150*s,0,70,MOVE_DECEL)
                    s=-(s)+_n_s
                end
            end
            task.MoveTo(0,0,35,MOVE_DECEL)
        end)
        task._Wait(10*35)
        intv={5,5,5,8,8,8,8,8,8,8,8,8}
        last=New(_editor_class["Muki_AiC_boss_image_ex"],self.x,self.y,'image:Muki_AiC_Noel_guard_slash_end',self,#intv,aic.table.Sum(intv),intv,nil,nil,0.65)
        task._Wait(aic.table.Sum(intv)+1)
        self.hide=false
    end)
    --[[ phase4 30-40s 弹幕停止，使用环轨护盾
    ]]
    --[[ 这里本来想加一个护盾冲击的，但是对于怎么流畅地把护盾拆开完全没思路，所以放弃了
    ]]
    lasttask=task.New(self,function()
        task._Wait(2400)
        task._Wait(60)
        self.shield2.state=3
        task._Wait(300)
        self.shield2.state=4
        task._Wait(240)
        self.shield2.state=5
    end)
    --[[ phase5 40-50s 护盾摇晃直至破碎
    ]]
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","结界「八重护盾结界」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 结界「十六重护盾大结界」
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「繁星若梦」",2,5,120,6000,{0,0,50},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][11])
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
    end
    self.spelling=true
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Noel_face_final',0.3)
    lstg.var.mp_active=5
end
function _tmp_sc:init()
    AddSPPoint2(0.8,6000,nil)
    AddSPPoint2(0.5,6000,nil)
    AddSPPoint2(0.2,6000,nil)
    lasttask=task.New(self,function()
        do
            local s=1 local _n_s=(1)+(-1)
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_last_slave1"],self.x,self.y+50*s,self.x,self.y,90,a0+60*s,COLOR_BLUE,7.2,50*s)
                last=New(_editor_class["Muki_AiC_last_slave2"],self.x-100/2*s,self.y+100/2*s,self.x,self.y,90,a0+90*s,COLOR_CYAN,7.2,100*s)
                last=New(_editor_class["Muki_AiC_last_slave1"],self.x,self.y+100*s,self.x,self.y,90,a0+120*s,COLOR_GREEN,7.2,100*s)
                task._Wait(150)
                flag=true
                task._Wait(1)
                flag=false
                task._Wait(150)
                task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                s=-(s)+_n_s
            end
        end
    end)
    --[[ phase1 主弹幕
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.hp<=self.maxhp*0.75 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                PlaySound("kira00",0.6,self.x/256,true)
                last=New(_straight,star_big,COLOR_YELLOW,ran:Float(-192,192),230,2,-90+ran:Float(-15,15),false,-3,true,true,0,false,0,0,0,false)
                _object.set_color(last,"mul+add",200,255,255,255)
                last.a=last.a*0.8
                last.b=last.b*0.8
                task._Wait(5)
            end
        end)
        for _=1,_infinite do
            PlaySound("tan00",0.3,self.x/256,true)
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(24)
                for _=1,24 do
                    last=New(_straight,star_big,COLOR_BLUE,self.x+50*cos(a),self.y+50*sin(a),2,a,false,3,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",200,255,255,255)
                    last.a=last.a*0.8
                    last.b=last.b*0.8
                    a=a+_d_a
                end
            end
            task._Wait(180)
        end
    end)
    --[[ phase2 追加开花大星弹，板顶高光大星弹
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.hp<=self.maxhp*0.5 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        local co=({COLOR_RED,COLOR_ORANGE,COLOR_YELLOW,COLOR_GREEN,COLOR_CYAN,COLOR_BLUE,COLOR_PURPLE})
        do local aa,_d_aa,c,_d_c=(0),(3),(1),(1) for _=1,_infinite do
            PlaySound("kira00",0.6,self.x/256,true)
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                for _=1,8 do
                    last=New(_straight,star_big,co[c%7+1],self.x,self.y,3,a+aa,false,3,true,true,0,false,0,0,0,false)
                    last.a=last.a*0.8
                    last.b=last.b*0.8
                    a=a+_d_a
                end
            end
            task._Wait(30)
        aa=aa+_d_aa c=c+_d_c end end
    end)
    --[[ phase3 追加彩色风车星弹
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.hp<=self.maxhp*0.25 then break end
            task._Wait(1)
        end
        _clear_bullet(true,false)
        player.protect=player.protect+180
        PlaySound("boon01",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_last_slave_wall"],self.x,self.y,_)
    end)
    --[[ phase4 追加触手
    ]]
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self.hp<=20 then break end
            task._Wait(1)
        end
        Noel._bosssys:slow_explode()
        self.hide=true
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    for _,o in ipairs(self.auralist) do
        _del(o,true)
    end
    SetV2(player,0,0,false,false)
    aic.sys.DropPower(10,self.x,self.y)
    lstg.var.timeslow=1
    self.shielder.active=false
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
    _clear_bullet(false,false)
    New(tasker, function()
        SetV2(player,0,0,false,false)
        for _,unit in ObjList(GROUP_GHOST) do
        end
    end)
    if not LSC_SIGN then
        Muki_fadeout()
        PlaySound("se:Muki_AiC_bgm_end",3,self.x/256,true)
    end
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「繁星若梦」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 「月华流转」/「幻梦的摇篮」
]]
_editor_class["Muki_AiC_Mepha"]=Class(boss)
_editor_class["Muki_AiC_Mepha"].cards={}
_editor_class["Muki_AiC_Mepha"].name="Mepha Gridyard"
_editor_class["Muki_AiC_Mepha"].bgm="aic_bgm10"
_editor_class["Muki_AiC_Mepha"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Mepha"].difficulty="All"
_editor_class["Muki_AiC_Mepha"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Mepha"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Mepha"].difficulty)
end
table.insert(_editor_class["Muki_AiC_Mepha"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        task._Wait(60)
        Muki_fadein('aic_bgm17')
        lib.AiCDialog(self,9)
    end)
end
table.insert(_editor_class["Muki_AiC_Mepha"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",114514,114514,114514,1919810,{0,0,0},false)
function _tmp_sc:before()
    boss.SetUIDisplay(self,true,true,false,false,true,true)
    StageFinishFlag=true
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Mepha"].cards,_tmp_sc)

_editor_class["Muki_AiC_Noel_LSC"]=Class(boss)
_editor_class["Muki_AiC_Noel_LSC"].cards={}
_editor_class["Muki_AiC_Noel_LSC"].name="Noel Cornehl"
_editor_class["Muki_AiC_Noel_LSC"].bgm="aic_bgm10"
_editor_class["Muki_AiC_Noel_LSC"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Noel_LSC"].difficulty="All"
_editor_class["Muki_AiC_Noel_LSC"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Noel_LSC"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Noel_LSC"].difficulty)
    Noel=self
    lstg.tmpvar.H=false
    aic.ui.SetCardLeft(1,'time')
    aic.ui.SetCardLeft(2,'time')
    aic.ui.SetCardLeft(3,'time')
    aic.ui.SetCardLeft(4,'time')
    self.vscale=0.75
    self.hscale=0.75
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
    last=New(_editor_class["Muki_AiC_shielder"],self.x,self.y,self)
end
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        task._Wait(60)
        lib.AiCDialog(self,8)
        Muki_fadein('aic_bgm15')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
_tmp_sc=boss.card.New("Reality Reverse  --10%--",70,70,70,114514,{0,0,0},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][12],nil,nil,nil,nil,nil,nil,nil,'magic')
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    --[[ 
    ]]
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","Reality Reverse  --10%--",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("Reality Reverse  --25%--",62,62,62,114514,{0,0,0},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][13],nil,nil,nil,nil,nil,nil,nil,'magic')
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","Reality Reverse  --25%--",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("Reality Reverse  --50%--",2,5,60,114514,{0,0,0},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][14],nil,nil,nil,nil,nil,nil,nil,'magic')
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","Reality Reverse  --50%--",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("Reality Reverse  --80%--",2,5,60,114514,{0,0,0},true)
function _tmp_sc:before()
    self.spellname=aic.ui.NewSpellname(self, sc_list[diff][3][15],nil,nil,nil,nil,nil,nil,nil,'magic')
    self.shielder.active=true
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","Reality Reverse  --80%--",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
--[[ LSC，符卡名应用魔杖文字体
]]
_tmp_sc=boss.card.New("",2,5,60,1800,{0,0,0},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_NORMAL)
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)

_editor_class["Muki_AiC_Alma"]=Class(boss)
_editor_class["Muki_AiC_Alma"].cards={}
_editor_class["Muki_AiC_Alma"].name="Alma Opfebaum"
_editor_class["Muki_AiC_Alma"].bgm="aic_bgm2"
_editor_class["Muki_AiC_Alma"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Alma"].difficulty="All"
_editor_class["Muki_AiC_Alma"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Alma"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Alma"].difficulty)
    Alma=self
    self.vscale=0.7
    self.hscale=0.7
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Alma.png",3,12,{6,12,10},{1,1},5,16,16)
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
    last=New(_editor_class["Muki_AiC_shielder"],self.x,self.y,self)
end
table.insert(_editor_class["Muki_AiC_Alma"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        lib.AiCDialog(self,0)
    end)
end
table.insert(_editor_class["Muki_AiC_Alma"].cards,_tmp_sc)
_tmp_sc=boss.card.New("「道中通常攻击」",2,5,25,800,{0,50,50},false)
function _tmp_sc:before()
    boss.show_aura(self,true)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        local choice
        for _=1,_infinite do
            local new_choice
            repeat 
                new_choice = ran:Int(1,3)
            until (choice~=new_choice)
            choice=new_choice
            if choice==1 then
                local a=(Angle(self.x,self.y+50,player.x,player.y))
                Muki_warning(self,a)
                Muki_cast(self,1,60,a,nil,nil,6)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                last=New(_editor_class["Muki_AiC_bow"],self.x,self.y+50,a)
                task._Wait(30)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            elseif choice==2 then
                local a=(Muki_get8dir(self,player))
                Muki_cast(self,3,120,a,nil,nil,6)
                PlaySound("se:Muki_AiC_lightball",4,self.x/256,true)
                last=New(_editor_class["Muki_AiC_fireball"],self.x,self.y,4,a)
                local fireball=(last)
                for _=1,_infinite do
                    if not IsValid(fireball) then break end
                    task._Wait(1)
                end
            else
                Muki_cast(self,2,90,nil,nil,nil,6)
                PlaySound("se:Muki_AiC_bomb",1,self.x/256,true)
                PlaySound("kira00",0.75,self.x/256,true)
                local i = ran:Int(0,1)*90
                last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(180+i,270+i),100)
                last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(-30,30)+Angle(self,player),100)
            end
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alma"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Alma","「道中通常攻击」",_tmp_sc,#_editor_class["Muki_AiC_Alma"].cards,false})
table.insert(_editor_class["Muki_AiC_Alma"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("水咒「环链水阵」",2,5,25,800,{0,50,50},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        do
            local s=1 local _n_s=(1)+(-1)
            for _=1,_infinite do
                Muki_cast(self,4,90,nil,nil,nil,6)
                PlaySound("se:Muki_AiC_watershard_casting",1,self.x/256,true)
                local r=(50)
                local o=(5)
                local list=({})
                do local i,_d_i=(1),(1) for _=1,8 do
                    last=New(_editor_class["Muki_AiC_watershard"],self.x+r,self.y,self,r,o)
                    list[i]=last
                    task._Wait(360/o/8)
                i=i+_d_i end end
                if s==1 then
                    do local i,_d_i=(1),(1) for _=1,8 do
                        list[i].state='aiming'
                    i=i+_d_i end end
                else
                    do local i,_d_i=(1),(1) for _=1,8 do
                        list[i].state='multi_aiming'
                    i=i+_d_i end end
                end
                task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                task._Wait(30)
                s=-(s)+_n_s
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    aic.sys.DropPower(10,self.x,self.y)
    _drop_item(item_extend,1,self.x,self.y)
    lasttask=task.New(StageMask,function()
        local self=task.GetSelf()
        do
            local _beg_dp=0 local dp=_beg_dp local _end_dp=0.2 local _d_dp=(_end_dp-_beg_dp)/(60)
            for _=1,60 do
                self.dp=dp
                task._Wait(1)
                dp=dp+_d_dp
            end
        end
    end)
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alma"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Alma","水咒「环链水阵」",_tmp_sc,#_editor_class["Muki_AiC_Alma"].cards,false})
_tmp_sc=boss.dialog.New(true)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=true
    self.dialog_displayer=New(dialog_displayer)
    Muki_boss_escape(self,nil,nil,nil,120,true)
end
table.insert(_editor_class["Muki_AiC_Alma"].cards,_tmp_sc)
_tmp_sc=boss.card.New("",2,5,60,1800,{0,0,0},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alma"].cards,_tmp_sc)

_editor_class["Muki_AiC_Ixia"]=Class(enemy)
_editor_class["Muki_AiC_Ixia"].init=function(self,_x,_y,spellnum)
    enemy.init(self,9,114514,false,false,false)
    self.x,self.y=_x,_y
    self.drop={0,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    _connect(Noel,self,1,true)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Ixia.png",3,7,{3,7,1},{1,1},12,16,16)
    self.vscale=0.7
    self.hscale=0.7
    self.bound=false
    self.spellnum=spellnum
    self.group=GROUP_NONTJT
    Ixia=self
    lasttask=task.New(self,function()
        task.MoveTo(-60,120,30,MOVE_ACC_DEC)
    end)
end
_editor_class["Muki_AiC_Ixia"].frame=function(self)
    Print(self.spellnum)
    self.class.base.frame(self)
    if not IsValid(_boss) then
        _del(self,false)
    end
    if not self.spelling then
        self.spelling=true
        if self.spellnum==1 then
        --[[ Dialog
        ]]
        elseif self.spellnum==2 then
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    do
                        local dir=1 local _n_dir=(1)+(-1)
                        for _=1,4 do
                            self.hscale=dir*0.75
                            Muki_cast(self,3,120)
                            PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                            PlaySound("kira00",0.1,self.x/256,false)
                            do
                                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                                for _=1,8 do
                                    last=New(_editor_class["Muki_AiC_fireball_small"],self.x+50*cos(a),self.y+50*sin(a),2.5,a)
                                    a=a+_d_a
                                end
                            end
                            task._Wait(60)
                            dir=-(dir)+_n_dir
                        end
                    end
                    self.hscale=0.75
                    task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                    task._Wait(30)
                end
            end)
        --[[ 通常攻击3
        ]]
        elseif self.spellnum==3 then
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    local a=(Angle(self.x,self.y+50,player.x,player.y))
                    Muki_warning(self,a)
                    Muki_cast(self,1,60,a)
                    PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                    last=New(_editor_class["Muki_AiC_bow"],self.x,self.y+50,a,true)
                    task._Wait(30)
                    PlaySound("slash",4,self.x/256,true)
                    task.MoveToPlayer(15,-96-60,96-60,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                    task._Wait(90)
                end
            end)
        --[[ 追咒「纯白之弓　诱」/追咒「纯白之弓　改」
        ]]
        elseif self.spellnum==4 then
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
            end)
        --[[ Dialog
        ]]
        elseif self.spellnum==5 then
            lasttask=task.New(self,function()
                task.MoveTo(384*2,256*2,120,MOVE_ACC_DEC)
                _del(self,true)
            end)
        elseif self.spellnum==6 then
            lasttask=task.New(self,function()
                task.MoveTo(120,120,60,MOVE_ACC_DEC)
            end)
        --[[ quit
        ]]
        else
            lasttask=task.New(self,function()
                task.MoveTo(384,256,60,MOVE_ACC_DEC)
                _del(self,true)
            end)
        end
    end
end
_editor_class["Muki_AiC_Ixia"].kill=function(self)
    --[[ 模拟boss切卡行为
    ]]
    PreserveObject(self)
    lasttask=task.New(self,function()
        self.spellnum=self.spellnum+1
        self.spelling=false
        task.Clear(self,true)
    end)
end
_editor_class["Muki_AiC_Primula"]=Class(enemy)
_editor_class["Muki_AiC_Primula"].init=function(self,_x,_y,spellnum)
    enemy.init(self,9,114514,false,false,false)
    self.x,self.y=_x,_y
    self.drop={0,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    _connect(Noel,self,1,true)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Muki_AiC_Primula.png",3,7,{3,7,1},{1,1},12,16,16)
    self.bound=false
    self.spellnum=spellnum
    self.group=GROUP_NONTJT
    self.vscale=0.7
    self.hscale=0.7
    Primula=self
    if player.main_target then
        player.main_target=self
    end
    lasttask=task.New(self,function()
        task.MoveTo(-120,120,30,MOVE_ACC_DEC)
    end)
end
_editor_class["Muki_AiC_Primula"].frame=function(self)
    self.class.base.frame(self)
    if not IsValid(_boss) then
        _del(self,false)
    end
    if not self.spelling then
        self.spelling=true
        if self.spellnum==1 then
        --[[ Dialog
        ]]
        elseif self.spellnum==2 then
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                task._Wait(90)
                for _=1,_infinite do
                    do
                        local s=1 local _n_s=(1)+(-1)
                        for _=1,2 do
                            Muki_cast_primula(self,3)
                            task._Wait(60)
                            do
                                local _beg_a=-45 local a=_beg_a local _end_a=45 local _d_a=(_end_a-_beg_a)/(5-1)
                                local co=COLOR_YELLOW local _n_co=(COLOR_YELLOW)+(COLOR_BLUE)
                                for _=1,5 do
                                    last=New(_editor_class["Muki_AiC_square_big"],self.x,self.y,5,Angle(self,player)+a*s,co)
                                    task._Wait(12)
                                    a=a+_d_a
                                    co=-(co)+_n_co
                                end
                            end
                            task._Wait(120)
                            s=-(s)+_n_s
                        end
                    end
                    task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_ACC_DEC,MOVE_X_TOWARDS_PLAYER)
                end
            end)
        --[[ 通常攻击4
        ]]
        elseif self.spellnum==3 then
            aic.sys.DropPower(15,self.x,self.y)
            _drop_item(item_point,15,self.x,self.y)
            _drop_item(item_faith,15,self.x,self.y)
            local color=({COLOR_GRAY,COLOR_CYAN,COLOR_ORANGE})
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_NORMAL)
                task._Wait(60)
                Muki_cast_primula(self,2)
                do local i,_d_i=(1),(1) for _=1,3 do
                    do
                        local dir=1 local _n_dir=(1)+(-1)
                        for _=1,2 do
                            do
                                local dir2=1 local _n_dir2=(1)+(-1)
                                for _=1,2 do
                                    last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,color[i],3,0.02,dir,dir2,50)
                                    dir2=-(dir2)+_n_dir2
                                end
                            end
                            dir=-(dir)+_n_dir
                        end
                    end
                    task._Wait(60)
                i=i+_d_i end end
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,3,0.02,dir,dir2,50)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(30)
                        end
                        task._Wait(90)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(3) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        do local i,_d_i=(1),(1) for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,3.5,0.03,dir,dir2,60)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(25)
                        i=i+_d_i end end
                        task._Wait(75)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(2) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        do local i,_d_i=(1),(1) for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,4,0.04,dir,dir2,70,1)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(20)
                        i=i+_d_i end end
                        task._Wait(45)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(1) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    Muki_cast_primula(self,2)
                    for _=1,_infinite do
                        for _=1,1 do
                            local co=(color[ran:Int(2,3)])
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,0.75,0.05,dir,dir2,100,1.5)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                        end
                        task._Wait(45)
                    end
                end)
            end)
        --[[ 唤咒「使魔召唤」/护咒「魔法加护」
        ]]
        elseif self.spellnum==4 then
            aic.sys.DropPower(15,self.x,self.y)
            _drop_item(item_point,15,self.x,self.y)
            _drop_item(item_faith,15,self.x,self.y)
            lasttask=task.New(self,function()
                task.MoveTo(-120,120,60,MOVE_ACC_DEC)
            end)
        --[[ Dialog
        ]]
        elseif self.spellnum==5 then
            lasttask=task.New(self,function()
                task.MoveTo(0,80,60,MOVE_ACC_DEC)
                last=New(_editor_class["Muki_AiC_magic_authentication_device"],self.x,self.y,_)
                task.MoveTo(384,256,60,MOVE_ACCEL)
                if player.main_target then
                    player.main_target=Noel
                else
                end
                --[[ 念雪自机的适配
                ]]
                Noel.shielder.boss=Noel
                --[[ 归还护盾
                ]]
                _del(self,true)
            end)
        --[[ quit
        ]]
        else
            lasttask=task.New(self,function()
                task.MoveTo(384,256,60,MOVE_ACC_DEC)
                _del(self,true)
            end)
        end
    end
end
_editor_class["Muki_AiC_Primula"].kill=function(self)
    --[[ 模拟boss切卡行为
    ]]
    PreserveObject(self)
    lasttask=task.New(self,function()
        self.spellnum=self.spellnum+1
        self.spelling=false
        task.Clear(self,true)
    end)
end
_editor_class["Muki_AiC_Wave1_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave1_small"].init=function(self,_x,_y,plist,t)
    enemy.init(self,1,25,false,true,false)
    self.x,self.y=_x,_y
    self.drop={1,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.BezierMoveTo(t,MODE_NORMAL,unpack(plist))
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.1,self.x/256,true)
            do
                local _beg_a=-30 local a=_beg_a local _end_a=30 local _d_a=(_end_a-_beg_a)/(5-1)
                for _=1,5 do
                    last=New(_straight,grain_a,COLOR_RED,self.x,self.y,5,a,true,0,true,true,0,false,0,0,0,false)
                    a=a+_d_a
                end
            end
            task._Wait(5)
        end
    end)
end
_editor_class["Muki_AiC_Wave2_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave2_small"].init=function(self,_x,_y,type)
    enemy.init(self,3,25,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,1}
    task.New(self,function() self.protect=true task.Wait(30) self.protect=false end)
    lasttask=task.New(self,function()
        _object.set_color(self,"",0,255,255,255)
        lasttask=task.New(self,function()
            do
                local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(60)
                for _=1,60 do
                    _object.set_color(self,"",al,255,255,255)
                    task._Wait(1)
                    al=al+_d_al
                end
            end
        end)
        if type==1 then
            task.MoveToEx(0,60*type,30,MOVE_DECEL)
            PlaySound("water",0.25,self.x/256,true)
            task._Wait(30)
            for _=1,20 do
                PlaySound("tan00",0.1,self.x/256,true)
                local a=(ran:Float(0,360))
                last=New(_straight,ball_mid_c,COLOR_BLUE,self.x+30*cos(a),self.y+30*sin(a),ran:Float(5,7),0,true,0,true,true,0,false,0,0,0,false)
                task._Wait(3)
            end
            local s=(sign(self.x))
            if s==0 then
                s=ran:Sign()
            else
            end
            task.BezierMoveTo(120,MODE_NORMAL,self.x+s*50,150+ran:Float(-15,15),224*s,150)
        elseif type==-1 then
            task.MoveToEx(0,60*type,30,MOVE_DECEL)
            PlaySound("water",0.25,self.x/256,true)
            task._Wait(30)
            PlaySound("tan00",0.1,self.x/256,true)
            do
                local _beg_v=4 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(6-1)
                local n=1 local _d_n=(1)
                for _=1,6 do
                    do local aa,_d_aa=(-1/2*(4*n-1)),(4) for _=1,n do
                        last=New(_straight,arrow_big,COLOR_BLUE,self.x,self.y,v,aa,true,0,true,true,0,false,0,0,0,false)
                    aa=aa+_d_aa end end
                    v=v+_d_v
                    n=n+_d_n
                end
            end
            task._Wait(60)
            local s=(sign(self.x))
            task.BezierMoveTo(120,MODE_NORMAL,self.x+s*50,150+ran:Float(-15,15),224*s,150)
        elseif type==2 then
            task.MoveToEx(30*type,0,30,MOVE_DECEL)
            PlaySound("water",0.25,self.x/256,true)
            task._Wait(30)
            for _=1,20 do
                PlaySound("tan00",0.1,self.x/256,true)
                local a=(ran:Float(0,360))
                last=New(_straight,ball_mid_c,COLOR_BLUE,self.x+30*cos(a),self.y+30*sin(a),ran:Float(5,7),0,true,0,true,true,0,false,0,0,0,false)
                task._Wait(3)
            end
            local s=(sign(self.x))
            if s==0 then
                s=ran:Sign()
            else
            end
            if s==1 then
                SetV2(self,3,75,false,false)
            else
                SetV2(self,3,105,false,false)
            end
        else
            task.MoveToEx(30*type,0,30,MOVE_DECEL)
            PlaySound("water",0.25,self.x/256,true)
            task._Wait(30)
            do
                local _beg_v=4 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(6-1)
                local n=1 local _d_n=(1)
                for _=1,6 do
                    do local aa,_d_aa=(-1/2*(4*n-1)),(4) for _=1,n do
                        last=New(_straight,arrow_big,COLOR_BLUE,self.x,self.y,v,aa,true,0,true,true,0,false,0,0,0,false)
                    aa=aa+_d_aa end end
                    v=v+_d_v
                    n=n+_d_n
                end
            end
            task._Wait(60)
            local s=(sign(self.x))
            if s==1 then
                SetV2(self,3,75,false,false)
            else
                SetV2(self,3,105,false,false)
            end
        end
        task._Wait(120)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave3_big"]=Class(enemy)
_editor_class["Muki_AiC_Wave3_big"].init=function(self,_x,_y,_)
    enemy.init(self,9,200,false,true,false)
    self.x,self.y=_x,_y
    self.drop={10,10,10}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(-self.x,180,60,MOVE_DECEL)
        do local t,_d_t=(0),(10) for _=1,_infinite do
            PlaySound("tan00",0.1,self.x/256,true)
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(10)
                for _=1,10 do
                    last=New(_straight,arrow_big,COLOR_PURPLE,self.x,self.y,3,a+3^cos(t)*8,false,0,true,true,0,false,0,0,0,false)
                    a=a+_d_a
                end
            end
            task._Wait(3)
        t=t+_d_t end end
    end)
    lasttask=task.New(self,function()
        task._Wait(480)
        task.Clear(self,true)
        task.MoveTo(0,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave3_big"].kill=function(self)
    _drop_item(item_power_full,8,self.x,self.y)
    self.class.base.kill(self)
end
_editor_class["Muki_AiC_Wave3_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave3_small"].init=function(self,_x,_y,plist,t)
    enemy.init(self,3,15,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,1}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.BezierMoveTo(t,MODE_NORMAL,unpack(plist))
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.1,self.x/256,true)
            do
                local _beg_a=-30 local a=_beg_a local _end_a=30 local _d_a=(_end_a-_beg_a)/(3-1)
                for _=1,3 do
                    last=New(_straight,grain_b,COLOR_PURPLE,self.x,self.y,6,a,true,0,true,true,0,false,0,0,0,false)
                    a=a+_d_a
                end
            end
            task._Wait(15)
        end
    end)
end
_editor_class["Muki_AiC_Wave4_big"]=Class(enemy)
_editor_class["Muki_AiC_Wave4_big"].init=function(self,_x,_y,_)
    enemy.init(self,14,600,false,true,false)
    self.x,self.y=_x,_y
    self.drop={10,20,10}
    task.New(self,function() self.protect=true task.Wait(300) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(0,150,60,MOVE_DECEL)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                local a1=(ran:Float(0,360))
                PlaySound("tan00",0.1,self.x/256,true)
                do
                    local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(18)
                    for _=1,18 do
                        last=New(_straight,ball_mid,COLOR_RED,self.x+50*cos(a1),self.y+50*sin(a1),3,a,false,0,true,true,0,false,0,0,0,false)
                        a=a+_d_a
                    end
                end
                task._Wait(45)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                local x=(ran:Float(-150,150))
                local y=(ran:Float(120,180))
                PlaySound("tan00",0.1,self.x/256,true)
                do
                    local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(8)
                    for _=1,8 do
                        last=New(_straight,ball_mid,COLOR_PURPLE,-x+50*cos(a),y+50*sin(a),3,a,false,0,true,true,0,false,0,0,0,false)
                        last=New(_straight,ball_mid,COLOR_PURPLE,x+50*cos(a),y+50*sin(a),3,a,false,0,true,true,0,false,0,0,0,false)
                        a=a+_d_a
                    end
                end
                task._Wait(45)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                local x=(ran:Float(-192,-150))
                local y=(ran:Float(120,180))
                PlaySound("tan00",0.1,self.x/256,true)
                do
                    local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(32)
                    for _=1,32 do
                        last=New(_straight,ball_mid,COLOR_BLUE,-x+50*cos(a),y+50*sin(a),3,a,false,0,true,true,0,false,0,0,0,false)
                        last=New(_straight,ball_mid,COLOR_BLUE,x+50*cos(a),y+50*sin(a),3,a,false,0,true,true,0,false,0,0,0,false)
                        a=a+_d_a
                    end
                end
                task._Wait(60)
            end
        end)
        lasttask=task.New(self,function()
            local n=(16)
            for _=1,_infinite do
                PlaySound("tan00",0.1,self.x/256,true)
                do
                    local _beg_a=360/n/2 local a=_beg_a local _end_a=360+360/n/2 local _d_a=(_end_a-_beg_a)/(n)
                    for _=1,n do
                        last=New(_straight,ellipse,COLOR_BLUE,self.x,self.y,7,a,false,0,true,true,0,false,0,0,0,false)
                        a=a+_d_a
                    end
                end
                task._Wait(10)
            end
        end)
    end)
    lasttask=task.New(self,function()
        task._Wait(420)
        task.Clear(self,true)
        task.MoveTo(0,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave4_big"].kill=function(self)
    _drop_item(item_power_large,1,self.x,self.y)
    self.class.base.kill(self)
end
_editor_class["Muki_AiC_Wave4_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave4_small"].init=function(self,_x,_y,plist,t)
    enemy.init(self,5,30,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,1}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.CRMoveTo(t,MODE_NORMAL,unpack(plist))
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.1,self.x/256,true)
            local a0=(ran:Float(0,360))
            do
                local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(12)
                for _=1,12 do
                    last=New(_straight,ball_mid,COLOR_YELLOW,self.x,self.y,5,a,false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",3,60,MOVE_NORMAL,nil,0,MODE_SET) end )
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
_editor_class["Muki_AiC_Wave5_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave5_small"].init=function(self,_x,_y,_)
    enemy.init(self,5,50,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,1}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        PlaySound("water",0.25,self.x/256,true)
        lasttask=task.New(self,function()
            do
                local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(30-1)
                for _=1,30 do
                    _object.set_color(self,"",al,255,255,255)
                    task._Wait(1)
                    al=al+_d_al
                end
            end
        end)
        self.angle=Angle(0,120,player.x,player.y)
        task.MoveToEx(30*cos(self.angle+180),30*sin(self.angle+180),60,MOVE_DECEL)
        _set_a(self,0.05,self.angle,false)
        PlaySound("kira00",0.25,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,_infinite do
                if self.y<=-50 then break end
                local a0=(ran:Float(0,360))
                do
                    local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,star_small,COLOR_BLUE,self.x,self.y,1.5,a,false,3,true,true,0,false,0,0,0,false)
                        a=a+_d_a
                    end
                end
                task._Wait(30)
            end
        end)
        last=New(_editor_class["Muki_AiC_Wave5_laser"],self.x,self.y,0.05,self.angle,self)
        _connect(self,last,0,true)
    end)
end
_editor_class["Muki_AiC_Wave5_laser"]=Class(laser)
_editor_class["Muki_AiC_Wave5_laser"].init=function(self,_x,_y,acc,angle,master)
    laser.init(self,COLOR_BLUE,_x,_y,0,0,0,0,24,8,0)
    laser.ChangeImage(self,4)
    lasttask=task.New(self,function()
        self.rot=angle
        laser._TurnOn(self,1,false,false)
        for _=1,_infinite do
            if not IsValid(master) then
                _del(self,true)
            end
            self.l2=1/2*acc*(self.timer^2)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_Wave6_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave6_small"].init=function(self,_x,_y,plist,t)
    enemy.init(self,5,30,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,1}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.CRMoveTo(t,MODE_NORMAL,unpack(plist))
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.1,self.x/256,true)
            local a0=(ran:Float(0,360))
            do
                local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(12)
                for _=1,12 do
                    last=New(_straight,ball_mid,COLOR_YELLOW,self.x,self.y,5,a,false,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",3,60,MOVE_NORMAL,nil,0,MODE_SET) end )
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
_editor_class["Muki_AiC_Wave8_ghost"]=Class(enemy)
_editor_class["Muki_AiC_Wave8_ghost"].init=function(self,_x,_y,type)
    enemy.init(self,type,30,false,true,false)
    self.x,self.y=_x,_y
    self.drop={0,3,5}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    self.type=type
    lasttask=task.New(self,function()
        _object.set_color(self,"",0,255,255,255)
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(60)
            for _=1,60 do
                _object.set_color(self,"",al,255,255,255)
                task._Wait(1)
                al=al+_d_al
            end
        end
        PlaySound("tan00",0.4,self.x/256,true)
        if type==27 then
            do
                local _beg_v=3 local v=_beg_v local _end_v=4 local _d_v=(_end_v-_beg_v)/(5-1)
                for _=1,5 do
                    do
                        local _beg_a=-30 local a=_beg_a local _end_a=30 local _d_a=(_end_a-_beg_a)/(5)
                        for _=1,5 do
                            last=New(_straight,grain_a,COLOR_RED,self.x,self.y,v,a,true,0,true,true,0,false,0,0,0,false)
                            a=a+_d_a
                        end
                    end
                    v=v+_d_v
                end
            end
        else
            do
                local _beg_v=3 local v=_beg_v local _end_v=4 local _d_v=(_end_v-_beg_v)/(5-1)
                for _=1,5 do
                    do
                        local _beg_a=-30 local a=_beg_a local _end_a=30 local _d_a=(_end_a-_beg_a)/(4)
                        for _=1,4 do
                            last=New(_straight,grain_a,COLOR_BLUE,self.x,self.y,v,a,true,0,true,true,0,false,0,0,0,false)
                            a=a+_d_a
                        end
                    end
                    v=v+_d_v
                end
            end
        end
        task._Wait(180)
        SetV2(self,2,90,false,false)
    end)
end
_editor_class["Muki_AiC_Wave8_ghost"].kill=function(self)
    New(tasker, function()
        if self.type==27 then
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,grain_c,COLOR_RED,self.x,self.y,2,a,true,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        self.navi=true
                        for _=1,120 do
                            _set_a(self,0.025,0,true)
                            task._Wait(1)
                        end
                    end)
                    a=a+_d_a
                end
            end
        else
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,grain_c,COLOR_BLUE,self.x,self.y,2,a,true,0,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        self.navi=true
                        for _=1,120 do
                            _set_a(self,0.025,0,true)
                            task._Wait(1)
                        end
                    end)
                    a=a+_d_a
                end
            end
        end
    end)
    self.class.base.kill(self)
end
_editor_class["Muki_AiC_Wave9_mid"]=Class(enemy)
_editor_class["Muki_AiC_Wave9_mid"].init=function(self,_x,_y,st,slow)
    enemy.init(self,st,100,false,true,false)
    self.x,self.y=_x,_y
    self.drop={5,3,5}
    task.New(self,function() self.protect=true task.Wait(60) self.protect=false end)
    lasttask=task.New(self,function()
        local co
        local s
        local t
        if st==7 then
            co=COLOR_RED
            s=1
        else
            co=COLOR_BLUE
            s=-1
        end
        if slow then
            t=7
            self.hp=self.hp-50
        else
            t=5
            self.hp=self.hp-50
        end
        task.MoveTo(self.x,180,60,MOVE_DECEL)
        do local a1,_d_a1=(0),(5*sign(self.x)*s) for _=1,_infinite do
            PlaySound("kira00",0.25,self.x/256,true)
            do
                local _beg_a2=0 local a2=_beg_a2 local _end_a2=360 local _d_a2=(_end_a2-_beg_a2)/(9)
                local v=4 local _n_v=(4)+(2)
                for _=1,9 do
                    last=New(_straight,star_small,co,self.x+25*cos(a2),self.y+25*sin(a2),v,a1+a2,false,3*sign(self.x)*s,true,true,0,false,0.05,a1+a2-30*sign(self.x)*s,0,false)
                    _forbid_v(last,5,'original','original')
                    _object.set_color(last,"mul+add",200,255,255,255)
                    a2=a2+_d_a2
                    v=-(v)+_n_v
                end
            end
            task._Wait(t)
        a1=a1+_d_a1 end end
    end)
    lasttask=task.New(self,function()
        task._Wait(300)
        task.MoveTo(self.x,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave9_mid"].kill=function(self)
    self.class.base.kill(self)
    _drop_item(item_power_full,8,self.x,self.y)
end
_editor_class["Muki_AiC_Wave9_big"]=Class(enemy)
_editor_class["Muki_AiC_Wave9_big"].init=function(self,_x,_y,_)
    enemy.init(self,9,400,false,true,false)
    self.x,self.y=_x,_y
    self.drop={10,10,10}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(self.x,180,60,MOVE_DECEL)
        do local a1,_d_a1=(0),(10) for _=1,_infinite do
            PlaySound("kira00",0.25,self.x/256,true)
            do
                local _beg_a2=0 local a2=_beg_a2 local _end_a2=360 local _d_a2=(_end_a2-_beg_a2)/(7)
                local v=4 local _n_v=(4)+(2)
                local co=COLOR_BLUE local _n_co=(COLOR_BLUE)+(COLOR_YELLOW)
                for _=1,7 do
                    last=New(_straight,star_big,co,self.x+25*cos(a2),self.y+25*sin(a2),v,a1+a2,false,3,true,true,0,false,0.02,a1+a2,0,false)
                    _forbid_v(last,5,'original','original')
                    _object.set_color(last,"mul+add",200,255,255,255)
                    a2=a2+_d_a2
                    v=-(v)+_n_v
                    co=-(co)+_n_co
                end
            end
            task._Wait(3)
        a1=a1+_d_a1 end end
    end)
    lasttask=task.New(self,function()
        task._Wait(60)
        do local a1,_d_a1=(0),(-10) for _=1,_infinite do
            PlaySound("kira00",0.25,self.x/256,true)
            do
                local _beg_a2=0 local a2=_beg_a2 local _end_a2=360 local _d_a2=(_end_a2-_beg_a2)/(7)
                local v=4 local _n_v=(4)+(2)
                local co=COLOR_BLUE local _n_co=(COLOR_BLUE)+(COLOR_YELLOW)
                for _=1,7 do
                    last=New(_straight,star_big,co,self.x+25*cos(a2),self.y+25*sin(a2),v,a1+a2,false,-3,true,true,0,false,0.02,a1+a2,0,false)
                    _forbid_v(last,5,'original','original')
                    _object.set_color(last,"mul+add",200,255,255,255)
                    a2=a2+_d_a2
                    v=-(v)+_n_v
                    co=-(co)+_n_co
                end
            end
            task._Wait(3)
        a1=a1+_d_a1 end end
    end)
    lasttask=task.New(self,function()
        task._Wait(360)
        task.MoveTo(self.x,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave9_big"].kill=function(self)
    _drop_item(item_power_full,20,self.x,self.y)
    self.class.base.kill(self)
end
_editor_class["Muki_AiC_Wave10_mid"]=Class(enemy)
_editor_class["Muki_AiC_Wave10_mid"].init=function(self,_x,_y,co,a)
    enemy.init(self,8,100,false,true,false)
    self.x,self.y=_x,_y
    self.drop={5,3,5}
    task.New(self,function() self.protect=true task.Wait(60) self.protect=false end)
    SetV2(self,1.5,a,false,false)
    local s
    if a==-30 then
        s=1
    else
        s=-1
    end
    last=New(_editor_class["Muki_AiC_Wave10_laser"],self.x,self.y-20,self,co,50,s)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local p1=(aic.math.eclipse(16,50,25,45,self.x,self.y))
            local p2=(aic.math.eclipse(16,50,25,135,self.x,self.y))
            do local i,_d_i=(1),(1) for _=1,#p1 do
                last=New(_straight,star_small,co,p1[i][1],p1[i][2],2,Angle(p1[i][1],p1[i][2],self.x,self.y)+180,false,-3,true,true,0,false,0,0,0,false)
            i=i+_d_i end end
            do local i,_d_i=(1),(1) for _=1,#p2 do
                last=New(_straight,star_small,co,p2[i][1],p2[i][2],2,Angle(p2[i][1],p2[i][2],self.x,self.y)+180,false,-3,true,true,0,false,0,0,0,false)
            i=i+_d_i end end
            PlaySound("tan00",0.1,self.x/256,true)
            task._Wait(180)
        end
    end)
end
_editor_class["Muki_AiC_Wave10_laser"]=Class(laser)
_editor_class["Muki_AiC_Wave10_laser"].init=function(self,_x,_y,master,co,l,s)
    laser.init(self,co,_x,_y,0,0,l/2,l/2,8,4,0)
    
    self.bound=false
    self.rot=-90
    _connect(master,self,0,true)
    lasttask=task.New(self,function()
        laser._TurnOn(self,1,false,false)
        for _=1,_infinite do
            local a0=(ran:Float(0,360))
            PlaySound("kira00",0.25,self.x/256,true)
            do
                local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(5)
                for _=1,5 do
                    last=New(_straight,star_big,co,self.x+10*cos(a),self.y+10*sin(a)-l,1,a+180,false,3*s,true,true,0,false,0,0,0,false)
                    _object.set_color(last,"mul+add",200,255,255,255)
                    a=a+_d_a
                end
            end
            task._Wait(45)
        end
    end)
end
_editor_class["Muki_AiC_Wave10_laser"].frame=function(self)
    _set_rel_pos(self,0,-20,-90,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_Wave11_small"]=Class(enemy)
_editor_class["Muki_AiC_Wave11_small"].init=function(self,_x,_y,y)
    enemy.init(self,1,30,false,true,false)
    self.x,self.y=_x,_y
    self.drop={2,3,5}
    task.New(self,function() self.protect=true task.Wait(30) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(self.x,y,60,MOVE_DECEL)
        for _=1,_infinite do
            local co=({COLOR_RED,COLOR_ORANGE,COLOR_YELLOW,COLOR_GREEN,COLOR_CYAN,COLOR_BLUE,COLOR_PURPLE})
            last=New(_editor_class["Muki_AiC_Wave11_laser_bullet"],self.x,self.y,25,12,5,ran:Float(0,360),6,co[ran:Int(1,7)])
            task._Wait(5)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(300)
        task.MoveTo(self.x,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave11_mid"]=Class(enemy)
_editor_class["Muki_AiC_Wave11_mid"].init=function(self,_x,_y,y)
    enemy.init(self,7,75,false,true,false)
    self.x,self.y=_x,_y
    self.drop={5,5,10}
    task.New(self,function() self.protect=true task.Wait(30) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(self.x,y,60,MOVE_DECEL)
        for _=1,_infinite do
            local co=({COLOR_RED,COLOR_ORANGE,COLOR_YELLOW,COLOR_GREEN,COLOR_CYAN,COLOR_BLUE,COLOR_PURPLE})
            last=New(_editor_class["Muki_AiC_Wave11_laser_bullet"],self.x,self.y,50,24,3.5,ran:Float(0,360),4,co[ran:Int(1,7)],60)
            task._Wait(10)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(300)
        task.MoveTo(self.x,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave11_big"]=Class(enemy)
_editor_class["Muki_AiC_Wave11_big"].init=function(self,_x,_y,_)
    enemy.init(self,9,200,false,true,false)
    self.x,self.y=_x,_y
    self.drop={15,15,15}
    task.New(self,function() self.protect=true task.Wait(30) self.protect=false end)
    lasttask=task.New(self,function()
        task.MoveTo(self.x,120,60,MOVE_DECEL)
        for _=1,_infinite do
            local co=({COLOR_RED,COLOR_ORANGE,COLOR_YELLOW,COLOR_GREEN,COLOR_CYAN,COLOR_BLUE,COLOR_PURPLE})
            last=New(_editor_class["Muki_AiC_Wave11_laser_bullet"],self.x,self.y,100,40,2,ran:Float(0,360),2,co[ran:Int(1,7)],60)
            task._Wait(15)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(300)
        task.MoveTo(self.x,256,60,MOVE_ACCEL)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_Wave11_laser"]=Class(laser)
_editor_class["Muki_AiC_Wave11_laser"].init=function(self,_x,_y,x1,y1,x2,y2,w,co)
    laser.init(self,co,_x,_y,0,Dist(x1,y1,x2,y2)/6,Dist(x1,y1,x2,y2)/6*4,Dist(x1,y1,x2,y2)/6,w,0,0)
    laser.ChangeImage(self,4)
    self.rot=Angle(x1,y1,x2,y2)
    self.bound=false
    lasttask=task.New(self,function()
        laser._TurnOn(self,1,false,false)
        task._Wait(1)
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Wave11_laser_bullet"]=Class(_object)
_editor_class["Muki_AiC_Wave11_laser_bullet"].init=function(self,_x,_y,n,r,v,a,o,co,t)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_INDES
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.omiga=o
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if t and self.timer>=t then break end
            task._Wait(1)
            local p=(aic.math.star(n,r,self.rot,self.x,self.y))
            do local i,_d_i=(1),(1) for _=1,#p do
                if i==#p then
                    last=New(_editor_class["Muki_AiC_Wave11_laser"],p[i][1],p[i][2],p[i][1],p[i][2],p[1][1],p[1][2],2,co)
                else
                    last=New(_editor_class["Muki_AiC_Wave11_laser"],p[i][1],p[i][2],p[i][1],p[i][2],p[i+1][1],p[i+1][2],2,co)
                end
            i=i+_d_i end end
        end
        for _=1,_infinite do
            task._Wait(1)
            local p=(aic.math.star(int(n/4),r,self.rot,self.x,self.y))
            do local i,_d_i=(1),(1) for _=1,#p do
                last=New(_straight,star_small,co,p[i][1],p[i][2],0,Angle(self.x,self.y,p[i][1],p[i][2])+o*self.timer,false,o,true,true,0,false,0,0,0,false)
                last.timer=11
                last._graze=true
                lasttask=task.New(last,function()
                    local self=task.GetSelf()
                    task._Wait(1)
                    _del(self,false)
                end)
            i=i+_d_i end end
        end
    end)
end
stage.group.New('menu',{},"Normal",{lifeleft=5,power=400,faith=50000,bomb=3},true,2)
stage.group.AddStage('Normal','AliceInCradle@Normal',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('AliceInCradle@Normal','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        New(magic_forest_fast_background)
        LoadMusicRecord("aic_bgm9")
        _play_music("aic_bgm9")
        --[[ 初始化难度
        ]]
        EndingBFlag=false
        diff = GetDiff()
        --[[ 初始化存档
        ]]
        if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
            aic.pmode.InitFunc()
            aic.pmode.Save()
        end
        StageLoadingSign = true
        task._Wait(120)
        StageLoadingSign = false
        last=New(_editor_class["Muki_AiC_stage_mask"],0,0,_)
        StageMask=last
        do
            local s=1 local _n_s=(1)+(-1)
            local _beg_dx=0 local dx=_beg_dx local _end_dx=-50 local _d_dx=(_end_dx-_beg_dx)/(16-1)
            for _=1,16 do
                last=New(_editor_class["Muki_AiC_Wave1_small"],(180+dx)*s,256,{50*s,180,-224*s,120},180)
                task._Wait(30)
                s=-(s)+_n_s
                dx=dx+_d_dx
            end
        end
        task._Wait(120)
        do
            local _beg_x=-100 local x=_beg_x local _end_x=100 local _d_x=(_end_x-_beg_x)/(8)
            local type=1 local _n_type=(1)+(-1)
            for _=1,8 do
                last=New(_editor_class["Muki_AiC_Wave2_small"],x,125,type)
                task._Wait(30)
                x=x+_d_x
                type=-(type)+_n_type
            end
        end
        do
            local _beg_x=100 local x=_beg_x local _end_x=-100 local _d_x=(_end_x-_beg_x)/(8)
            local type=1 local _n_type=(1)+(-1)
            for _=1,8 do
                last=New(_editor_class["Muki_AiC_Wave2_small"],x,75,type)
                task._Wait(30)
                x=x+_d_x
                type=-(type)+_n_type
            end
        end
        task._Wait(240)
        --[[ sign
        ]]
        last=New(_editor_class["Muki_AiC_Wave3_big"],-80,256,_)
        for _=1,8 do
            last=New(_editor_class["Muki_AiC_Wave3_small"],-256,120,{-224,120,0,150,224,200},120)
            task._Wait(30)
        end
        last=New(_editor_class["Muki_AiC_Wave3_big"],80,256,_)
        for _=1,8 do
            last=New(_editor_class["Muki_AiC_Wave3_small"],256,120,{224,120,0,150,-224,200},120)
            task._Wait(30)
        end
        task._Wait(120)
        last=New(_editor_class["Muki_AiC_stage_logo"],0,0,_)
        task._Wait(360)
        last=New(_editor_class["Muki_AiC_Wave4_big"],0,256,_)
        task._Wait(120)
        for _=1,7 do
            last=New(_editor_class["Muki_AiC_Wave4_small"],-256,90,{-224,120,-192,90,-160,60,-128,90,-96,120,-64,90,-32,60,0,90,32,120,64,90,96,60,128,90,160,120,192,90,224,60,256,90},240)
            task._Wait(60)
        end
        task._Wait(120)
        for _=1,6 do
            do
                local _beg_x=-175 local x=_beg_x local _end_x=175 local _d_x=(_end_x-_beg_x)/(7-1)
                for _=1,7 do
                    last=New(_editor_class["Muki_AiC_Wave5_small"],x,ran:Float(120,180),_)
                    x=x+_d_x
                end
            end
            task._Wait(180)
        end
        task._Wait(180)
        local _boss_wait=true
        local _ref=New(_editor_class["Muki_AiC_Alma"],_editor_class["Muki_AiC_Alma"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        task._Wait(120)
        do
            local type=1 local _n_type=(1)+(-1)
            for _=1,_infinite do
                if StageMask.timer>=7260 then break end
                last=New(_editor_class["Muki_AiC_Wave2_small"],ran:Float(-150,150),125,type)
                task._Wait(30)
                type=-(type)+_n_type
            end
        end
        do
            local _beg_y=0 local y=_beg_y local _end_y=200 local _d_y=(_end_y-_beg_y)/(8)
            local type=2 local _n_type=(2)+(-2)
            local x=-100 local _n_x=(-100)+(100)
            for _=1,8 do
                last=New(_editor_class["Muki_AiC_Wave2_small"],x,y,type)
                task._Wait(30)
                y=y+_d_y
                type=-(type)+_n_type
                x=-(x)+_n_x
            end
        end
        task._Wait(120)
        do
            local _beg_y=200 local y=_beg_y local _end_y=0 local _d_y=(_end_y-_beg_y)/(8)
            local type=2 local _n_type=(2)+(-2)
            local x=75 local _n_x=(75)+(-75)
            for _=1,8 do
                last=New(_editor_class["Muki_AiC_Wave2_small"],x,y,type)
                task._Wait(30)
                y=y+_d_y
                type=-(type)+_n_type
                x=-(x)+_n_x
            end
        end
        do
            local _beg_x=-175 local x=_beg_x local _end_x=175 local _d_x=(_end_x-_beg_x)/(12)
            for _=1,12 do
                last=New(_editor_class["Muki_AiC_Wave8_ghost"],x,ran:Float(90,180),27)
                PlaySound("boon00",0.8,self.x/256,true)
                task._Wait(10)
                x=x+_d_x
            end
        end
        do
            local type=27 local _n_type=(27)+(28)
            local _beg_x=175 local x=_beg_x local _end_x=-175 local _d_x=(_end_x-_beg_x)/(12)
            for _=1,12 do
                last=New(_editor_class["Muki_AiC_Wave8_ghost"],x,ran:Float(90,180),28)
                PlaySound("boon00",0.8,self.x/256,true)
                task._Wait(10)
                type=-(type)+_n_type
                x=x+_d_x
            end
        end
        task._Wait(180)
        task._Wait(60)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],-120,256,8)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],120,256,8)
        task._Wait(300)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],-40,256,7)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],40,256,7)
        task._Wait(300)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],-120,256,8,true)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],120,256,8,true)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],-40,256,7,true)
        last=New(_editor_class["Muki_AiC_Wave9_mid"],40,256,7,true)
        task._Wait(420)
        last=New(_editor_class["Muki_AiC_Wave9_big"],0,256,_)
        task._Wait(360)
        lasttask=task.New(self,function()
            local flag=(true)
            for _=1,1260 do
                if KeyIsPressed('spell') or player.death ~= 0 then
                    flag=false
                else
                end
                task._Wait(1)
            end
            _clear_bullet(false,false)
            if flag then
                PlaySound("bonus2",0.1,self.x/256,false)
                _drop_item(item_extend,1,0,120)
            else
            end
        end)
        local co=({COLOR_RED,COLOR_ORANGE,COLOR_YELLOW,COLOR_GREEN,COLOR_CYAN,COLOR_BLUE,COLOR_PURPLE})
        do
            local a=-15 local _n_a=(-15)+(195)
            local x=-224 local _n_x=(-224)+(224)
            for _=1,2 do
                do
                    local i=1 local _d_i=(1)
                    local _beg_y=200 local y=_beg_y local _end_y=150 local _d_y=(_end_y-_beg_y)/(7-1)
                    for _=1,7 do
                        last=New(_editor_class["Muki_AiC_Wave10_mid"],x,y,co[i],a)
                        task._Wait(60)
                        i=i+_d_i
                        y=y+_d_y
                    end
                end
                a=-(a)+_n_a
                x=-(x)+_n_x
            end
        end
        local a=(-15)
        local x=(-224)
        do
            local i=1 local _d_i=(1)
            local _beg_y=200 local y=_beg_y local _end_y=165 local _d_y=(_end_y-_beg_y)/(5-1)
            for _=1,5 do
                last=New(_editor_class["Muki_AiC_Wave10_mid"],x,y,co[i],a)
                task._Wait(60)
                i=i+_d_i
                y=y+_d_y
            end
        end
        task._Wait(120)
        task._Wait(120)
        do
            local _beg_x=-120 local x=_beg_x local _end_x=120 local _d_x=(_end_x-_beg_x)/(7-1)
            local y=150 local _n_y=(150)+(90)
            for _=1,7 do
                last=New(_editor_class["Muki_AiC_Wave11_small"],x,256,y)
                x=x+_d_x
                y=-(y)+_n_y
            end
        end
        task._Wait(360)
        do
            local _beg_x=-120 local x=_beg_x local _end_x=120 local _d_x=(_end_x-_beg_x)/(5-1)
            local y=150 local _n_y=(150)+(90)
            for _=1,5 do
                last=New(_editor_class["Muki_AiC_Wave11_mid"],x,256,y)
                x=x+_d_x
                y=-(y)+_n_y
            end
        end
        task._Wait(360)
        do
            local _beg_x=-120 local x=_beg_x local _end_x=120 local _d_x=(_end_x-_beg_x)/(3-1)
            for _=1,3 do
                last=New(_editor_class["Muki_AiC_Wave11_big"],x,256,_)
                x=x+_d_x
            end
        end
        task._Wait(420)
        for _,unit in ObjList(GROUP_ENEMY) do
            _kill(unit,false)
        end
        _clear_bullet(false,true)
        _stop_music()
        last=New(_editor_class["Muki_AiC_stage_Yukari_portal"],0,0,_)
        PlaySound("boon01",1,self.x/256,true)
        local portal=(last)
        for _=1,_infinite do
            if portal.flag2 then break end
            task._Wait(1)
        end
        PlaySound("warpl",1,self.x/256,true)
        task._Wait(120)
        _del(portal,true)
        task._Wait(120)
        LoadMusicRecord("aic_bgm10")
        _play_music("aic_bgm10")
        task._Wait(60)
        local _boss_wait=true
        local _ref=New(_editor_class["Muki_AiC_Noel"],_editor_class["Muki_AiC_Noel"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        task._Wait(60)
        if LSC_SIGN then
            local _boss_wait=true
            local _ref=New(_editor_class["Muki_AiC_Noel_LSC"],_editor_class["Muki_AiC_Noel_LSC"].cards)
            last=_ref
            if _boss_wait then while IsValid(_ref) do task.Wait() end end
        else
        end
        task._Wait(180)
        if not aic.menu.EndingBFlag then
            local _boss_wait=false
            local _ref=New(_editor_class["Muki_AiC_Mepha"],_editor_class["Muki_AiC_Mepha"].cards)
            last=_ref
            if _boss_wait then while IsValid(_ref) do task.Wait() end end
            for _=1,_infinite do
                if StageFinishFlag then break end
                task._Wait(1)
            end
        else
        end
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
