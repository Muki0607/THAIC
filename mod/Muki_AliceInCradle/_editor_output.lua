-- Generated by LuaSTG Editor Sharp
-- Mod name: 
_author = "Muki"
_mod_version = 4096
_allow_practice = true
_allow_sc_practice =true
--[[ 这里是梦摇篮的工程
]]
--[[ 使用了一些aic库中的代码，请自行查询data
]]
-- archive space: Danmaku_Resource\
_LoadImageFromFile('image:'..'Muki_AiC_Alice_face_default','Danmaku_Resource\\Muki_AiC_Alice_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Alice_face_fight','Danmaku_Resource\\Muki_AiC_Alice_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_assured','Danmaku_Resource\\Muki_AiC_Noel_face_assured.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_default','Danmaku_Resource\\Muki_AiC_Noel_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_embarassed','Danmaku_Resource\\Muki_AiC_Noel_face_embarassed.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_fight','Danmaku_Resource\\Muki_AiC_Noel_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_final','Danmaku_Resource\\Muki_AiC_Noel_face_final.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_normal','Danmaku_Resource\\Muki_AiC_Noel_face_normal.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile','Danmaku_Resource\\Muki_AiC_Noel_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile2','Danmaku_Resource\\Muki_AiC_Noel_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_smile3','Danmaku_Resource\\Muki_AiC_Noel_face_smile3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_speachless','Danmaku_Resource\\Muki_AiC_Noel_face_speachless.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_thinking','Danmaku_Resource\\Muki_AiC_Noel_face_thinking.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_thinking2','Danmaku_Resource\\Muki_AiC_Noel_face_thinking2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_understand','Danmaku_Resource\\Muki_AiC_Noel_face_understand.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose','Danmaku_Resource\\Muki_AiC_Noel_face_lose.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose2','Danmaku_Resource\\Muki_AiC_Noel_face_lose2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose3','Danmaku_Resource\\Muki_AiC_Noel_face_lose3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Noel_face_lose4','Danmaku_Resource\\Muki_AiC_Noel_face_lose4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_angry','Danmaku_Resource\\Muki_AiC_Ixia_face_angry.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_default','Danmaku_Resource\\Muki_AiC_Ixia_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_smile','Danmaku_Resource\\Muki_AiC_Ixia_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_surprise','Danmaku_Resource\\Muki_AiC_Ixia_face_surprise.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_face_notworryyou','Danmaku_Resource\\Muki_AiC_Ixia_face_notworryyou.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Laevigata_face_smile2','Danmaku_Resource\\Muki_AiC_Laevigata_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_default','Danmaku_Resource\\Muki_AiC_Mepha_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_fight','Danmaku_Resource\\Muki_AiC_Mepha_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Mepha_face_smile','Danmaku_Resource\\Muki_AiC_Mepha_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_fight','Danmaku_Resource\\Muki_AiC_Primula_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile','Danmaku_Resource\\Muki_AiC_Primula_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile2','Danmaku_Resource\\Muki_AiC_Primula_face_smile2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_smile3','Danmaku_Resource\\Muki_AiC_Primula_face_smile3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach','Danmaku_Resource\\Muki_AiC_Primula_face_teach.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach2','Danmaku_Resource\\Muki_AiC_Primula_face_teach2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_teach3','Danmaku_Resource\\Muki_AiC_Primula_face_teach3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_speechless','Danmaku_Resource\\Muki_AiC_Primula_face_speechless.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_surprise','Danmaku_Resource\\Muki_AiC_Primula_face_surprise.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory','Danmaku_Resource\\Muki_AiC_Primula_face_memory.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory2','Danmaku_Resource\\Muki_AiC_Primula_face_memory2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_face_memory3','Danmaku_Resource\\Muki_AiC_Primula_face_memory3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_smile','Danmaku_Resource\\Muki_AiC_Yukari_face_smile.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_fight','Danmaku_Resource\\Muki_AiC_Yukari_face_fight.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Yukari_face_default','Danmaku_Resource\\Muki_AiC_Yukari_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Okina_face_default','Danmaku_Resource\\Muki_AiC_Okina_face_default.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell1','Danmaku_Resource\\Muki_AiC_spell1.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell2','Danmaku_Resource\\Muki_AiC_spell2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell3','Danmaku_Resource\\Muki_AiC_spell3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell4','Danmaku_Resource\\Muki_AiC_spell4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_spell5','Danmaku_Resource\\Muki_AiC_spell5.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_down','Danmaku_Resource\\Muki_AiC_Noel_down.png',true,1,5,16,16,false)
_LoadImageGroupFromFile('image:'..'Muki_AiC_Noel_burst','Danmaku_Resource\\Muki_AiC_Noel_burst.png',true,3,1,16,16,false)
_LoadImageFromFile('image:'..'Muki_AiC_dialog_frame','Danmaku_Resource\\Muki_AiC_dialog_frame.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Ixia_doll','Danmaku_Resource\\Muki_AiC_Ixia_doll.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_nuclear','Danmaku_Resource\\Muki_AiC_nuclear.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_bow','Danmaku_Resource\\Muki_AiC_bow.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_square4','Danmaku_Resource\\Muki_AiC_square4.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef','Danmaku_Resource\\Muki_AiC_Primula_cast_ef.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef2','Danmaku_Resource\\Muki_AiC_Primula_cast_ef2.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_cast_ef3','Danmaku_Resource\\Muki_AiC_Primula_cast_ef3.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_Primula_smoke','Danmaku_Resource\\Muki_AiC_Primula_smoke.png',true,0,0,false,0)
_LoadImageGroupFromFile('image:'..'Muki_AiC_square','Danmaku_Resource\\Muki_AiC_square.png',true,3,1,0,0,false)
LoadSound('se:'..'Muki_AiC_dialog_Noel','Danmaku_Resource\\Muki_AiC_dialog_Noel.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Ixia','Danmaku_Resource\\Muki_AiC_dialog_Ixia.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Primula','Danmaku_Resource\\Muki_AiC_dialog_Primula.ogg')
LoadSound('se:'..'Muki_AiC_dialog_Mepha','Danmaku_Resource\\Muki_AiC_dialog_Mepha.ogg')
LoadSound('se:'..'Muki_AiC_hit','Danmaku_Resource\\Muki_AiC_hit.ogg')
LoadSound('se:'..'Muki_AiC_hit_casted','Danmaku_Resource\\Muki_AiC_hit_casted.ogg')
LoadSound('se:'..'Muki_AiC_casting','Danmaku_Resource\\Muki_AiC_casting.ogg')
LoadSound('se:'..'Muki_AiC_casting_short','Danmaku_Resource\\Muki_AiC_casting_short.ogg')
LoadSound('se:'..'Muki_AiC_arrow','Danmaku_Resource\\Muki_AiC_arrow.ogg')
LoadSound('se:'..'Muki_AiC_bomb','Danmaku_Resource\\Muki_AiC_bomb.ogg')
LoadSound('se:'..'Muki_AiC_bomb_explode','Danmaku_Resource\\Muki_AiC_bomb_explode.ogg')
LoadSound('se:'..'Muki_AiC_lightball','Danmaku_Resource\\Muki_AiC_lightball.ogg')
LoadSound('se:'..'Muki_AiC_burst','Danmaku_Resource\\Muki_AiC_burst.ogg')
LoadSound('se:'..'Muki_AiC_shield','Danmaku_Resource\\Muki_AiC_shield.ogg')
LoadSound('se:'..'Muki_AiC_primula_cast1','Danmaku_Resource\\Muki_AiC_primula_cast1.ogg')
LoadSound('se:'..'Muki_AiC_primula_cast2','Danmaku_Resource\\Muki_AiC_primula_cast2.ogg')
LoadSound('se:'..'Muki_AiC_primula_charge1','Danmaku_Resource\\Muki_AiC_primula_charge1.ogg')
LoadSound('se:'..'Muki_AiC_primula_charge2','Danmaku_Resource\\Muki_AiC_primula_charge2.ogg')
LoadSound('se:'..'Muki_AiC_primula_fog','Danmaku_Resource\\Muki_AiC_primula_fog.ogg')
LoadSound('se:'..'Muki_AiC_magic_getting','Danmaku_Resource\\Muki_AiC_magic_getting.ogg')
LoadSound('se:'..'Muki_AiC_magic_got','Danmaku_Resource\\Muki_AiC_magic_got.ogg')
LoadSound('se:'..'Muki_AiC_magic_got_closed','Danmaku_Resource\\Muki_AiC_magic_got_closed.ogg')
LoadSound('se:'..'Muki_AiC_skill_got','Danmaku_Resource\\Muki_AiC_skill_got.ogg')
LoadSound('se:'..'Muki_AiC_bgm_end','Danmaku_Resource\\Muki_AiC_bgm_end.ogg')
LoadSound('se:'..'Muki_AiC_dame','Danmaku_Resource\\Muki_AiC_dame.ogg')
LoadSound('se:'..'Muki_AiC_hited1','Danmaku_Resource\\Muki_AiC_hited1.ogg')
LoadSound('se:'..'Muki_AiC_hited2','Danmaku_Resource\\Muki_AiC_hited2.ogg')
LoadSound('se:'..'Muki_AiC_hited3','Danmaku_Resource\\Muki_AiC_hited3.ogg')
LoadSound('se:'..'Muki_AiC_hited4','Danmaku_Resource\\Muki_AiC_hited4.ogg')
--[[ bgm统一至data内
]]
_LoadImageFromFile('image:'..'Muki_AiC_bg','Danmaku_Resource\\Muki_AiC_bg.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_white','Danmaku_Resource\\Muki_AiC_white.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cdbg','Danmaku_Resource\\Muki_AiC_cdbg.png',true,0,0,false,0)
_LoadImageFromFile('image:'..'Muki_AiC_cdbg2','Danmaku_Resource\\Muki_AiC_cdbg2.png',true,0,0,false,0)
Muki_AiC_background=Class(object)

function Muki_AiC_background:init()
	background.init(self,false)
	--set camera
	Set3D('eye',-0.90,0.00,0.00)
	Set3D('at',1.00,0.00,0.00)
	Set3D('up',0.00,1.00,0.00)
	Set3D('fovy',0.50)
	Set3D('z',0.10,24.00)
	Set3D('fog',5.00,10.00,Color(255,255,255,255))
	--
	--New(Muki_camera_setter,-250,-200)
end

function Muki_AiC_background:render()
	SetViewMode'3d'
	RenderClear(lstg.view3d.fog[3])
	Render4V('image:Muki_AiC_bg',
	1, 0.5, -0.5,
	1, 0.5, 0.5,
	1, -0.5, 0.5,
	1, -0.5, -0.5)
	SetViewMode'world'
end
_editor_class["Muki_AiC_cdbg"]=Class(_spellcard_background)
_editor_class["Muki_AiC_cdbg"].init=function(self)
    _spellcard_background.init(self)
    _spellcard_background.AddLayer(self,"image:Muki_AiC_cdbg",false,0,0,0,-0.25,-0.25,0,"mul+add",1,1,
        function(self)
            self.task={}
        end,
        function(self)
            task.Do(self)
        end,
        function(self)
        end
    )
end
function Muki_fadein(bgm,t)
    local t = t or 60
    New(tasker, function()
        task._Wait(t)
        LoadMusicRecord(bgm)
        _play_music(bgm)
        do local i,_d_i=(1),(1) for _=1,t do
            SetBGMVolume(bgm, i / t)
            task._Wait(1)
        i=i+_d_i end end
    end)
end
function Muki_fadeout(t,pause)
    local t = t or 60
    New(tasker, function()
        local _, bgm = EnumRes('bgm')
        for i = 1, t do
            for _,v in pairs(bgm) do
                if GetMusicState(v) == 'playing' then
                    SetBGMVolume(v, 1 - i / 30)
                end
            end
            task.Wait()
        end
        if pause then
            _pause_music()
        else
            _stop_music()
        end
    end)
end
function Muki_stroke(font,text,x,y,co,...)
    local _x,_y
    for i = 0, 8 do
    	_x = x + sqrt(2) * cos(i * 45)
    	_y = y + sqrt(2) * sin(i * 45)
    	RenderTTF(font, text,
    	_x, _x, _y, _y,
    	co,
    	...)
    end
end
function Muki_cast(self,choice,t,rot,r,slow,newskill)
    choice = choice or 1
    t = t or 60
    rot = rot or -90
    r = r or 72
    slow = slow or 4
    last=New(_editor_class["Muki_AiC_spell_ui"],self.x,self.y,r,choice,sign(self.lr),20,slow,newskill)
    task._Wait(20)
    last=New(_editor_class["Muki_AiC_casting_aura"],self.x,self.y,60,2,rot,t-30,t,self)
    lstg.tmpvar.aura=last
    boss.cast(self,t)
    PlaySound("se:Muki_AiC_casting",4,self.x/256,true)
    task._Wait(min(60,t))
    if t > 60 then
        for _=1,int((t-60)/30) do
            PlaySound("se:Muki_AiC_casting_short",4,self.x/256,true)
            task._Wait(30)
        end
    end
end
function Muki_cast_primula(self,flag,t)
    --[[ 老师的施法真的好麻烦……
    ]]
    t = t or 60
    boss.cast(self,t)
    local dx=(-10)
    local dy=(40)
    if flag==1 then
        PlaySound("se:Muki_AiC_primula_charge1",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,t do
                local r=(ran:Int(5,15)*10)
                local a=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_ef1"],self.x+dx+r*cos(a),self.y+dy+r*sin(a),self.x+dx,self.y+dy,a,r)
                task._Wait(1)
            end
        end)
    elseif flag==2 then
        PlaySound("se:Muki_AiC_primula_charge2",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,int(t/6) do
                last=New(_editor_class["Muki_AiC_Primula_cast_ef3"],self.x+dx,self.y+dy,15)
                task._Wait(10)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,t do
                local r=(ran:Float(50,100))
                local a=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_ef2"],self.x+dx+r*cos(a),self.y+dy+r*sin(a),self.x+dx,self.y+dy,a,r)
                task._Wait(1)
            end
        end)
        lasttask=task.New(self,function()
            for _=1,int(t/6) do
                for _=1,3 do
                    last=New(_editor_class["Muki_AiC_Primula_cast_ef4"],self.x+dx,self.y+dy,15)
                end
                task._Wait(10)
            end
        end)
    else
        PlaySound("se:Muki_AiC_primula_charge1",1,self.x/256,true)
        lasttask=task.New(self,function()
            for _=1,t do
                local r2=(ran:Int(5,15)*10)
                local a2=(ran:Float(0,360))
                local r1=(20)
                local a1=(ran:Float(0,360))
                last=New(_editor_class["Muki_AiC_Primula_cast_laser"],self.x+dx+r2*cos(a2)+r1*cos(a1),self.y+dy+r2*sin(a2)+r1*sin(a1),self.x+dx+r1*cos(a1),self.y+dy+r1*sin(a1),a2,r2)
                task._Wait(1)
            end
        end)
    end
    task._Wait(min(60,t)+10)
end
function Muki_get8dir(self,other)
    local a=(Angle(self,other))
    local aa
    if (a>-22.5 and a<=0) or (a>=0 and a<=22.5) then
        aa=0
    elseif a>22.5 and a<=67.5 then
        aa=45
    elseif a>67.5 and a<=112.5 then
        aa=90
    elseif a>112.5 and a<=157.5 then
        aa=135
    elseif (a>157.5 and a<=180) or (a>=-180 and a<=-157.5) then
        aa=180
    elseif a>-157.5 and a<=-112.5 then
        aa=225
    elseif a>-112.5 and a<=-67.5 then
        aa=270
    elseif a>-67.5 and a<=-22.5 then
        aa=315
    end
    return aa
end
function Muki_warning(self,a,shift,n,t)
    shift=shift or 30
    n=n or 3
    t=t or 20
    for _=1,n do
        last=New(_editor_class["Muki_AiC_warning_line"],self.x,self.y,a,a+shift,t)
        last=New(_editor_class["Muki_AiC_warning_line"],self.x,self.y,a,a-shift,t)
        task._Wait(t/2)
    end
end
function Muki_boss_escape(self,x,y,t,mode)
    x=x or 384
    y=y or 256
    t=t or 60
    mode=mode or MOVE_ACC_DEC
    lasttask=task.New(self,function()
        self.colli=false
        PlaySound("fault",1,self.x/256,false)
        task._Wait(30)
        task.MoveTo(x,y,t-30,mode)
        _del(self,true)
    end)
end
_editor_tasks["Muki_smear"]=function(self,t1,t2,ghost)
    return function()
        local self=task.GetSelf()
        --[[ from 曲线系统指南 by 夜雀的歌声
        ]]
        --[[ 但这个版本考虑兼容性没用曲线系统
        ]]
        for _=1,_infinite do
            last=New(_straight,self.imgclass,self._index,self.x,self.y,0,self.rot,false,0,true,true,0,false,0,0,0,false)
            last.class=last.logclass
            if ghost then
                last.group=GROUP_GHOST
            end
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                do
                    local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(t2-1)
                    for _=1,t2 do
                        _object.set_color(self,"",al,255,255,255)
                        task._Wait(1)
                        al=al+_d_al
                    end
                end
                _del(self,false)
            end)
            task._Wait(t1)
        end
    end
end
_editor_class["Muki_AiC_test"]=Class(_object)
_editor_class["Muki_AiC_test"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="leaf"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_ENEMY_BULLET
    self.hide=true
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
    end)
end
_editor_class["Muki_AiC_dialog_name"]=Class(_object)
_editor_class["Muki_AiC_dialog_name"].init=function(self,_x,_y,name)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+10
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.name=name
end
_editor_class["Muki_AiC_dialog_name"].frame=function(self)
    if not player.dialog then
        _del(self,false)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_dialog_name"].render=function(self)
    --Muki_stroke('dialog',self.name,self.x,self.y,Color(255,0,0,0),'vcenter')
    RenderTTF('dialog',self.name,self.x,self.x,self.y,self.y,Color(255,230,227,219),'vcenter')
end
--[[ Code by 夜雀的歌声
]]
--[[ Arranged by Muki
]]
_editor_class["Muki_AiC_NB_Portrait_AI"]=Class(_object)
_editor_class["Muki_AiC_NB_Portrait_AI"].init=function(self,_x,_y,img,s,dx)
    self.x,self.y=_x,_y
    self.img=img or "image:Muki_AiC_Noel_face_fight"
    self.layer=LAYER_PLAYER-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=false
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    s=s or 0.4
    dx = dx or 0
    self.hscale=s
    self.vscale=s
    self.omiga=0---0.05
    (self).x,(self).y=192,96
    _object.set_color(self,"",0,255,255,255)
    local sn=(3)
    lasttask=task.New(self,function()
        do
            local _beg_ia=0 local ia=_beg_ia local _end_ia=255 local _d_ia=(_end_ia-_beg_ia)/(30-1)
            local _beg_isc=s local isc=_beg_isc local _end_isc=s+0.1 local _d_isc=(_end_isc-_beg_isc)/(30)
            for _=1,30 do
                _object.set_color(self,"",ia,255,255,255)
                self.hscale = isc
                self.vscale = isc
                task._Wait(1)
                ia=ia+_d_ia
                isc=isc+_d_isc
            end
        end
        task._Wait(60)
        do
            local _beg_ia=255 local ia=_beg_ia local _end_ia=0 local _d_ia=(_end_ia-_beg_ia)/(30-1)
            for _=1,30 do
                _object.set_color(self,"",ia,255,255,255)
                task._Wait(1)
                ia=ia+_d_ia
            end
        end
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        do
            local _beg_iy=96 local iy=_beg_iy local _end_iy=0 local _w_iy=0 local _d_w_iy=1/(30-1)
            local _beg_ix=192 local ix=_beg_ix local _end_ix=dx local _w_ix=0 local _d_w_ix=1/(30-1)
            local i=1 local _d_i=(1)
            for _=1,30 do
                (self).x,(self).y=ix,iy
                if i>=60-sn then break end
                task._Wait(1)
                _w_iy=_w_iy+_d_w_iy iy=(_beg_iy-_end_iy)*(_w_iy-1)^2+_end_iy
                _w_ix=_w_ix+_d_w_ix ix=(_beg_ix-_end_ix)*(_w_ix-1)^2+_end_ix
                i=i+_d_i
            end
        end
        self.vx,self.vy=self.dx,self.dy
        task._Wait(sn)
        task._Wait(30)
        _set_a(self,0.05,180,false)
    end)
end
_editor_class["Muki_AiC_aura1"]=Class(_object)
_editor_class["Muki_AiC_aura1"].init=function(self,_x,_y,r,a,co,scale)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square1"
    self.layer=LAYER_ENEMY-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=scale
    self.hscale=scale
    self.r=0
    self.angle=a
    self.co=co or {255,255,255}
    _connect(_boss,self,0,false)
    lasttask=task.New(self,function()
        do
            local _beg_rr=0 local rr=_beg_rr local _end_rr=r local _w_rr=0 local _d_w_rr=1/(30)
            for _=1,30 do
                self.r=rr
                task._Wait(1)
                _w_rr=_w_rr+_d_w_rr rr=(_beg_rr-_end_rr)*(_w_rr-1)^2+_end_rr
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_aura2"],self.x,self.y,self,co,scale)
            self.light=true
            task._Wait(240)
        end
    end)
end
_editor_class["Muki_AiC_aura1"].frame=function(self)
    _object.set_color(self,"mul+add",min(255,7.5*self.timer),self.co[1],self.co[2],self.co[3])
    _set_rel_pos(self,self.r*cos(self.angle),self.r*sin(self.angle),self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_aura2"]=Class(_object)
_editor_class["Muki_AiC_aura2"].init=function(self,_x,_y,master,co,scale)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square2"
    self.layer=LAYER_ENEMY-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=scale
    self.hscale=scale
    self.co=co or {255,255,255}
    _object.set_color(self,"mul+add",0,self.co[1],self.co[2],self.co[3])
    _connect(master,self,0,true)
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                _object.set_color(self,"mul+add",al,self.co[1],self.co[2],self.co[3])
                task._Wait(1)
                al=al+_d_al
            end
        end
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(60-1)
            for _=1,60 do
                _object.set_color(self,"mul+add",al,self.co[1],self.co[2],self.co[3])
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            self.vscale=self._master.vscale
            self.hscale=self._master.hscale
            _set_rel_pos(self,0,0,self.rot,false)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_aura2"].frame=function(self)
    if self.del then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_shield"]=Class(_object)
_editor_class["Muki_AiC_shield"].init=function(self,_x,_y,r,h,o,state,master,t)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=0
    self.h=0
    self.state=state
    self.omiga=o
    self.bound=false
    self.t=t
    _connect(master,self,0,true)
    --[[ 使用斜二测画法算出来的奇怪答案
    ]]
    --[[ 浅薄的高中数学知识终究是败给了调参
    ]]
    local a=(sqrt((5+2*sqrt(2))/4))
    local b=(0.1)
    if state==1 then
lasttask=task.New(self,function () ex.SmoothSetValueTo("r",r,15,MOVE_NORMAL,nil,0,MODE_SET) end )
lasttask=task.New(self,function () ex.SmoothSetValueTo("h",h,15,MOVE_NORMAL,nil,0,MODE_SET) end )
    else
        self.r=r
        self.h=h
    end
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if not self.xx or not self.yy then
                _set_rel_pos(self,0,0,self.rot,false)
            else
                SetV2(self,5,Angle(self.x,self.y,self.xx,self.yy),false,false)
lasttask=task.New(self,function () ex.SmoothSetValueTo("_speed",0,int(Dist(self.x,self.y,self.xx,self.yy)/5),MOVE_NORMAL,nil,0,MODE_SET) end )
                task._Wait(int(Dist(self.x,self.y,self.xx,self.yy)/5))
            end
            do local rot,_d_rot=(0),(90) for _=1,4 do
                do local y,_d_y=(-self.h),(2*self.h) for _=1,2 do
                    local x1, y1, x2, y2 =
                    	self.x,
                    	self.y+y,
                    	self.x + self.r * a * cos(rot + self.rot),
                    	self.y + self.r * b * sin(rot + self.rot)
                    if self.state >=3 then
                    	x1, y1 = aic.math.rotate(x1, y1, 15*cos(10*self.timer), self.x, self.y)
                    	x2, y2 = aic.math.rotate(x2, y2, 15*cos(10*self.timer), self.x, self.y)
                    end
                    if (rot+self.rot+360)%360<=180 then
                        if self.state>=2 then
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,true)
                        else
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,true)
                        end
                        if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                    else
                        if self.state>=2 then
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,false)
                        else
                            last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,false)
                        end
                        if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                    end
                y=y+_d_y end end
                local x1, y1, x2, y2 =
                	self.x + self.r * a * cos(rot + self.rot),
                	self.y + self.r * b * sin(rot + self.rot),
                	self.x + self.r * a * cos(rot + self.rot + 90),
                	self.y + self.r * b * sin(rot + self.rot + 90)
                if self.state >=3 then
                	x1, y1 = aic.math.rotate(x1, y1, 15*cos(10*self.timer), self.x, self.y)
                	x2, y2 = aic.math.rotate(x2, y2, 15*cos(10*self.timer), self.x, self.y)
                end
                if (rot+self.rot+360)%360<=180 then
                    if self.state>=2 then
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,true,self.state)
                    else
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,true,self.state)
                    end
                    if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                else
                    if self.state>=2 then
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6,false,self.state)
                    else
                        last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,8,false,self.state)
                    end
                    if self.state >=4 and self.timer % 10 <= 5 then laser.ChangeImage(last, 4, COLOR_RED) end
                end
            rot=rot+_d_rot end end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_shield"].frame=function(self)
    self.class.base.frame(self)
    if self.t and self.timer>=self.t then
        _del(self,true)
    end
end
_editor_class["Muki_AiC_shielder"]=Class(_object)
_editor_class["Muki_AiC_shielder"].init=function(self,_x,_y,boss)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=false
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.boss=boss
    self.active=false
    boss.shielder=self
end
_editor_class["Muki_AiC_shielder"].frame=function(self)
    self.class.base.frame(self)
    if player.nextspell>0 and self.active and not IsValid(self.boss.shield) then
        PlaySound("se:Muki_AiC_shield",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_shield"],self.boss.x,self.boss.y,45,70,-2,1,self.boss,player.protect)
        self.boss.shield=last
    end
end
_editor_class["Muki_AiC_casting_aura"]=Class(_object)
_editor_class["Muki_AiC_casting_aura"].init=function(self,_x,_y,r,o,rot,t1,t2,master)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=r
    self.omiga2=o
    self.rot2=0
    self.rot=rot
    self.load=0
    self.t2=t2
    self.bound=false
    _connect(master,self,0,true)
    local a=(sqrt((5+2*sqrt(2))/4))
    local b=(0.3)
    self.aa=a
    self.bb=b
    lasttask=task.New(self,function()
        do
            local _beg_load=0 local load=_beg_load local _end_load=1.1 local _d_load=(_end_load-_beg_load)/(t1-1)
            for _=1,t1 do
                self.load=min(load,1)
                task._Wait(1)
                load=load+_d_load
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            _set_rel_pos(self,100*cos(self.rot),100*sin(self.rot),self.rot,false)
            if self.load>=1 then
                do local rot,_d_rot=(0),(90) for _=1,4 do
                    local x1, y1, x2, y2 =
                    	self.x + self.r * a * cos(rot + self.rot2),
                    	self.y + self.r * b * sin(rot + self.rot2),
                    	self.x + self.r * a * cos(rot + self.rot2 + 90),
                    	self.y + self.r * b * sin(rot + self.rot2 + 90)
                    x1, y1 = aic.math.rotate(x1, y1, self.rot+90, self.x, self.y)
                    x2, y2 = aic.math.rotate(x2, y2, self.rot+90, self.x, self.y)
                    last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6)
                    laser.ChangeImage(last, 4, COLOR_GRAY)
                    last.colli=false
                    _object.set_color(last,"mul+add",255,255,255,255)
                rot=rot+_d_rot end end
                do local rot,_d_rot=(45),(90) for _=1,4 do
                    local x1, y1, x2, y2 =
                    	self.x + self.r * a * cos(rot + self.rot2),
                    	self.y + self.r * b * sin(rot + self.rot2),
                    	self.x + self.r * a * cos(rot + self.rot2 + 90),
                    	self.y + self.r * b * sin(rot + self.rot2 + 90)
                    x1, y1 = aic.math.rotate(x1, y1, self.rot+90, self.x, self.y)
                    x2, y2 = aic.math.rotate(x2, y2, self.rot+90, self.x, self.y)
                    last=New(_editor_class["Muki_AiC_line"],x1,y1,x1,y1,x2,y2,6)
                    laser.ChangeImage(last, 4, COLOR_GRAY)
                    last.colli=false
                    _object.set_color(last,"mul+add",255,255,255,255)
                rot=rot+_d_rot end end
            else
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local r=(ran:Float(0,self.r))
            local a=(ran:Float(0,360))
            last=New(_editor_class["Muki_AiC_casting_aura_ef"],self.x+r*cos(a),self.y+r*sin(a),ran:Float(1.5,3))
            task._Wait(10)
        end
    end)
end
_editor_class["Muki_AiC_casting_aura"].frame=function(self)
    self.class.base.frame(self)
    if self.timer>=self.t2 then
        for _=1,20 do
            local r=(ran:Float(50,100))
            local a=(ran:Float(0,360))
            last=New(_editor_class["Muki_AiC_casting_ef"],self.x+r*cos(a),self.y+r*sin(a),_)
        end
        _del(self,false)
    end
    self.rot2=self.rot2+self.omiga2
end
_editor_class["Muki_AiC_casting_aura"].render=function(self)
    SetImageState('white','mul+add',Color(255,255,255,255))
    SetImageState('parimg5','mul+add',Color(255,255,255,255))
    --有返回值的屑render（返回的是端点坐标）
    local x1,y1,x2,y2=aic.math.RenderEclipse('white',self.x,self.y,self.r*self.aa-5,self.r*self.aa,90,self.rot+90,self.r*self.bb-5,self.r*self.bb,89-90*self.load,90+90*self.load)
    local x3,y3,x4,y4=aic.math.RenderEclipse('white',self.x,self.y,self.r*self.aa-5,self.r*self.aa,90,self.rot+90,self.r*self.bb-5,self.r*self.bb,270-90*self.load,270+90*self.load)
    if self.load<1 then
    	Render('parimg5',x1,y1,0,1.5)
    	Render('parimg5',x2,y2,0,1.5)
    	Render('parimg5',x3,y3,0,1.5)
    	Render('parimg5',x4,y4,0,1.5)
    end
    self.class.base.render(self)
end
_editor_class["Muki_AiC_casting_aura_ef"]=Class(_object)
_editor_class["Muki_AiC_casting_aura_ef"].init=function(self,_x,_y,s)
    self.x,self.y=_x,_y
    self.img="parimg8"
    self.layer=LAYER_ENEMY_BULLET-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=s
    self.hscale=s
    _object.set_color(self,"",150,67,78,206)
    SetV2(self,2,90,true,false)
    lasttask=task.New(self,function()
        task._Wait(15)
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_casting_aura_ef"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_casting_aura_ef"].render=function(self)
    SetImageState('parimg8','mul+add',Color(255,0,255,255))
    Render('parimg8',self.x,self.y,self.rot,self.vscale)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_casting_ef"]=Class(_object)
_editor_class["Muki_AiC_casting_ef"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_square3"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=0.75
    self.hscale=0.75
    SetV2(self,0.2,ran:Float(0,360),false,false)
    _object.set_color(self,"mul+add",0,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_al=0 local al=_beg_al local _end_al=255 local _d_al=(_end_al-_beg_al)/(15-1)
            for _=1,15 do
                _object.set_color(self,"mul+add",al,255,255,255)
                task._Wait(1)
                al=al+_d_al
            end
        end
        task._Wait(30)
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_casting_ef"].del=function(self)
    PreserveObject(self)
    lasttask=task.New(self,function()
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(15-1)
            local _beg_s=0.75 local s=_beg_s local _end_s=0.5 local _d_s=(_end_s-_beg_s)/(15-1)
            for _=1,15 do
                _object.set_color(self,"mul+add",al,255,255,255)
                self.vscale=s
                self.hscale=s
                task._Wait(1)
                al=al+_d_al
                s=s+_d_s
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef1"]=Class(laser_bent)
_editor_class["Muki_AiC_Primula_cast_ef1"].init=function(self,_x,_y,x,y,a,r)
    laser_bent.init(self,COLOR_GRAY,_x,_y,32,2,4,0)
    self.bound=false
    self.group=GROUP_GHOST
    lasttask=task.New(self,function()
        anchor={}
        local n = int(r/10)
        local s = ran:Sign()
        for i = 1, n do
            local t = (n - i)*10
            table.insert(anchor,x + t * cos(a + s * i * 10))
            table.insert(anchor,y + t * sin(a + s * i * 10))
        end
        task.BezierMoveTo(10,MODE_NORMAL,unpack(anchor))
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef2"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef2"].init=function(self,_x,_y,x,y,a,r)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.rot=ran:Float(0,360)
    self.omiga=-5
    self.vscale=0.5
    self.hscale=0.5
    _object.set_color(self,"mul+add",150,50,ran:Int(100,150),ran:Int(200,255))
    lasttask=task.New(self,function()
        do
            local _beg_rr=r local rr=_beg_rr local _end_rr=0 local _w_rr=0  local _d_w_rr=1/(15-1)
            local _beg_s=0.5 local s=_beg_s local _end_s=0.4 local _w_s=0  local _d_w_s=1/(15-1)
            local _beg_al=150 local al=_beg_al local _end_al=0 local _w_al=0  local _d_w_al=1/(15-1)
            for _=1,15 do
                self.x=x+rr*cos(a)
                self.y=y+rr*sin(a)
                self.vscale=s
                self.hscale=s
                _object.set_color(self,"mul+add",al,self._r,self._g,self._b)
                task._Wait(1)
                _w_rr=_w_rr+_d_w_rr rr=(_end_rr-_beg_rr)*_w_rr^2+_beg_rr
                _w_s=_w_s+_d_w_s s=(_end_s-_beg_s)*_w_s^2+_beg_s
                _w_al=_w_al+_d_w_al al=(_end_al-_beg_al)*_w_al^2+_beg_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef3"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef3"].init=function(self,_x,_y,t)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef2"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=0.3
    self.hscale=0.3
    _object.set_color(self,"mul+add",25,50,100,255)
    lasttask=task.New(self,function()
        do
            local _beg_s=0.3 local s=_beg_s local _end_s=0.8 local _d_s=(_end_s-_beg_s)/(t-1)
            local _beg_al=25 local al=_beg_al local _end_al=50 local _d_al=(_end_al-_beg_al)/(t-1)
            for _=1,t do
                self.vscale=s
                self.hscale=s
                _object.set_color(self,"mul+add",al,50,100,255)
                task._Wait(1)
                s=s+_d_s
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef4"]=Class(_object)
_editor_class["Muki_AiC_Primula_cast_ef4"].init=function(self,_x,_y,t)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_Primula_cast_ef3"
    self.layer=LAYER_ENEMY-6
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    self.vscale=0.8
    self.hscale=1.2
    self.rot=ran:Float(0,360)
    self.omiga=ran:Float(-0.5,0.5)
    _object.set_color(self,"mul+add",100,50,100,255)
    lasttask=task.New(self,function()
        do
            local _beg_s=0.8 local s=_beg_s local _end_s=0 local _d_s=(_end_s-_beg_s)/(t-1)
            local _beg_al=100 local al=_beg_al local _end_al=50 local _d_al=(_end_al-_beg_al)/(t-1)
            for _=1,t do
                self.vscale=s
                self.hscale=s*3/2
                _object.set_color(self,"mul+add",al,50,100,255)
                task._Wait(1)
                s=s+_d_s
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_Primula_cast_ef4"].render=function(self)
    SetImageCenter('image:Muki_AiC_Primula_cast_ef3',55,128)
    self.class.base.render(self)
    SetImageCenter('image:Muki_AiC_Primula_cast_ef3',128,128)
end
_editor_class["Muki_AiC_spell_ui"]=Class(_object)
_editor_class["Muki_AiC_spell_ui"].init=function(self,_x,_y,r,choice,dir,t,slow,newskill)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.r=0
    self.dir=dir
    self.choice=choice or 1
    self.t=t or 20
    self.slow=slow or 4
    self.bold={4,4,4,4}
    self.scale={0.3,0.3,0.3,0.3}
    self.scale2={3*3/5,3*3/5,3*3/5,3*3/5}
    self.rot2={45,45,45,45}
    self.newskill=newskill
    lasttask=task.New(self,function()
        do
            local _beg_rr=0 local rr=_beg_rr local _end_rr=r local _d_rr=(_end_rr-_beg_rr)/(10)
            for _=1,10 do
                self.r=rr
                task._Wait(1)
                rr=rr+_d_rr
            end
        end
        self.choice=choice
        lstg.var.timeslow=self.slow
        task._Wait(self.t-10)
        lstg.var.timeslow=nil
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_spell_ui"].frame=function(self)
    if self.choice==1 then
    	self.bold={3,4,4,4}
    	self.scale={0.32,0.3,0.3,0.3}
    	self.scale2={3.2*3/5,3*3/5,3*3/5,3*3/5}
    	self.rot2={0,45,45,45}
    elseif self.choice==2 then
    	self.bold={4,3,4,4}
    	self.scale={0.3,0.32,0.3,0.3}
    	self.scale2={3*3/5,3.2*3/5,3*3/5,3*3/5}
    	self.rot2={45,0,45,45}
    elseif self.choice==3 then
    	self.bold={4,4,3,4}
    	self.scale={0.3,0.3,0.32,0.3}
    	self.scale2={3*3/5,3*3/5,3.2*3/5,3*3/5}
    	self.rot2={45,45,0,45}
    else
    	self.bold={4,4,4,3}
    	self.scale={0.3,0.3,0.3,0.32}
    	self.scale2={3*3/5,3*3/5,3*3/5,3.2*3/5}
    	self.rot2={45,45,45,0}
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_spell_ui"].render=function(self)
    SetImageState('white','',Color(min(150,self.timer*10),0,0,0))
    Render4V('white',
    	-192,224,0.5,
    	192,224,0.5,
    	192,-224,0.5,
    	-192,-224,0.5
    )
    SetImageState('image:Muki_AiC_square3','mul+add',Color(200,255,255,255))
    SetImageState('image:Muki_AiC_square4','mul+add',Color(255,255,255,255))
    Render('image:Muki_AiC_square'..self.bold[1],self.x,self.y,self.rot2[1],self.scale2[1])
    Render('image:Muki_AiC_square'..self.bold[2],self.x,self.y-self.r,self.rot2[2],self.scale2[2])
    Render('image:Muki_AiC_square'..self.bold[3],self.x+self.r*self.dir,self.y,self.rot2[3],self.scale2[3])
    Render('image:Muki_AiC_square'..self.bold[4],self.x,self.y+self.r,self.rot2[4],self.scale2[4])
    Render('image:Muki_AiC_spell1',self.x,self.y,0,self.scale[1])
    Render('image:Muki_AiC_spell2',self.x,self.y-self.r,0,self.scale[2])
    Render('image:Muki_AiC_spell3',self.x+self.r*self.dir,self.y,0,self.scale[3])
    if self.newskill then
    	Render('image:Muki_AiC_spell5',self.x,self.y+self.r,0,self.scale[4])
    end
end
_editor_class["Muki_AiC_boss_image"]=Class(_object)
_editor_class["Muki_AiC_boss_image"].init=function(self,_x,_y,img,master,n,t,intv)
    self.x,self.y=_x,_y
    self.img=img..1
    self.layer=LAYER_ENEMY
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.bound=false
    s=s or 1
    intv = intv or 6
    self.master=master
    self.t=t
    self.vscale=s
    self.hscale=s
end
_editor_class["Muki_AiC_boss_image"].frame=function(self)
    if self.timer>=self.t then
        self.master.hide=false
        _del(self,false)
    else
        self.master.hide=true
    end
    self.x=self.master.x
    self.y=self.master.y
    self.img=img..min(int((self.timer%(n*intv))/intv)+1,n)    self.class.base.frame(self)
end
_editor_class["Muki_AiC_line"]=Class(laser)
_editor_class["Muki_AiC_line"].init=function(self,_x,_y,x1,y1,x2,y2,w,hide,notraw)
    laser.init(self,COLOR_CYAN,_x,_y,0,Dist(x1,y1,x2,y2)/6,Dist(x1,y1,x2,y2)/6*4,Dist(x1,y1,x2,y2)/6,w,0,0)
    laser.ChangeImage(self,4)
    self.rot=Angle(x1,y1,x2,y2)
    self.bound=false
    lasttask=task.New(self,function()
        if hide then
            self.layer=LAYER_ENEMY-5
            laser._TurnOn(self,1,false,true)
        else
            laser._TurnOn(self,1,false,true)
        end
        if notraw then
            _del(self,true)
        else
            _del(self,false)
        end
    end)
end
_editor_class["Muki_AiC_warning_line"]=Class(laser)
_editor_class["Muki_AiC_warning_line"].init=function(self,_x,_y,a1,a2,t)
    laser.init(self,COLOR_CYAN,_x,_y,0,0,114514,0,4,0,0)
    laser.ChangeImage(self,4)
    lasttask=task.New(self,function()
        self.rot=a2
        laser._TurnHalfOn(self,1,false)
        do
            local _beg_a=a2 local a=_beg_a local _end_a=a1 local _w_a=0 local _d_w_a=1/(t-1)
            for _=1,t do
                self.rot=a
                task._Wait(1)
                _w_a=_w_a+_d_w_a a=(_beg_a-_end_a)*(_w_a-1)^2+_end_a
            end
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_melee"]=Class(laser_bent)
_editor_class["Muki_AiC_melee"].init=function(self,_x,_y,dir)
    laser_bent.init(self,COLOR_GRAY,_x,_y,30,8,4,0)
    lasttask=task.New(self,function()
        task.BezierMoveTo(30,MOVE_DECEL,self.x+100*dir,self.y,self.x+175*dir*cos(-30),self.y+100*sin(-30),self.x,self.y-75,self.x-100*dir,self.y-90)
    end)
    lasttask=task.New(self,function()
        for _=1,24 do
            last=New(_straight,ball_mid_c,COLOR_GRAY,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(15)
                self.angle=Angle(self,_boss)+180
                ChangeBulletImage(self,ball_mid_c,COLOR_CYAN)
                SetV2(self,1,self.angle,true,false)
                _set_a(self,0.05,self.angle,false)
            end)
            task._Wait(1)
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_bomb"]=Class(bullet)
_editor_class["Muki_AiC_bomb"].init=function(self,_x,_y,v,a,rot,r)
bullet.init(self,ball_mid,COLOR_GRAY,true,true)
self.x,self.y=_x,_y
    SetV2(self,v,rot,true,false)
    _set_a(self,a,rot,false)
    self.colli=false
    self.r=r
    self.k=0
    _object.set_color(self,"mul+add",200,74,142,171)
    lasttask=task.New(self,function()
        for _=1,420 do
            if Dist(self,player)<=r then break end
            task._Wait(1)
        end
        PlaySound("se:Muki_AiC_bomb_explode",1,self.x/256,true)
        task._Wait(30)
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(24)
            for _=1,24 do
                last=New(_straight,ball_mid_c,COLOR_BLUE,self.x,self.y,3,a,false,0,true,true,0,false,0,0,0,false)
                a=a+_d_a
            end
        end
        do
            local _beg_v=5 local v=_beg_v local _end_v=2 local _d_v=(_end_v-_beg_v)/(5-1)
            local n=1 local _d_n=(2)
            for _=1,5 do
                do local aa,_d_aa=(-1/2*(2*n-1)),(2) for _=1,n do
                    last=New(_straight,arrow_big,COLOR_BLUE,self.x,self.y,v,aa,true,0,true,true,0,false,0,0,0,false)
                aa=aa+_d_aa end end
                v=v+_d_v
                n=n+_d_n
            end
        end
        PlaySound("don00",1,self.x/256,true)
        last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,0.75,{67,78,206})
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if (self.x>=192 or self.x<=-192) then
                self.vx,self.vy=-self.vx,self.vy
                self.rot=atan2(self.vy,self.vx)
                self.ax,self.ay=-self.ax,self.ay
                do break end
            elseif self.y>=224 or self.y<=-224 then
                self.vx,self.vy=self.vx,-self.vy
                self.rot=atan2(self.vy,self.vx)
                self.ax,self.ay=self.ax,-self.ay
                do break end
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if self._speed<=0.1 then break end
            task._Wait(1)
        end
        SetV2(self,0,self.rot,true,false)
        _set_a(self,0,0,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_editor_class["Muki_AiC_bomb_ef"],self.x,self.y,self,6,ran:Float(0,360))
            do local k,_d_k=(0),(1/30) for _=1,30 do
                self.k=k
                task._Wait(1)
            k=k+_d_k end end
        end
    end)
end
_editor_class["Muki_AiC_bomb"].render=function(self)
    self.class.base.render(self)
    SetImageState('white','mul+add',Color(255,67,78,206))
    aic.math.RenderEclipse('white',self.x,self.y,self.r*self.k-5,self.r*self.k)
end
_editor_class["Muki_AiC_bomb_ef"]=Class(_object)
_editor_class["Muki_AiC_bomb_ef"].init=function(self,_x,_y,master,s,rot)
    self.x,self.y=_x,_y
    self.img="parimg5"
    self.layer=LAYER_ENEMY_BULLET-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    _connect(master,self,0,true)
    self.rot=rot
    self.vscale=0
    self.hscale=0
    _object.set_color(self,"mul+add",255,67,78,206)
    SetV2(self,ran:Float(0.25,0.45),90,true,false)
    lasttask=task.New(self,function()
        do
            local _beg_scale=0 local scale=_beg_scale local _end_scale=s local _d_scale=(_end_scale-_beg_scale)/(15-1)
            for _=1,15 do
                self.vscale=scale
                self.hscale=scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        do
            local _beg_scale=s local scale=_beg_scale local _end_scale=0 local _d_scale=(_end_scale-_beg_scale)/(15-1)
            for _=1,15 do
                self.vscale=scale
                self.hscale=scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_bomb_ef"].frame=function(self)
    _set_rel_pos(self,0,0,self.rot,false)
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_bomb_ef"].render=function(self)
    SetImageState('parimg8','mul+add',Color(255,67,78,206))
    Render('parimg8',self.x,self.y,self.rot,self.vscale)
    self.class.base.render(self)
end
_editor_class["Muki_AiC_nuclear"]=Class(_object)
_editor_class["Muki_AiC_nuclear"].init=function(self,_x,_y,s,co,bossdmg)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_nuclear"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_INDES
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.a=0
    self.b=0
    self.vscale=0
    self.hscale=0
    self.co=co or {238,100,100}
    _boss.dmgsign=false
    _object.set_color(self,"mul+add",255,self.co[1],self.co[2],self.co[3])
    lasttask=task.New(self,function()
        PlaySound("boon01",4,self.x/256,true)
        do
            local _beg_scale=0 local scale=_beg_scale local _end_scale=s local _d_scale=(_end_scale-_beg_scale)/(30-1)
            for _=1,30 do
                self.vscale=scale
                self.hscale=scale
                self.a=100*scale
                self.b=100*scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        task._Wait(30)
        do
            local _beg_scale=s local scale=_beg_scale local _end_scale=0 local _d_scale=(_end_scale-_beg_scale)/(30-1)
            for _=1,30 do
                self.vscale=scale
                self.hscale=scale
                self.a=100*scale
                self.b=100*scale
                task._Wait(1)
                scale=scale+_d_scale
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_nuclear"].frame=function(self)
    if bossdmg and IsValid(_boss) then
        ColliCheck(self,_boss)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_nuclear"].colli=function(self,other)
    if other==_boss and not other.dmgsign then
        other.dmgsign=true
        other.hp=other.hp-200
    end
    self.class.base.colli(self,other)
end
_editor_class["Muki_AiC_nuclear"].render=function(self)
    --[[ 简单易懂的透明度倍增法（
    ]]
    for _=1,3 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_nuclear"].del=function(self)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_melee_casting"]=Class(laser_bent)
_editor_class["Muki_AiC_melee_casting"].init=function(self,_x,_y,dir,type)
    laser_bent.init(self,COLOR_GRAY,_x,_y,30,40,0,0)
    lasttask=task.New(self,function()
        task.BezierMoveTo(30,MOVE_DECEL,self.x+100*dir,self.y,self.x+175*dir*cos(-30),self.y+100*sin(-30),self.x,self.y-75,self.x-100*dir,self.y-90)
    end)
    lasttask=task.New(self,function()
        if type==1 then
            for _=1,24 do
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                    for _=1,8 do
                        do
                            local a = a
                            do
                                last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,0,a,false,0,true,true,0,false,0,0,0,false)
                                lasttask=task.New(last,function()
                                    local self=task.GetSelf()
                                    task._Wait(15)
                                    self.angle=Angle(self,_boss)+180+a
                                    ChangeBulletImage(self,ball_mid_c,COLOR_BLUE)
                                    SetV2(self,1,self.angle,true,false)
                                    _set_a(self,0.05,self.angle,false)
                                    _forbid_v(self,3,'original','original')
                                end)
                            end
                        end
                        a=a+_d_a
                    end
                end
                task._Wait(1)
            end
        elseif type==2 then
        else
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_bow"]=Class(_object)
_editor_class["Muki_AiC_bow"].init=function(self,_x,_y,a,aiming)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_bow"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_ENEMY_BULLET
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.hscale1=0.5
    self.vscale1=0.5
    self.hscale2=1
    self.vscale2=0.25
    self.hscale=self.hscale1
    self.vscale=self.vscale1
    self.rot=a
    local d=40
    self.x1,self.y1=aic.math.rotate(self.x,self.y+217/4,a,self.x,self.y)
    self.x2,self.y2=aic.math.rotate(self.x,self.y-217/4,a,self.x,self.y)
    self.x3,self.y3=aic.math.rotate(self.x,self.y,a,self.x,self.y)
    local x,y=aic.math.rotate(self.x-20,self.y,a,self.x,self.y)
    if aiming then
        last=New(_editor_class["Muki_AiC_white_arrow_aiming"],x,y,4,a,5)
    else
        last=New(_editor_class["Muki_AiC_white_arrow"],x,y,5,a,5)
    end
    lasttask=task.New(self,function()
        task._Wait(10)
        do
            local _beg_h=self.hscale1 local h=_beg_h local _end_h=self.hscale2 local _d_h=(_end_h-_beg_h)/(10-1)
            local _beg_v=self.vscale1 local v=_beg_v local _end_v=self.vscale2 local _d_v=(_end_v-_beg_v)/(10-1)
            local _beg_x=self.x local x=_beg_x local _end_x=self.x+d/2 local _d_x=(_end_x-_beg_x)/(10-1)
            local _beg_dy=0 local dy=_beg_dy local _end_dy=217/8 local _d_dy=(_end_dy-_beg_dy)/(10-1)
            for _=1,10 do
                self.hscale=h
                self.vscale=v
                self.x1,self.y1=aic.math.rotate(x,self.y+217/4-dy,a,self.x,self.y)
                self.x2,self.y2=aic.math.rotate(x,self.y-217/4+dy,a,self.x,self.y)
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                h=h+_d_h
                v=v+_d_v
                x=x+_d_x
                dy=dy+_d_dy
            end
        end
        do
            local _beg_x=self.x+d/2 local x=_beg_x local _end_x=self.x+d*3/2 local _d_x=(_end_x-_beg_x)/(10-1)
            for _=1,10 do
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                x=x+_d_x
            end
        end
        do
            local _beg_h=self.hscale2 local h=_beg_h local _end_h=self.hscale1 local _d_h=(_end_h-_beg_h)/(10-1)
            local _beg_v=self.vscale2 local v=_beg_v local _end_v=self.vscale1 local _d_v=(_end_v-_beg_v)/(10-1)
            local _beg_x=self.x+d*3/2 local x=_beg_x local _end_x=self.x+d/2 local _d_x=(_end_x-_beg_x)/(10-1)
            local _beg_dy=217/8 local dy=_beg_dy local _end_dy=0 local _d_dy=(_end_dy-_beg_dy)/(10-1)
            for _=1,10 do
                self.hscale=h
                self.vscale=v
                self.x1,self.y1=aic.math.rotate(x,self.y+217/4-dy,a,self.x,self.y)
                self.x2,self.y2=aic.math.rotate(x,self.y-217/4+dy,a,self.x,self.y)
                self.x3,self.y3=aic.math.rotate(x,self.y,a,self.x,self.y)
                task._Wait(1)
                h=h+_d_h
                v=v+_d_v
                x=x+_d_x
                dy=dy+_d_dy
            end
        end
        task._Wait(30)
        _del(self,true)
    end)
    lasttask=task.New(self,function()
        for _=1,49 do
            last=New(_editor_class["Muki_AiC_line"],self.x1,self.y1,self.x1,self.y1,self.x3,self.y3,1)
            _object.set_color(last,"add+add",255,255,255,255)
            last=New(_editor_class["Muki_AiC_line"],self.x2,self.y2,self.x2,self.y2,self.x3,self.y3,1)
            _object.set_color(last,"add+add",255,255,255,255)
            task._Wait(1)
        end
        last=New(_editor_class["Muki_AiC_line"],self.x1,self.y1,self.x1,self.y1,self.x3,self.y3,1,false,true)
        _object.set_color(last,"add+add",255,255,255,255)
        last=New(_editor_class["Muki_AiC_line"],self.x2,self.y2,self.x2,self.y2,self.x3,self.y3,1,false,true)
        _object.set_color(last,"add+add",255,255,255,255)
    end)
end
_editor_class["Muki_AiC_white_arrow"]=Class(bullet)
_editor_class["Muki_AiC_white_arrow"].init=function(self,_x,_y,v,a,s)
bullet.init(self,arrow_mid,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    self.hscale=s*2
    self.vscale=s
    self.a=self.a*s
    self.b=self.b*s
    self.group=GROUP_INDES
    self.rot=a
    self.colli=false
    self.timer=11
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_v=s local v=_beg_v local _end_v=s/2 local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        do
            local _beg_h=s*2 local h=_beg_h local _end_h=s local _d_h=(_end_h-_beg_h)/(10-1)
            for _=1,10 do
                self.hscale=h
                task._Wait(1)
                h=h+_d_h
            end
        end
        do
            local _beg_v=s/2 local v=_beg_v local _end_v=s local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        self.colli=true
        SetV2(self,v,a,true,false)
        do local t,_d_t=(1),(1) for _=1,_infinite do
            if Dist(self,player)>25 and self.y>-200 then
                PlaySound("kira00",0.1,self.x/256,false)
                do
                    local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(12)
                    for _=1,12 do
                        local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                        local d=(Dist(x,y,self.x,self.y))
                        local rot=(Angle(x,y,self.x,self.y))
                        last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            do
                                local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                                for _=1,30 do
                                    task._Wait(1)
                                    v=v+_d_v
                                end
                            end
                        end)
                        aa=aa+_d_aa
                    end
                end
            else
            end
            task._Wait(t)
        t=t+_d_t end end
    end)
end
_editor_class["Muki_AiC_white_arrow"].render=function(self)
    for _=1,2 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_fireball_small"]=Class(bullet)
_editor_class["Muki_AiC_fireball_small"].init=function(self,_x,_y,v,a)
bullet.init(self,ball_light,COLOR_BLUE,true,true)
self.x,self.y=_x,_y
    self.hscale=0.5
    self.vscale=0.5
    self.a=self.a*0.5
    self.b=self.b*0.5
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        for _=1,2 do
            task._Wait(20)
            local aa=(Muki_get8dir(self,player))
            if aa~=self.rot then
                do
                    local _beg_vv=0 local vv=_beg_vv local _end_vv=2.5 local _d_vv=(_end_vv-_beg_vv)/(60-1)
                    for _=1,60 do
                        SetV2(self,vv,aa,true,false)
                        task._Wait(1)
                        vv=vv+_d_vv
                    end
                end
            else
                task._Wait(60)
            end
        end
    end)
end
_editor_class["Muki_AiC_fireball_small"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fireball_small"].del=function(self)
    PreserveObject(self)
    last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,0.5,{67,78,206},true)
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_fireball"]=Class(bullet)
_editor_class["Muki_AiC_fireball"].init=function(self,_x,_y,v,a)
bullet.init(self,ball_light,COLOR_BLUE,true,true)
self.x,self.y=_x,_y
    self.aa=self.a
    self.bb=self.b
    self.a=self.a*2
    self.b=self.b*2
    self.vscale=2
    self.hscale=2
    SetV2(self,v,a,true,false)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("tan00",0.25,self.x/256,true)
            for _=1,3 do
                local aa=(ran:Float(0,360))
                local r=(ran:Float(0,30)+self.a/2)
                last=New(_straight,grain_a,COLOR_BLUE,self.x+r*cos(aa),self.y+r*sin(aa),ran:Float(0.5,1),aa,false,0,true,true,0,false,0.05,aa,2.5,false)
            end
            task._Wait(10)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            do
                local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(12)
                for _=1,12 do
                    last=New(_straight,grain_c,COLOR_BLUE,self.x,self.y,1,aa,true,0,true,true,0,false,0,0,0,false)
                    aa=aa+_d_aa
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,ball_mid,COLOR_BLUE,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(90)
                SetV2(self,2.5,ran:Float(0,360),true,false)
            end)
            task._Wait(5)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,3 do
            task._Wait(60)
            local aa=(Muki_get8dir(self,player))
            if aa~=self.rot then
                do
                    local _beg_vv=0 local vv=_beg_vv local _end_vv=v local _d_vv=(_end_vv-_beg_vv)/(60-1)
                    for _=1,60 do
                        SetV2(self,vv,aa,true,false)
                        task._Wait(1)
                        vv=vv+_d_vv
                    end
                end
            else
                task._Wait(60)
            end
        end
    end)
    lasttask=task.New(self,function()
        do
            local _h_s=(2.4-(1.6))/2 local _t_s=(2.4+(1.6))/2 local s=_h_s*sin(0)+_t_s local _w_s=0 local _d_w_s=12
            for _=1,_infinite do
                self.hscale=s
                self.vscale=s
                task._Wait(1)
                _w_s=_w_s+_d_w_s s=_h_s*sin(_w_s)+_t_s
            end
        end
    end)
end
_editor_class["Muki_AiC_fireball"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fireball"].del=function(self)
    PreserveObject(self)
    last=New(_editor_class["Muki_AiC_nuclear"],self.x,self.y,1,{67,78,206},true)
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_white_arrow_aiming"]=Class(bullet)
_editor_class["Muki_AiC_white_arrow_aiming"].init=function(self,_x,_y,v,a,s)
bullet.init(self,arrow_mid,COLOR_CYAN,true,true)
self.x,self.y=_x,_y
    self.hscale=s*2
    self.vscale=s
    self.a=self.a*s
    self.b=self.b*s
    self.group=GROUP_INDES
    self.rot=a
    self.colli=false
    self.timer=11
    _object.set_color(self,"mul+add",255,255,255,255)
    lasttask=task.New(self,function()
        do
            local _beg_v=s local v=_beg_v local _end_v=s/2 local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        do
            local _beg_h=s*2 local h=_beg_h local _end_h=s local _d_h=(_end_h-_beg_h)/(10-1)
            for _=1,10 do
                self.hscale=h
                task._Wait(1)
                h=h+_d_h
            end
        end
        do
            local _beg_v=s/2 local v=_beg_v local _end_v=s local _d_v=(_end_v-_beg_v)/(10-1)
            for _=1,10 do
                self.vscale=v
                task._Wait(1)
                v=v+_d_v
            end
        end
        self.colli=true
        SetV2(self,v,a,true,false)
        do local t,_d_t=(3),(1) for _=1,_infinite do
            do
                local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(8)
                for _=1,8 do
                    local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                    local d=(Dist(x,y,self.x,self.y))
                    local rot=(Angle(x,y,self.x,self.y))
                    last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        do
                            local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                            for _=1,30 do
                                task._Wait(1)
                                v=v+_d_v
                            end
                        end
                    end)
                    aa=aa+_d_aa
                end
            end
            task._Wait(t)
        t=t+_d_t end end
    end)
    lasttask=task.New(self,function()
        task._Wait(30)
        for _=1,60 do
            SetV2(self,v,0,true,true)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_white_arrow_aiming"].render=function(self)
    for _=1,2 do
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_square_slave1"]=Class(_object)
_editor_class["Muki_AiC_square_slave1"].init=function(self,_x,_y,v,th,A,co)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    aic.misc.SineMove(self,self.x,self.y,v/2,th,A,75)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,grain_b,co,self.x,self.y,0,self.rot+180,false,0,true,true,0,false,0,0,0,false)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                task._Wait(30)
                _set_a(self,0.05,self.rot,false)
                _forbid_v(self,4,'original','original')
            end)
            task._Wait(3)
        end
    end)
end
_editor_class["Muki_AiC_square_slave2"]=Class(_object)
_editor_class["Muki_AiC_square_slave2"].init=function(self,_x,_y,v,a,r,co)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_BG-5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    SetV2(self,v,a,true,false)
    do
        local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
        for _=1,4 do
            last=New(_editor_class["Muki_AiC_square_star_big"],self.x,self.y,self,r,a,co)
            a=a+_d_a
        end
    end
    lasttask=task.New(self,function()
        for _=1,30 do
            SetV2(self,v,0,true,true)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_square_star_small"]=Class(bullet)
_editor_class["Muki_AiC_square_star_small"].init=function(self,_x,_y,a,co)
bullet.init(self,star_small,co,true,true)
self.x,self.y=_x,_y
    self.bound=false
    self.omiga=3
    SetV2(self,0,a,true,false)
    lasttask=task.New(self,function()
        task._Wait(15)
        _set_a(self,0.02,self.rot,false)
    end)
end
_editor_class["Muki_AiC_square_star_big"]=Class(bullet)
_editor_class["Muki_AiC_square_star_big"].init=function(self,_x,_y,master,r,a,co)
bullet.init(self,star_big,co,true,true)
self.x,self.y=_x,_y
    self.bound=false
    self.master=master
    self.omiga=-3
    _object.set_color(self,"mul+add",200,255,255,255)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if IsValid(self.master) then
                self.x=self.master.x+r*cos(self.timer+a)
                self.y=self.master.y+r*sin(self.timer+a)
            else
                _del(self,true)
            end
            task._Wait(1)
        end
    end)
    lasttask=task.New(self,_editor_tasks["Muki_smear"](self,3,10))
end
_editor_class["Muki_AiC_square_big"]=Class(bullet)
_editor_class["Muki_AiC_square_big"].init=function(self,_x,_y,v,a,co)
bullet.init(self,square,co,true,true)
self.x,self.y=_x,_y
    self.hscale=4
    self.vscale=4
    self.a=self.a*4
    self.b=self.b*4
    self.co=co
    _object.set_color(self,"mul+add",200,255,255,255)
    SetV2(self,v,a,true,false)
    last=New(_editor_class["Muki_AiC_square_slave1"],self.x,self.y,v,a,20,co)
    _connect(self,last,0,true)
    last=New(_editor_class["Muki_AiC_square_slave1"],self.x,self.y,v,a,-20,co)
    _connect(self,last,0,true)
    lasttask=task.New(self,function()
        do
            local _beg_vv=v local vv=_beg_vv local _end_vv=0 local _d_vv=(_end_vv-_beg_vv)/(60-1)
            for _=1,60 do
                SetV2(self,vv,self.rot,true,false)
                task._Wait(1)
                vv=vv+_d_vv
            end
        end
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_square_big"].frame=function(self)
    if self.x>192 or self.x<-192 or self.y>224 or self.y<-224 then
        _del(self,true)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_square_big"].del=function(self)
    PreserveObject(self)
    PlaySound("enep02",0.1,self.x/256,false)
    last=New(_editor_class["Muki_AiC_square_slave2"],self.x,self.y,3,Angle(self,player),40,self.co)
    last=New(_editor_class["Muki_AiC_fog"],self.x,self.y,50,30,true)
    do
        local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
        for _=1,16 do
            last=New(_editor_class["Muki_AiC_square_star_small"],self.x,self.y,a,self.co)
            a=a+_d_a
        end
    end
    _del(self,false)
    self.class.base.del(self)
end
_editor_class["Muki_AiC_fog"]=Class(_object)
_editor_class["Muki_AiC_fog"].init=function(self,_x,_y,r,t,s)
    self.x,self.y=_x,_y
    self.img="img_void"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    --[[ 从古早的48th周活中掏出来的东西……
    ]]
    self.a=r
    self.b=r
    self.t=t
    self.al=255
    lasttask=task.New(self,function()
        if s then
            for _=1,_infinite do
                last=New(_editor_class["Muki_AiC_fog_ef"],self.x,self.y,s,self.al,30,1.2)
                task._Wait(1)
            end
        else
            for _=1,_infinite do
                for _=1,10 do
                    local k=(ran:Float(0,1))
                    local aa=(ran:Float(0,360))
                    last=New(_editor_class["Muki_AiC_fog_ef"],self.x,self.y,s,self.al,0,0)
                end
                task._Wait(1)
            end
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(player,self)<=r and s then
                player.infog=true
                self.infog=true
            else
                if self.infog==true then
                    player.infog=false
                else
                end
            end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_fog"].frame=function(self)
    self.class.base.frame(self)
    if self.timer>=self.t then
        lasttask=task.New(self,function()
            do
                local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(15-1)
                for _=1,15 do
                    self.al=al
                    task._Wait(1)
                    al=al+_d_al
                end
            end
            _del(self,false)
        end)
    end
end
_editor_class["Muki_AiC_fog_ef"]=Class(_object)
_editor_class["Muki_AiC_fog_ef"].init=function(self,_x,_y,s,al,t,v)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_ENEMY_BULLET
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    SetV2(self,ran:Float(0,v),ran:Float(0,360),true,false)
    self.scale=ran:Float(0.75,1.25)
    self.sign=s
    self.al=al
    self.t=t
    self.group=GROUP_GHOST
    self.layer=LAYER_ENEMY_BULLET+5
end
_editor_class["Muki_AiC_fog_ef"].frame=function(self)
    if self.timer>self.t or not self.sign then
        _del(self,false)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_fog_ef"].render=function(self)
    if self.sign then
        RenderTTF('magic',string.char(ran:Int(97,122)),self.x,self.x,self.y,self.y,Color(self.al,255,255,255))
    else
        self.class.base.render(self)
    end
end
_editor_class["Muki_AiC_Primula_cast_laser"]=Class(laser_bent)
_editor_class["Muki_AiC_Primula_cast_laser"].init=function(self,_x,_y,x,y,a,r)
    laser_bent.init(self,COLOR_GRAY,_x,_y,32,6,4,0)
    self.bound=false
    self.group=GROUP_GHOST
    lasttask=task.New(self,function()
        anchor={}
        local n = int(r/10)
        local s = ran:Sign()
        for i = 1, n do
            local t = (n - i)*10
            table.insert(anchor,x + t * cos(a + s * i * 10))
            table.insert(anchor,y + t * sin(a + s * i * 10))
        end
        task.BezierMoveTo(10,MODE_NORMAL,unpack(anchor))
        _del(self,false)
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            last=New(_straight,star_small,COLOR_GRAY,self.x,self.y,0,0,false,0,true,true,0,false,0,0,0,false)
            last.rot=Angle(last,x,y)
            lasttask=task.New(last,function()
                local self=task.GetSelf()
                self.timer=11
                task._Wait(15)
                self.omiga=3
                ChangeBulletImage(self,star_small,COLOR_YELLOW)
                SetV2(self,1,self.rot,true,false)
                _set_a(self,0.05,self.rot,false)
                _forbid_v(self,'original','original',4)
            end)
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_Primula_laser"]=Class(laser)
_editor_class["Muki_AiC_Primula_laser"].init=function(self,_x,_y,co,v,a,dir,dir2,n,bv)
    laser.init(self,co,_x,_y,0,0,114514,0,12,0,0)
    laser.ChangeImage(self,4)
    self.co=co
    self.rot=dir2*90
    bv=bv or 0
    lasttask=task.New(self,function()
        if co==COLOR_GRAY then
            laser._TurnHalfOn(self,1,false)
            if dir2==1 then
                local s=(ran:Sign())
                PlaySound("tan00",0.1,self.x/256,false)
                do local y,_d_y=(s*1000+ran:Float(-50,50)),(-s*2000/n) for _=1,n do
                    last=New(_editor_class["Muki_AiC_Primula_laser_bullet"],self.x,self.y,self,y,s*bv)
                y=y+_d_y end end
            end
        else
            laser._TurnOn(self,1,false,false)
        end
    end)
    lasttask=task.New(self,function()
        task.MoveToEx(dir*50,0,60,MOVE_DECEL)
        _set_a(self,a,(1-dir)*90,false)
        _forbid_v(self,v,'original','original')
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            local move_orange=(KeyIsDown('up') or KeyIsDown('down') or KeyIsDown('left') or KeyIsDown('right'))
            local move_cyan=(player.dx~=0 or player.dy~=0)
            if self.co==COLOR_CYAN then
                if move_cyan then
                    laser._TurnOn(self,1,false,false)
                else
                    laser._TurnHalfOn(self,1,false)
                end
            elseif self.co==COLOR_ORANGE then
                if move_orange then
                    laser._TurnHalfOn(self,1,false)
                else
                    laser._TurnOn(self,1,false,false)
                end
            end
            task._Wait(1)
        end
    end)
end
_editor_class["Muki_AiC_Primula_laser_bullet"]=Class(bullet)
_editor_class["Muki_AiC_Primula_laser_bullet"].init=function(self,_x,_y,master,y,v)
bullet.init(self,ball_mid_c,COLOR_GRAY,true,false)
self.x,self.y=_x,_y
    _connect(master,self,0,true)
    self._y=y
    self.v=v
    self.bound=false
    self.timer=11
end
_editor_class["Muki_AiC_Primula_laser_bullet"].frame=function(self)
    self.class.base.frame(self)
    self._y=self._y+self.v
    _set_rel_pos(self,0,self._y,self.rot,false)
end
_editor_class["Muki_AiC_burst"]=Class(_object)
_editor_class["Muki_AiC_burst"].init=function(self,_x,_y,red)
    self.x,self.y=_x,_y
    self.img="image:Muki_AiC_spell4"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    self.vscale=0.75
    self.hscale=0.75
    self.t=42
    self.nopause=true
    self.red=red
    self.alpha=255
    PlaySound("se:Muki_AiC_burst",8,self.x/256,true)
    lstg.var.timeslow=3
    player.nopause=true
    player.grazer.nopause=true
    if player.player_aura then
        player.player_aura[1].nopause=true
        player.player_aura[2].nopause=true
    end
    player.nextshoot=114514
    AddSuperPause(self.t*2)
    lasttask=task.New(self,function()
        task._Wait(self.t)
        last=New(_editor_class["Muki_AiC_burst_ef"],_boss.x,_boss.y,_)
        for _,unit in ObjList(GROUP_ENEMY_BULLET) do
            SetV2(unit,4,Angle(_boss,unit),false,false)
        end
        lstg.var.timeslow=1
        misc.ShakeScreen(120,3)
        task._Wait(15)
        player.nextshoot=0
        _del(self,true)
    end)
end
_editor_class["Muki_AiC_burst"].frame=function(self)
    if GetSuperPause()==0 then
        player.nopause=false
        player.grazer.nopause=false
        if player.player_aura then
            player.player_aura[1].nopause=false
            player.player_aura[2].nopause=false
        end
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_burst"].render=function(self)
    SetImageState('white','',Color(min(min(150,self.timer*10),self.alpha),0,0,0))
    Render4V('white',
    	-192,224,0.5,
    	192,224,0.5,
    	192,-224,0.5,
    	-192,-224,0.5
    )
    if self.red then
        SetImageState('image:Muki_AiC_square4','mul+add',Color(self.alpha,255,255*(1-self.red),255*(1-self.red)))
    else
        SetImageState('image:Muki_AiC_square4','mul+add',Color(self.alpha,255,255,255))
    end
    Render('image:Muki_AiC_square4',self.x,self.y,45,5)
    Render('image:Muki_AiC_square4',self.x,self.y,45,max(5,6-self.timer/self.t))
    self.class.base.render(self)
end
_editor_class["Muki_AiC_burst"].frame=function(self)
    if self.red then
        _object.set_color(self,"mul+add",255,255,0,0)
    else
        _object.set_color(self,"mul+add",255,255,255,255)
    end
    self.class.base.frame(self)
end
_editor_class["Muki_AiC_burst"].del=function(self)
    PreserveObject(self)
    lasttask=task.New(self,function()
        do
            local _beg_al=255 local al=_beg_al local _end_al=0 local _d_al=(_end_al-_beg_al)/(30-1)
            for _=1,30 do
                self.alpha=al
                task._Wait(1)
                al=al+_d_al
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_burst_ef"]=Class(_object)
_editor_class["Muki_AiC_burst_ef"].init=function(self,_x,_y,_)
    self.x,self.y=_x,_y
    self.img="white"
    self.layer=LAYER_TOP+5
    self.group=GROUP_GHOST
    self.hide=false
    self.bound=true
    self.navi=false
    self.hp=10
    self.maxhp=10
    self.colli=true
    self._servants={}
    self._blend,self._a,self._r,self._g,self._b='',255,255,255,255
    lasttask=task.New(self,function()
        do
            local _beg_s=0 local s=_beg_s local _end_s=7 local _d_s=(_end_s-_beg_s)/(30)
            for _=1,30 do
                self.vscale=s
                self.hscale=s
                task._Wait(1)
                s=s+_d_s
            end
        end
        _del(self,false)
    end)
end
_editor_class["Muki_AiC_burst_ef"].render=function(self)
    SetImageState(self.img,'mul+add',Color(255,255,255,255))
    aic.math.RenderEclipse(self.img,self.x,self.y,self.vscale*95,self.vscale*100)
end
--[[ 对话库，为方便调用先改个名
]]
local lib = aic.custom_dialog
_editor_class["Muki_AiC_Noel"]=Class(boss)
_editor_class["Muki_AiC_Noel"].cards={}
_editor_class["Muki_AiC_Noel"].name="Noel Cornehl"
_editor_class["Muki_AiC_Noel"].bgm="aic_bgm3"
_editor_class["Muki_AiC_Noel"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Noel"].difficulty="All"
_editor_class["Muki_AiC_Noel"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Noel"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Noel"].difficulty)
    Noel=self
    self.H=not setting.safemode
    aic.ui.SetCardLeft(4,'time')
    aic.ui.SetCardLeft(8,'great')
    aic.ui.SetCardLeft(10,'time')
    aic.ui.SetCardLeft(11,'great')
    self.vscale=0.75
    self.hscale=0.75
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
    last=New(_editor_class["Muki_AiC_shielder"],self.x,self.y,self)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        if not CheckEnhancer(13) then
            local img = {
            "image:Muki_AiC_Noel_face_default",
            "image:Muki_AiC_Noel_face_default",
            "image:Muki_AiC_Noel_face_fight"
            }
            local pos = 'right'
            local text = {
            '呼……好累……\n呼……',
            '呼……\n等一下，那个是……\n难道说你就是<Color {255,255,0,0} >厨圣</Color>？',
            '终于找到你了！\n之前对我做了那么多<Color {255,255,0,0} >过分的事情</Color>……',
            '<shake 3>这次我可不会坐以待毙了！ </shake>'
            }
            local canskip = false
            local t = 120
            local hscale, vscale = 0.5, 0.5
            local snd = "se:Muki_AiC_dialog_Noel"
            local vol = 1
            lib.sp.SetDisplayer(self, true, 'image:Muki_AiC_dialog_frame', 0.7, 0.25, 0, 20, '', nil, Color(150, 255, 255, 255), nil, Color(255, 85, 76, 74))
            last=New(_editor_class["Muki_AiC_dialog_name"],-175,-50,'诺艾儿·柯涅尔')
            self.dialog_name=last
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, nil, nil, nil, 1, snd, vol)
            _del(self.dialog_name,false)
        end
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
--[[ phase1
]]
_tmp_sc=boss.card.New("「通常攻击1」",2,5,60,1200,{0,10,10},false)
function _tmp_sc:before()
    boss.show_aura(self,true)
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord(aic_bgm3)
        _play_music(aic_bgm3,14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,7 do
                    self.hscale=dir*0.75
                    PlaySound("se:Muki_AiC_hit",3,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    boss.cast(self,30)
                    last=New(_editor_class["Muki_AiC_melee"],self.x,self.y,dir)
                    task._Wait(30)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        task._Wait(60)
        do
            local da=15 local _n_da=(15)+(-15)
            for _=1,_infinite do
                local a0=(ran:Float(0,360))
                do local a1,_d_a1=(0),(da) for _=1,5 do
                    do
                        local _beg_a=a0+a1 local a=_beg_a local _end_a=a0+a1+360 local _d_a=(_end_a-_beg_a)/(15)
                        for _=1,15 do
                            do
                                local v=2 local _n_v=(2)+(2.2)
                                local aa=-5 local _d_aa=(5)
                                for _=1,3 do
                                    last=New(_straight,ball_mid_c,COLOR_BLUE,self.x,self.y,v,a+aa,false,0,true,true,0,false,0,0,0,false)
                                    v=-(v)+_n_v
                                    aa=aa+_d_aa
                                end
                            end
                            a=a+_d_a
                        end
                    end
                    task._Wait(15)
                a1=a1+_d_a1 end end
                task._Wait(30)
                da=-(da)+_n_da
            end
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.hscale=0.75
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击1」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("爆咒「地面炸弹」",2,5,60,800,{10,10,10},true)
function _tmp_sc:before()
    self.scname={'爆咒「地面炸弹」', '爆咒「地面炸弹」','爆咒「地面炸弹　速」','爆咒「地面炸弹　速」'}
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, self.scname[diff])
    if ext.sc_pr and not lstg.var.bgm_playing then
        LoadMusicRecord("aic_bgm3")
        _play_music("aic_bgm3",14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    lasttask=task.New(self,function()
        self.auralist={}
        do
            local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
            local i=1 local _d_i=(1)
            for _=1,4 do
                last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                self.auralist[i]=last
                task._Wait(30)
                a=a+_d_a
                i=i+_d_i
            end
        end
        do local i,_d_i=(1),(1) for _=1,4 do
            lasttask=task.New(self.auralist[i],function()
                local self=task.GetSelf()
                do
                    local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                    local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                    for _=1,_infinite do
                        self.r=rr
                        self.vscale=scale
                        self.hscale=scale
                        task._Wait(1)
                        _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                        _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                    end
                end
            end)
        i=i+_d_i end end
    end)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            Muki_cast(self,2,90)
            PlaySound("se:Muki_AiC_bomb",1,self.x/256,true)
            PlaySound("kira00",0.75,self.x/256,true)
            local i = ran:Int(0,1)*90
            last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(180+i,270+i),100)
            last=New(_editor_class["Muki_AiC_bomb"],self.x,self.y,7,-0.05,ran:Float(-30,30)+Angle(self,player),100)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    aic.sys.DropPower(10,self.x,self.y)
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    self.shielder.active=false
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","爆咒「地面炸弹」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 爆咒「地面炸弹　速」
]]
_tmp_sc=boss.card.New("「通常攻击2」",2,5,60,1200,{0,10,10},false)
function _tmp_sc:before()
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord(aic_bgm3)
        _play_music(aic_bgm3,14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,4 do
                    self.hscale=dir*0.75
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                    Muki_cast(self,2,90)
                    PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
                    boss.cast(self,15)
                    last=New(_editor_class["Muki_AiC_melee"],self.x,self.y,dir,1)
                    local a0=(ran:Float(0,360))
                    do
                        local _beg_a=a0 local a=_beg_a local _end_a=a0+360 local _d_a=(_end_a-_beg_a)/(12)
                        for _=1,12 do
                            do
                                local aa=0 local _d_aa=(5)
                                local _beg_v=5 local v=_beg_v local _end_v=3 local _d_v=(_end_v-_beg_v)/(7-1)
                                for _=1,7 do
                                    last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,v,a+aa,false,0,true,true,0,false,0,0,0,false)
                                    last=New(_straight,ball_mid_c,COLOR_CYAN,self.x,self.y,v,a-aa,false,0,true,true,0,false,0,0,0,false)
                                    aa=aa+_d_aa
                                    v=v+_d_v
                                end
                            end
                            a=a+_d_a
                        end
                    end
                    task._Wait(60)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击2」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("箭咒「纯白之弓」",2,5,60,1000,{10,10,10},true)
function _tmp_sc:before()
    self.scname={'箭咒「纯白之弓」','箭咒「纯白之弓」','散咒「纯白之弓　散」','散咒「纯白之弓　散」'}
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, self.scname[diff])
    if ext.sc_pr and not lstg.var.bgm_playing then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        LoadMusicRecord(aic_bgm3)
        _play_music(aic_bgm3,14)
        if false then ex.stageframe=int(14/60) end
        lstg.var.bgm_playing=true
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self.x,self.y+50,player.x,player.y))
                Muki_warning(self,a)
                Muki_cast(self,1,60,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                last=New(_editor_class["Muki_AiC_bow"],self.x,self.y+50,a)
                task._Wait(30)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    lstg.var.timeslow=1
    self.spelling=false
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    aic.sys.DropPower(10,self.x,self.y)
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
end
function _tmp_sc:after()
    self.shielder.active=false
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","箭咒「纯白之弓」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 散咒「纯白之弓　散」
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(60,120,60,MOVE_ACC_DEC))
--[[ phase2
]]
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    lasttask=task.New(self,function()
        self.name='Noel Cornehl & Ixia Polystachya'
        if not CheckEnhancer(13) then
            last=New(_editor_class["Muki_AiC_Ixia"],-384,256,1)
            local img = {
            "image:Muki_AiC_Ixia_face_surprise",
            "image:Muki_AiC_Ixia_face_notworryyou",
            "image:Muki_AiC_Noel_face_smile3",
            "image:Muki_AiC_Noel_face_normal",
            "image:Muki_AiC_Ixia_face_angry",
            "image:Muki_AiC_Ixia_face_default"
            }
            local pos = 'right'
            local text = {
            '<shake 3 >诺艾儿·柯涅尔！</shake>总算找到你了！\n真是担心死……',
            '不，我才没有<Color {255,255,0,0} >很担心你！</Color>',
            '……谢谢你，伊夏同学。',
            '不过，\n你还没从那次<uppertext 森林领主>大型魔物</uppertext>的袭击中恢复过来吧……',
            '绝对没问题！就让我来帮你解决它吧！',
            '就是你这家伙一直在欺负诺艾儿吧？\n<shake 3>我绝对不会放过你的！ </shake>'
            }
            local canskip = false
            local t = 120
            local hscale, vscale = 0.5, 0.5
            local num = {1, 1, 2, 2, 1}
            local snd = {
            "se:Muki_AiC_dialog_Ixia",
            "se:Muki_AiC_dialog_Ixia",
            "se:Muki_AiC_dialog_Noel",
            "se:Muki_AiC_dialog_Noel",
            "se:Muki_AiC_dialog_Ixia"
            }
            local vol = 1
            lib.sp.SetDisplayer(self, true, 'image:Muki_AiC_dialog_frame', 0.7, 0.25, 0, 20, '', nil, Color(150, 255, 255, 255), nil, Color(255, 85, 76, 74))
            last=New(_editor_class["Muki_AiC_dialog_name"],-175,-50,'伊夏·波利斯塔切尔')
            self.dialog_name=last
            Muki_fadeout()
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 1, 2)
            self.dialog_name.name='诺艾儿·柯涅尔'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 3, 4)
            self.dialog_name.name='伊夏·波利斯塔切尔'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 5, 6)
            _del(self.dialog_name,false)
        else
            last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
            --[[ 这里不知道为啥move无效
            ]]
            New(tasker, function()
lasttask=task.New(last,function () ex.SmoothSetValueTo("x",-60,60,MOVE_ACC_DEC,nil,0,MODE_SET) end )
lasttask=task.New(last,function () ex.SmoothSetValueTo("y",120,60,MOVE_ACC_DEC,nil,0,MODE_SET) end )
            end)
        end
        Muki_fadein('aic_bgm4')
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
_tmp_sc=boss.card.New("「通常攻击3」",2,5,60,1000,{0,10,10},false)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            do
                local dir=1 local _n_dir=(1)+(-1)
                for _=1,4 do
                    self.hscale=dir*0.75
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
                    Muki_cast(self,1,60)
                    PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                    PlaySound("kira00",0.1,self.x/256,false)
                    self._wisys = BossWalkImageSystem(self)
                    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
                    boss.cast(self,15)
                    last=New(_editor_class["Muki_AiC_melee_casting"],self.x,self.y,dir,2)
                    do
                        local _beg_a=-45 local a=_beg_a local _end_a=45 local _d_a=(_end_a-_beg_a)/(5-1)
                        for _=1,5 do
                            last=New(_straight,arrow_mid,COLOR_CYAN,self.x+50*cos(a)*dir,self.y+50*sin(a),3,a*dir,true,0,true,true,0,false,0,a+Angle(self,player),0,false)
                            lasttask=task.New(last,function()
                                local self=task.GetSelf()
                                do local t,_d_t=(15),(5) for _=1,_infinite do
                                    if Dist(self,player)>25 and self.y>-200 then
                                        PlaySound("kira00",0.1,self.x/256,false)
                                        do
                                            local _beg_aa=0 local aa=_beg_aa local _end_aa=360 local _d_aa=(_end_aa-_beg_aa)/(5)
                                            for _=1,5 do
                                                local x,y=aic.math.rotate(self.x+100*cos(aa),self.y+50*sin(aa),a+90,self.x,self.y)
                                                local d=(Dist(x,y,self.x,self.y))
                                                local rot=(Angle(x,y,self.x,self.y))
                                                last=New(_straight,star_small,COLOR_CYAN,self.x,self.y,d/120,rot,false,3,true,true,0,false,0,0,0,false)
                                                lasttask=task.New(last,function()
                                                    local self=task.GetSelf()
                                                    do
                                                        local _beg_v=self._speed local v=_beg_v local _end_v=self._speed/3 local _d_v=(_end_v-_beg_v)/(30-1)
                                                        for _=1,30 do
                                                            task._Wait(1)
                                                            v=v+_d_v
                                                        end
                                                    end
                                                end)
                                                aa=aa+_d_aa
                                            end
                                        end
                                    else
                                    end
                                    task._Wait(t)
                                t=t+_d_t end end
                            end)
                            a=a+_d_a
                        end
                    end
                    task._Wait(60)
                    dir=-(dir)+_n_dir
                end
            end
            self.hscale=0.75
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if not CheckEnhancer(13) then
        safeKill(Ixia)
    end
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
    Muki_fadein('aic_bgm5')
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击3」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
_tmp_sc=boss.card.New("引咒「聚能火球」",2,5,60,1000,{10,10,10},true)
function _tmp_sc:before()
    self.scname={'引咒「聚能火球」','引咒「聚能火球」','引咒「聚能火球　改」','引咒「聚能火球　改」'}
    Ixia.scname={'追咒「纯白之弓　诱」','追咒「纯白之弓　诱」','追咒「纯白之弓　改」','追咒「纯白之弓　改」'}
    if ext.sc_pr then
        lasttask=task.New(self,function()
            task.MoveTo(60,120,60,MOVE_NORMAL)
        end)
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        last=New(_editor_class["Muki_AiC_Ixia"],-384,256,3)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel_spelling.png",4,4,{4,3,3,3},{1,1,2},9,16,16)
    self.shielder.active=true
    self.spellname=aic.ui.NewSpellname(self, self.scname[diff])
    self.spellname=aic.ui.NewSpellname(self, Ixia.scname[diff],2)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,_)
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],80,0,'image:Muki_AiC_Ixia_face_default',0.5,80)
    task._Wait(60)
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            local a=(Muki_get8dir(self,player))
            Muki_cast(self,3,120,a)
            PlaySound("se:Muki_AiC_lightball",4,self.x/256,true)
            last=New(_editor_class["Muki_AiC_fireball"],self.x,self.y,4,a)
            local fireball=(last)
            for _=1,_infinite do
                if not IsValid(fireball) then break end
                task._Wait(1)
            end
            task.MoveToPlayer(30,-96+60,96+60,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(90)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
    aic.sys.DropPower(10,self.x,self.y)
    _kill(Ixia,true)
    if IsValid(self.spellname) then
        _del(self.spellname,true)
    else
    end
    if IsValid(Ixia.spellname) then
        _del(Ixia.spellname,true)
    else
    end
    self.shielder.active=false
    if self.H then
        local num=(ran:Int(1,5))
        if num==5 then
            PlaySound("se:Muki_AiC_dame",0.75,self.x/256,true)
        else
            PlaySound("se:Muki_AiC_hited"..num,0.75,self.x/256,true)
        end
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","引咒「聚能火球」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 引咒「聚能火球　改」
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(120,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.dialog.New(false)
function _tmp_sc:init()
    lstg.player.dialog=true
    _dialog_can_skip=false
    self.dialog_displayer=New(dialog_displayer)
    last=New(_editor_class["Muki_AiC_Primula"],-384,256,1)
    self.shielder.boss=last
    self.name='Primula'
    --[[ 护盾暂时转让（
    ]]
    lasttask=task.New(self,function()
        if not CheckEnhancer(13) then
            local img = {
            "image:Muki_AiC_Primula_face_fight",
            "image:Muki_AiC_Primula_face_fight",
            "image:Muki_AiC_Noel_face_understand",
            "image:Muki_AiC_Primula_face_fight",
            "image:Muki_AiC_Primula_face_fight",
            "image:Muki_AiC_Ixia_face_notworryyou",
            "image:Muki_AiC_Noel_face_thinking",
            }
            local pos = 'right'
            local text = {
            '诺艾儿！\n怎么可以独自一人来挑战这种<uppertext 厨圣 >大型魔物</uppertext>呢！',
            '还有伊夏！\n你们先撤退，这里老师来想办法！',
            '可是老师……\n您不是不能战斗吗？',
            '「只要能打中它就行了！」\n<color 0xFFFF000>那位女士</color>是这么说的……',
            '如果是这样的话，\n老师对自己的准头还是有信心的！',
            '<scale 0.75>诺艾儿……就这样丢下老师也不好……\n我们先躲起来观察情况吧。</scale>',
            '<scale 0.75>嗯。</scale>',
            }
            local canskip = false
            local t = 120
            local hscale = {0.6, 0.6, 0.6, 0.6, 0.6, 0.5, 0.5}
            local vscale = hscale
            local num = {1, 1, 2, 1, 1, 3, 2}
            local snd = {
            "se:Muki_AiC_dialog_Primula",
            "se:Muki_AiC_dialog_Primula",
            "se:Muki_AiC_dialog_Noel",
            "se:Muki_AiC_dialog_Primula",
            "se:Muki_AiC_dialog_Primula",
            "se:Muki_AiC_dialog_Ixia",
            "se:Muki_AiC_dialog_Noel",
            }
            local vol = 1
            lib.sp.SetDisplayer(self, true, 'image:Muki_AiC_dialog_frame', 0.7, 0.25, 0, 20, '', nil, Color(150, 255, 255, 255), nil, Color(255, 85, 76, 74))
            last=New(_editor_class["Muki_AiC_dialog_name"],-175,-50,'普莉姆拉')
            self.dialog_name=last
            Muki_fadeout(60,true)
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 1, 2)
            self.dialog_name.name='诺艾儿·柯涅尔'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 3, 3)
            self.dialog_name.name='普莉姆拉'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 4, 5)
            self.dialog_name.name='伊夏·波利斯塔切尔'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 6, 6)
            self.dialog_name.name='诺艾儿·柯涅尔'
            lib.sp.multi_sentence_ex(self, img, pos, text, canskip, t, hscale, vscale, num, nil, nil, 1, snd, vol, nil, 7, 7)
            _del(self.dialog_name,false)
        else
            safeKill(Ixia)
        end
        Muki_fadein('aic_bgm6')
        safeKill(Ixia)
    end)
end
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
--[[ phase Primula
]]
table.insert(_editor_class["Muki_AiC_Noel"].cards,boss.move.New(384*2,256*2,120,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「通常攻击4」",2,5,60,1200,{0,0,0},false)
function _tmp_sc:before()
    if ext.sc_pr then
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.hscale=0.75
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    safeKill(Primula)
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","「通常攻击4」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
_tmp_sc=boss.card.New("防咒「魔法障壁」",60,60,60,_infinite,{0,0,0},true)
function _tmp_sc:before()
    Primula.scname={'防咒「魔法障壁」','防咒「魔法障壁」','护咒「魔法加护」','护咒「魔法加护」'}
    local t3=60*60
    AddSPPoint2(0.75,nil,t3)
    AddSPPoint2(0.5,nil,t3)
    AddSPPoint2(0.2,nil,t3)
    if ext.sc_pr then
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,3)
    end
    if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
        aic.pmode.Save()
    end
    self.spelling=true
    self.shielder.active=true
    Primula.spellname=aic.ui.NewSpellname(self, Primula.scname[diff])
    last=New(_editor_class["Muki_AiC_NB_Portrait_AI"],0,0,'image:Muki_AiC_Primula_face_fight')
end
function _tmp_sc:init()
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    safeKill(Primula)
    if IsValid(Primula.spellname) then
        _del(Primula.spellname,true)
    else
    end
end
function _tmp_sc:after()
    self.shielder.active=false
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel","防咒「魔法障壁」",_tmp_sc,#_editor_class["Muki_AiC_Noel"].cards,false})
--[[ 护咒「魔法加护」
]]
_editor_class["Muki_AiC_Noel_LSC"]=Class(boss)
_editor_class["Muki_AiC_Noel_LSC"].cards={}
_editor_class["Muki_AiC_Noel_LSC"].name="Noel Cornehl"
_editor_class["Muki_AiC_Noel_LSC"].bgm="aic_bgm10"
_editor_class["Muki_AiC_Noel_LSC"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Noel_LSC"].difficulty="All"
_editor_class["Muki_AiC_Noel_LSC"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Noel_LSC"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Noel_LSC"].difficulty)
    Noel=self
    lstg.tmpvar.H=false
    aic.ui.SetCardLeft(1,'time')
    aic.ui.SetCardLeft(2,'time')
    aic.ui.SetCardLeft(3,'time')
    aic.ui.SetCardLeft(4,'time')
    self.vscale=0.75
    self.hscale=0.75
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Noel.png",4,4,{4,3,3,3},{1,1,1},9,16,16)
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
    last=New(_editor_class["Muki_AiC_shielder"],self.x,self.y,self)
end
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「Reality Reverse　—10%—」",2,5,60,1200,{0,50,50},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","「Reality Reverse　—10%—」",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("「Reality Reverse　—25%—」",2,5,60,1200,{0,50,100},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","「Reality Reverse　—25%—」",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("「Reality Reverse　—50%—」",2,5,60,1200,{0,100,150},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","「Reality Reverse　—50%—」",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
_tmp_sc=boss.card.New("「Reality Reverse　—80%—」",2,5,60,1200,{0,0,200},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Noel_LSC","「Reality Reverse　—80%—」",_tmp_sc,#_editor_class["Muki_AiC_Noel_LSC"].cards,false})
--[[ LSC，符卡名应用魔杖文字体
]]
_tmp_sc=boss.card.New("",2,5,60,1800,{0,0,0},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_NORMAL)
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Noel_LSC"].cards,_tmp_sc)

_editor_class["Muki_AiC_Tamaki"]=Class(boss)
_editor_class["Muki_AiC_Tamaki"].cards={}
_editor_class["Muki_AiC_Tamaki"].name="Honda Tamaki & Murakami Shina & Seki Ayame & Fujikama Kayo"
_editor_class["Muki_AiC_Tamaki"].bgm="aic_bgm2"
_editor_class["Muki_AiC_Tamaki"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Tamaki"].difficulty="All"
_editor_class["Muki_AiC_Tamaki"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Tamaki"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Tamaki"].difficulty)
    Tamaki=self
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
end
table.insert(_editor_class["Muki_AiC_Tamaki"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「道中通常攻击1」",2,5,60,1200,{0,50,50},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Tamaki"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Tamaki","「道中通常攻击1」",_tmp_sc,#_editor_class["Muki_AiC_Tamaki"].cards,false})
table.insert(_editor_class["Muki_AiC_Tamaki"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「ステラの弾幕」",2,5,60,1200,{0,50,50},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Tamaki"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Tamaki","「ステラの弾幕」",_tmp_sc,#_editor_class["Muki_AiC_Tamaki"].cards,false})
_tmp_sc=boss.card.New("",2,5,60,1800,{0,0,0},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_NORMAL)
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Tamaki"].cards,_tmp_sc)

_editor_class["Muki_AiC_Alice"]=Class(boss)
_editor_class["Muki_AiC_Alice"].cards={}
_editor_class["Muki_AiC_Alice"].name="Alice"
_editor_class["Muki_AiC_Alice"].bgm="aic_bgm2"
_editor_class["Muki_AiC_Alice"]._bg=Muki_AiC_background
_editor_class["Muki_AiC_Alice"].difficulty="All"
_editor_class["Muki_AiC_Alice"].init=function(self,cards)
boss.init(self,-384,256,_editor_class["Muki_AiC_Alice"].name,cards,New(_editor_class["Muki_AiC_cdbg"]),_editor_class["Muki_AiC_Alice"].difficulty)
    Alice=self
    boss.show_aura(self,false)
    boss.SetUIDisplay(self,true,true,true,false,true,true)
end
table.insert(_editor_class["Muki_AiC_Alice"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("「道中通常攻击2」",2,5,60,1200,{0,50,50},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alice"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Alice","「道中通常攻击2」",_tmp_sc,#_editor_class["Muki_AiC_Alice"].cards,false})
table.insert(_editor_class["Muki_AiC_Alice"].cards,boss.move.New(0,120,60,MOVE_ACC_DEC))
_tmp_sc=boss.card.New("Default Attack「Starry Shooting」",2,5,60,1200,{0,50,50},true)
function _tmp_sc:before()
    if ext.sc_pr then
        lasttask=task.New(self,function()
            self.auralist={}
            do
                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(4)
                local i=1 local _d_i=(1)
                for _=1,4 do
                    last=New(_editor_class["Muki_AiC_aura1"],self.x,self.y,40,a,{155,255,230},1.75)
                    self.auralist[i]=last
                    task._Wait(30)
                    a=a+_d_a
                    i=i+_d_i
                end
            end
            do local i,_d_i=(1),(1) for _=1,4 do
                lasttask=task.New(self.auralist[i],function()
                    local self=task.GetSelf()
                    do
                        local _h_rr=(self.r*1.25-(self.r*0.75))/2 local _t_rr=(self.r*1.25+(self.r*0.75))/2 local rr=_h_rr*sin(0)+_t_rr local _w_rr=0 local _d_w_rr=1.5
                        local _h_scale=(self.vscale*1.25-(self.vscale*0.75))/2 local _t_scale=(self.vscale*1.25+(self.vscale*0.75))/2 local scale=_h_scale*sin(0)+_t_scale local _w_scale=0 local _d_w_scale=1.5
                        for _=1,_infinite do
                            self.r=rr
                            self.vscale=scale
                            self.hscale=scale
                            task._Wait(1)
                            _w_rr=_w_rr+_d_w_rr rr=_h_rr*sin(_w_rr)+_t_rr
                            _w_scale=_w_scale+_d_w_scale scale=_h_scale*sin(_w_scale)+_t_scale
                        end
                    end
                end)
            i=i+_d_i end end
        end)
        self.hide=true
        self.x,self.y=-384,256
        boss.show_aura(self,false)
        last=New(_editor_class["Muki_AiC_Primula"],-384,256,2)
    end
    self.spelling=true
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task._Wait(60)
        for _=1,_infinite do
            for _=1,2 do
                local a=(Angle(self,player))
                Muki_cast(self,1,90,a)
                PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                task._Wait(30)
                last=New(_editor_class["Muki_AiC_white_arrow"],self.x,self.y,5,a,5)
                PlaySound("slash",4,self.x/256,true)
                task._Wait(60)
            end
            last=New(_editor_class["Muki_AiC_burst"],0,0,false)
            task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
            task._Wait(30)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            if Dist(self,player)<=200 then
                PlaySound("tan00",0.1,self.x/256,false)
                do
                    local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(16)
                    for _=1,16 do
                        last=New(_straight,ball_big,COLOR_BLUE,self.x+25*cos(a),self.y+25*sin(a),5,a,false,0,true,true,0,false,0,0,0,false)
                        lasttask=task.New(last,function()
                            local self=task.GetSelf()
                            task._Wait(10)
                            SetV2(self,3,self.rot,true,false)
                        end)
                        a=a+_d_a
                    end
                end
            end
            task._Wait(60)
        end
    end)
    lasttask=task.New(self,function()
        for _=1,_infinite do
            PlaySound("kira00",0.75,self.x/256,true)
            local aa=(ran:Float(0,360))
            do
                local _beg_a=aa local a=_beg_a local _end_a=aa+360 local _d_a=(_end_a-_beg_a)/(16)
                for _=1,16 do
                    last=New(_straight,star_big,COLOR_CYAN,self.x+25*cos(a),self.y+25*sin(a),5,a,false,3,true,true,0,false,0,0,0,false)
                    lasttask=task.New(last,function()
                        local self=task.GetSelf()
                        task._Wait(10)
                        SetV2(self,3,self.rot,false,false)
                    end)
                    a=a+_d_a
                end
            end
            task._Wait(60)
        end
    end)
end
function _tmp_sc:beforedel()
    self.spelling=false
    if IsValid(lstg.tmpvar.aura) then
        lstg.tmpvar.aura.timer=lstg.tmpvar.aura.t2
    end
    if ext.sc_pr then
        for _,o in ipairs(self.auralist) do
            _del(o,true)
        end
    else
    end
end
function _tmp_sc:del()
    for _,unit in ObjList(GROUP_NONTJT) do
        _kill(unit,true)
    end
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alice"].cards,_tmp_sc)
table.insert(_sc_table,{"Muki_AiC_Alice","Default Attack「Starry Shooting」",_tmp_sc,#_editor_class["Muki_AiC_Alice"].cards,false})
--[[ 符卡名应用Consolas字体
]]
_tmp_sc=boss.card.New("",2,5,60,1800,{0,0,0},false)
function _tmp_sc:before()
end
function _tmp_sc:init()
    lasttask=task.New(self,function()
        task.MoveTo(0,120,60,MOVE_NORMAL)
    end)
end
function _tmp_sc:beforedel()
end
function _tmp_sc:del()
end
function _tmp_sc:after()
end
_tmp_sc.perform=false
table.insert(_editor_class["Muki_AiC_Alice"].cards,_tmp_sc)

_editor_class["Muki_AiC_Ixia"]=Class(enemy)
_editor_class["Muki_AiC_Ixia"].init=function(self,_x,_y,spellnum)
    enemy.init(self,9,114514,false,false,false)
    self.x,self.y=_x,_y
    self.drop={0,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    _connect(Noel,self,1,true)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Ixia.png",3,7,{3,7,1},{1,1},12,16,16)
    self.vscale=0.7
    self.hscale=0.7
    self.bound=false
    self.spellnum=spellnum
    self.group=GROUP_NONTJT
    Ixia=self
    lasttask=task.New(self,function()
        task.MoveTo(-60,120,30,MOVE_ACC_DEC)
    end)
end
_editor_class["Muki_AiC_Ixia"].frame=function(self)
    Print(self.spellnum)
    self.class.base.frame(self)
    if not IsValid(_boss) then
        _del(self,false)
    end
    if not self.spelling then
        self.spelling=true
        if self.spellnum==1 then
        --[[ Dialog
        ]]
        elseif self.spellnum==2 then
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    do
                        local dir=1 local _n_dir=(1)+(-1)
                        for _=1,4 do
                            self.hscale=dir*0.75
                            Muki_cast(self,3,120)
                            PlaySound("se:Muki_AiC_hit_casted",1,self.x/256,true)
                            PlaySound("kira00",0.1,self.x/256,false)
                            do
                                local _beg_a=0 local a=_beg_a local _end_a=360 local _d_a=(_end_a-_beg_a)/(8)
                                for _=1,8 do
                                    last=New(_editor_class["Muki_AiC_fireball_small"],self.x+50*cos(a),self.y+50*sin(a),2.5,a)
                                    a=a+_d_a
                                end
                            end
                            task._Wait(60)
                            dir=-(dir)+_n_dir
                        end
                    end
                    self.hscale=0.75
                    task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                    task._Wait(30)
                end
            end)
        --[[ 通常攻击3
        ]]
        elseif self.spellnum==3 then
            lasttask=task.New(self,function()
                task._Wait(60)
                for _=1,_infinite do
                    local a=(Angle(self.x,self.y+50,player.x,player.y))
                    Muki_warning(self,a)
                    Muki_cast(self,1,60,a)
                    PlaySound("se:Muki_AiC_arrow",4,self.x/256,true)
                    last=New(_editor_class["Muki_AiC_bow"],self.x,self.y+50,a,true)
                    task._Wait(30)
                    PlaySound("slash",4,self.x/256,true)
                    task.MoveToPlayer(15,-96-60,96-60,112,144,16,32,8,16,MOVE_NORMAL,MOVE_X_TOWARDS_PLAYER)
                    task._Wait(90)
                end
            end)
        --[[ 追咒「纯白之弓　诱」/追咒「纯白之弓　改」
        ]]
        elseif self.spellnum==4 then
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
            end)
        --[[ Dialog
        ]]
        elseif self.spellnum==5 then
            lasttask=task.New(self,function()
                task.MoveTo(384*2,256*2,120,MOVE_ACC_DEC)
                _del(self,true)
            end)
        --[[ quit
        ]]
        else
            _del(self,true)
        end
    end
end
_editor_class["Muki_AiC_Ixia"].kill=function(self)
    --[[ 模拟boss切卡行为
    ]]
    PreserveObject(self)
    lasttask=task.New(self,function()
        self.spellnum=self.spellnum+1
        self.spelling=false
        task.Clear(self,true)
    end)
end
_editor_class["Muki_AiC_Primula"]=Class(enemy)
_editor_class["Muki_AiC_Primula"].init=function(self,_x,_y,spellnum)
    enemy.init(self,9,114514,false,false,false)
    self.x,self.y=_x,_y
    self.drop={0,0,0}
    task.New(self,function() self.protect=true task.Wait(1) self.protect=false end)
    _connect(Noel,self,1,true)
    self._wisys = BossWalkImageSystem(self)
    self._wisys:SetImage("Danmaku_Resource\\Muki_AiC_Primula.png",3,7,{3,7,1},{1,1},12,16,16)
    self.bound=false
    self.spellnum=spellnum
    self.group=GROUP_NONTJT
    self.vscale=0.7
    self.hscale=0.7
    Primula=self
    if player.main_target then
        player.main_target=self
    end
    lasttask=task.New(self,function()
        task.MoveTo(-120,120,30,MOVE_ACC_DEC)
    end)
end
_editor_class["Muki_AiC_Primula"].frame=function(self)
    self.class.base.frame(self)
    if not IsValid(_boss) then
        _del(self,false)
    end
    if not self.spelling then
        self.spelling=true
        if self.spellnum==1 then
        --[[ Dialog
        ]]
        elseif self.spellnum==2 then
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                task._Wait(90)
                for _=1,_infinite do
                    do
                        local s=1 local _n_s=(1)+(-1)
                        for _=1,2 do
                            Muki_cast_primula(self,3)
                            task._Wait(60)
                            do
                                local _beg_a=-45 local a=_beg_a local _end_a=45 local _d_a=(_end_a-_beg_a)/(5-1)
                                local co=COLOR_YELLOW local _n_co=(COLOR_YELLOW)+(COLOR_BLUE)
                                for _=1,5 do
                                    last=New(_editor_class["Muki_AiC_square_big"],self.x,self.y,5,Angle(self,player)+a*s,co)
                                    task._Wait(12)
                                    a=a+_d_a
                                    co=-(co)+_n_co
                                end
                            end
                            task._Wait(120)
                            s=-(s)+_n_s
                        end
                    end
                    task.MoveToPlayer(30,-96,96,112,144,16,32,8,16,MOVE_ACC_DEC,MOVE_X_TOWARDS_PLAYER)
                end
            end)
        --[[ 通常攻击4
        ]]
        elseif self.spellnum==3 then
            aic.sys.DropPower(15,self.x,self.y)
            _drop_item(item_point,15,self.x,self.y)
            _drop_item(item_faith,15,self.x,self.y)
            local color=({COLOR_GRAY,COLOR_CYAN,COLOR_ORANGE})
            lasttask=task.New(self,function()
                task.MoveTo(0,120,60,MOVE_NORMAL)
                task._Wait(60)
                Muki_cast_primula(self,2)
                do local i,_d_i=(1),(1) for _=1,3 do
                    do
                        local dir=1 local _n_dir=(1)+(-1)
                        for _=1,2 do
                            do
                                local dir2=1 local _n_dir2=(1)+(-1)
                                for _=1,2 do
                                    last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,color[i],3,0.02,dir,dir2,50)
                                    dir2=-(dir2)+_n_dir2
                                end
                            end
                            dir=-(dir)+_n_dir
                        end
                    end
                    task._Wait(60)
                i=i+_d_i end end
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,3,0.02,dir,dir2,50)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(30)
                        end
                        task._Wait(90)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(3) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        do local i,_d_i=(1),(1) for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,3.5,0.03,dir,dir2,60)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(25)
                        i=i+_d_i end end
                        task._Wait(75)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(2) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    for _=1,_infinite do
                        local co
                        local n=(ran:Int(1,3))
                        Muki_cast_primula(self,2)
                        do local i,_d_i=(1),(1) for _=1,3 do
                            if i==n then
                                co=COLOR_GRAY
                            else
                                co=color[ran:Int(2,3)]
                            end
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,4,0.04,dir,dir2,70,1)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                            task._Wait(20)
                        i=i+_d_i end end
                        task._Wait(45)
                    end
                end)
                for _=1,_infinite do
                    if CheckSPPoint(1) then break end
                    task._Wait(1)
                end
                task.Clear(self,true)
                _clear_bullet(true,true)
                task.MoveTo(0,120,60,MOVE_ACC_DEC)
                lasttask=task.New(self,function()
                    Muki_cast_primula(self,2)
                    for _=1,_infinite do
                        for _=1,1 do
                            local co=(color[ran:Int(2,3)])
                            do
                                local dir=1 local _n_dir=(1)+(-1)
                                for _=1,2 do
                                    do
                                        local dir2=1 local _n_dir2=(1)+(-1)
                                        for _=1,2 do
                                            last=New(_editor_class["Muki_AiC_Primula_laser"],self.x,0,co,0.75,0.05,dir,dir2,100,1.5)
                                            dir2=-(dir2)+_n_dir2
                                        end
                                    end
                                    dir=-(dir)+_n_dir
                                end
                            end
                        end
                        task._Wait(45)
                    end
                end)
            end)
        --[[ 唤咒「使魔召唤」/护咒「魔法加护」
        ]]
        elseif self.spellnum==4 then
            aic.sys.DropPower(15,self.x,self.y)
            _drop_item(item_point,15,self.x,self.y)
            _drop_item(item_faith,15,self.x,self.y)
        --[[ Dialog
        ]]
        elseif self.spellnum==5 then
            lasttask=task.New(self,function()
                task.MoveTo(384,256,60,MOVE_ACCEL)
                if player.main_target then
                    player.main_target=Noel
                else
                end
                Noel.shielder.boss=Noel
                --[[ 归还护盾
                ]]
                _del(self,true)
            end)
        --[[ quit
        ]]
        else
            _del(self,true)
        end
    end
end
_editor_class["Muki_AiC_Primula"].kill=function(self)
    --[[ 模拟boss切卡行为
    ]]
    PreserveObject(self)
    lasttask=task.New(self,function()
        self.spellnum=self.spellnum+1
        self.spelling=false
        task.Clear(self,true)
    end)
end
stage.group.New('menu',{},"Normal",{lifeleft=5,power=400,faith=50000,bomb=3},true,2)
stage.group.AddStage('Normal','AliceInCradle@Normal',{lifeleft=7,power=400,faith=50000,bomb=3},true)
stage.group.DefStageFunc('AliceInCradle@Normal','init',function(self)
    _init_item(self)
    difficulty=self.group.difficulty
    New(mask_fader,'open')
    if jstg then jstg.CreatePlayers() else New(_G[lstg.var.player_name]) end
    lasttask=task.New(self,function()
        New(Muki_AiC_background)
        --[[ 初始化难度
        ]]
        diff = GetDiff()
        --[[ 初始存档
        ]]
        if _debug.pmode and CheckEnhancer(12) and not ext.sc_pr then
            aic.pmode.InitFunc()
            aic.pmode.Save()
        end
        StageLoadingSign = true
        task._Wait(60)
        StageLoadingSign = false
        LoadMusicRecord("aic_bgm3")
        _play_music("aic_bgm3")
        task._Wait(60)
        local _boss_wait=true
        local _ref=New(_editor_class["Muki_AiC_Noel"],_editor_class["Muki_AiC_Noel"].cards)
        last=_ref
        if _boss_wait then while IsValid(_ref) do task.Wait() end end
        task._Wait(180)
    end)
    task.New(self,function()
        while coroutine.status(self.task[1])~='dead' do task.Wait() end
        stage.group.FinishReplay()
        New(mask_fader,'close')
        task.New(self,function()
            local _,bgm=EnumRes('bgm')
            for i=1,30 do
                for _,v in pairs(bgm) do
                    if GetMusicState(v)=='playing' then
                        SetBGMVolume(v,1-i/30)
                    end
                end
                task.Wait()
            end
        end)
        task.Wait(30)
        stage.group.FinishStage()
    end)
end)
